<!-- build time:Fri Aug 09 2024 01:33:10 GMT+0800 (香港标准时间) --><!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#FFF"><link rel="apple-touch-icon" sizes="180x180" href="/images/touch-icon.png"><link rel="icon" type="image/ico" sizes="32x32" href="/images/favicon.ico"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link rel="alternate" type="application/rss+xml" title="沨临" href="https://windlinxy.top/rss.xml"><link rel="alternate" type="application/atom+xml" title="沨临" href="https://windlinxy.top/atom.xml"><link rel="alternate" type="application/json" title="沨临" href="https://windlinxy.top/feed.json"><link rel="stylesheet" href="//fonts.googleapis.com/css?family=Mulish:300,300italic,400,400italic,700,700italic%7CFredericka%20the%20Great:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20JP:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20SC:300,300italic,400,400italic,700,700italic%7CInconsolata:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext"><link rel="stylesheet" href="/css/app.css?v=0.2.5"><meta name="keywords" content="工具,后端,服务器,Docker"><link rel="canonical" href="https://windlinxy.top/2022/03/22/b53d308f67cd/"><title>Docker学习与实践 - 学习笔记 | Windlinxy's Blog = 沨临 = 记录回忆，分享经验，慢慢进步</title><meta name="generator" content="Hexo 7.3.0"></head><body itemscope itemtype="http://schema.org/WebPage"><div id="loading"><div class="cat"><div class="body"></div><div class="head"><div class="face"></div></div><div class="foot"><div class="tummy-end"></div><div class="bottom"></div><div class="legs left"></div><div class="legs right"></div></div><div class="paw"><div class="hands left"></div><div class="hands right"></div></div></div></div><div id="container"><header id="header" itemscope itemtype="http://schema.org/WPHeader"><div class="inner"><div id="brand"><div class="pjax"><h1 itemprop="name headline">Docker学习与实践</h1><div class="meta"><span class="item" title="创建时间：2022-03-22 15:44:01"><span class="icon"><i class="ic i-calendar"></i> </span><span class="text">发表于</span> <time itemprop="dateCreated datePublished" datetime="2022-03-22T15:44:01+08:00">2022-03-22</time> </span><span class="item" title="本文字数"><span class="icon"><i class="ic i-pen"></i> </span><span class="text">本文字数</span> <span>21k</span> <span class="text">字</span> </span><span class="item" title="阅读时长"><span class="icon"><i class="ic i-clock"></i> </span><span class="text">阅读时长</span> <span>19 分钟</span></span></div></div></div><nav id="nav"><div class="inner"><div class="toggle"><div class="lines" aria-label="切换导航栏"><span class="line"></span> <span class="line"></span> <span class="line"></span></div></div><ul class="menu"><li class="item title"><a href="/" rel="start">Windlinxy's Blog</a></li></ul><ul class="right"><li class="item theme"><i class="ic i-sun"></i></li><li class="item search"><i class="ic i-search"></i></li></ul></div></nav></div><div id="imgs" class="pjax"><ul><li class="item" data-background-image="https://virgil-civil-1311056353.cos.ap-shanghai.myqcloud.com/img/yst-blog-bg21.jpg"></li><li class="item" data-background-image="https://virgil-civil-1311056353.cos.ap-shanghai.myqcloud.com/img/yst-blog-bg28.jpg"></li><li class="item" data-background-image="https://virgil-civil-1311056353.cos.ap-shanghai.myqcloud.com/img/yst-blog-bg22.jpg"></li><li class="item" data-background-image="https://virgil-civil-1311056353.cos.ap-shanghai.myqcloud.com/img/yst-blog-bg18.jpg"></li><li class="item" data-background-image="https://virgil-civil-1311056353.cos.ap-shanghai.myqcloud.com/img/yst-blog-bg9.jpg"></li><li class="item" data-background-image="https://virgil-civil-1311056353.cos.ap-shanghai.myqcloud.com/img/yst-blog-bg19.jpg"></li></ul></div></header><div id="waves"><svg class="waves" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M-160 44c30 0 58-18 88-18s 58 18 88 18 58-18 88-18 58 18 88 18 v44h-352z"/></defs><g class="parallax"><use xlink:href="#gentle-wave" x="48" y="0"/><use xlink:href="#gentle-wave" x="48" y="3"/><use xlink:href="#gentle-wave" x="48" y="5"/><use xlink:href="#gentle-wave" x="48" y="7"/></g></svg></div><main><div class="inner"><div id="main" class="pjax"><div class="article wrap"><div class="breadcrumb" itemscope itemtype="https://schema.org/BreadcrumbList"><i class="ic i-home"></i> <span><a href="/">首页</a></span><i class="ic i-angle-right"></i> <span class="current" itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem"><a href="/categories/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" itemprop="item" rel="index" title="分类于 学习笔记"><span itemprop="name">学习笔记</span></a><meta itemprop="position" content="1"></span></div><article itemscope itemtype="http://schema.org/Article" class="post block" lang="zh-CN"><link itemprop="mainEntityOfPage" href="https://windlinxy.top/2022/03/22/b53d308f67cd/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/windlinxy.jpg"><meta itemprop="name" content="Windlinxy"><meta itemprop="description" content="记录回忆，分享经验，慢慢进步, 后端 CS 技术博客"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="沨临"></span><div class="body md" itemprop="articleBody"><h1 id="docker学习"><a class="anchor" href="#docker学习">#</a> Docker 学习</h1><p>参考视频：<span class="exturl" data-url="aHR0cHM6Ly93d3cuYmlsaWJpbGkuY29tL3ZpZGVvL0JWMW9nNHkxcTdNNA==">狂神说</span></p><h2 id="docker概述"><a class="anchor" href="#docker概述">#</a> Docker 概述</h2><blockquote><p>Docker 是基于 Go 语言开发的</p></blockquote><p>官网：<span class="exturl" data-url="aHR0cHM6Ly93d3cuZG9ja2VyLmNvbS8=">https://www.docker.com/</span></p><p>文档：<span class="exturl" data-url="aHR0cHM6Ly9kb2NzLmRvY2tlci5jb20v">https://docs.docker.com/</span></p><p>hub：<span class="exturl" data-url="aHR0cHM6Ly9odWIuZG9ja2VyLmNvbS8=">https://hub.docker.com/</span></p><h3 id="一般的虚拟机"><a class="anchor" href="#一般的虚拟机">#</a> <strong>一般的虚拟机</strong></h3><p><img data-src="https://raw.githubusercontent.com/Windlinxy/Typora-img/main/img/1647419493312.png" alt="1647419493312"></p><p><strong>虚拟机技术的缺点：</strong></p><ol><li>资源占用十分多</li><li>冗余步骤多</li><li>启动很慢！</li></ol><h3 id="容器化技术"><a class="anchor" href="#容器化技术">#</a> 容器化技术</h3><blockquote><p>容器化技术不是模拟一个完整的操作系统</p></blockquote><p><img data-src="https://raw.githubusercontent.com/Windlinxy/Typora-img/main/img/1647419459524.png" alt="1647419459524"></p><p>比较 Docker 和虚拟机技术的不同：</p><ul><li>传统虚拟机，会虚拟一条硬件，运行一个完整的操作系统，然后在这个系统上安装和运行软件。</li><li>容器内的应用直接运行在宿主机的内容，容器第是没有自己的内核的，也没有虚拟我们的硬件，所以就轻便了</li><li>每个容器间是相互隔离的，每个容器内都有一个属于自己的文件系统，互不影响。</li></ul><h2 id="安装步骤"><a class="anchor" href="#安装步骤">#</a> 安装步骤</h2><ol><li><p>官网安装手册：<span class="exturl" data-url="aHR0cHM6Ly9kb2NzLmRvY2tlci5jb20vZW5naW5lL2luc3RhbGwvY2VudG9zLw==">https://docs.docker.com/engine/install/centos/</span></p></li><li><p>确定是 CentOS7 以上版本</p></li><li><p>安装 docker 依赖库：</p><p></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install -y yum-utils device-mapper-persistent-data lvm2</span><br></pre></td></tr></table></figure><p></p></li><li><p>添加 Docker CE 的软件源信息</p><p></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum-config-manager --add-repo http://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo</span><br></pre></td></tr></table></figure><p></p></li><li><p>安装 Docker CE。</p><p></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">yum makecache fast</span><br><span class="line">yum -y install docker-ce</span><br></pre></td></tr></table></figure><p></p></li><li><p>设置镜像仓库</p><p></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">yum-config-manager \</span><br><span class="line">--add-repo \ https://download.docker.com/linux/centos/docker-ce.repo</span><br><span class="line"></span><br><span class="line">yum-config-manager --add-repo http://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo</span><br></pre></td></tr></table></figure><p></p></li><li><p>启动 Docker</p><p></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl start docker</span><br></pre></td></tr></table></figure><p></p></li><li><p>测试命令</p><p></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">docker version</span><br><span class="line">docker run hello-world</span><br><span class="line">docker images</span><br></pre></td></tr></table></figure><p></p></li><li><p>卸载</p><p></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">systemctl stop docker</span><br><span class="line"></span><br><span class="line">yum -y remove docker-ce docker-ce-cli containerd.io</span><br><span class="line"></span><br><span class="line">rm -rf /var/lib/docker</span><br></pre></td></tr></table></figure><p></p></li></ol><h3 id="阿里云镜像加速"><a class="anchor" href="#阿里云镜像加速">#</a> 阿里云镜像加速</h3><p>阿里云找到容器镜像服务 / 镜像加速器</p><p></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">sudo mkdir -p /etc/docker</span><br><span class="line">sudo tee /etc/docker/daemon.json &lt;&lt;-&#x27;EOF&#x27;</span><br><span class="line">&#123;</span><br><span class="line">&quot;registry-mirrors&quot;: [&quot;https://XXXXXXX.mirror.aliyuncs.com&quot;]</span><br><span class="line">&#125;</span><br><span class="line">EOF</span><br><span class="line">sudo systemctl daemon-reload</span><br><span class="line">sudo systemctl restart docker</span><br></pre></td></tr></table></figure><p></p><h3 id="run命令"><a class="anchor" href="#run命令">#</a> run 命令</h3><p><img data-src="https://raw.githubusercontent.com/Windlinxy/Typora-img/main/img/1647433767783.png" alt="1647433767783"></p><h2 id="底层原理"><a class="anchor" href="#底层原理">#</a> 底层原理</h2><h4 id="docker是怎么工作的"><a class="anchor" href="#docker是怎么工作的">#</a> Docker 是怎么工作的</h4><p>Docker 是一个 Client-Server 结构的系统，Docker 守护进程运行在主机上，然后通过 Socket 连接从客户端访问，守护进程从客户端接受命令并管理运行在主机上的容器。容器，是一个运行时环境，就是我们面前说到的集装箱。</p><p><img data-src="https://raw.githubusercontent.com/Windlinxy/Typora-img/main/img/1647434113254.png" alt="1647434113254"></p><h4 id="为什么docker比较vm快"><a class="anchor" href="#为什么docker比较vm快">#</a> 为什么 Docker 比较 VM 快</h4><ol><li>docker 有着比虚拟机更少的抽象层。由于 docker 不需要 Hypervisor 实现硬件资源虚拟化，运行在 docker 容器上的程序直接使用的都是实际物理机的硬件资源。因此在 cpu、内存利用率上 docker 将在效率上有明显优势。</li><li>docker 利用的是宿主机的内核，而不需要 Guest OS。当新建一个容器时，docker 不需要和虚拟机一样加载操作系统内核。加载操作系统内核这个过程比较费时费资源的过程，当新建一个虚拟机时，虚拟机软件需要加载 Guest OS，这个新建过程是分钟级别。而 docker 由于直接利用宿主机的操作系统，则省略了这个过程，因此新建一个 docker 容器只需要几秒钟</li></ol><p><img data-src="https://raw.githubusercontent.com/Windlinxy/Typora-img/main/img/1647434712492.png" alt="1647434712492"></p><table><thead><tr><th></th><th>虚拟机</th><th>容器</th></tr></thead><tbody><tr><td>占用磁盘空间</td><td>非常大 GB</td><td>小 MB</td></tr><tr><td>启动速度</td><td>慢，分钟级别</td><td>快，秒级</td></tr><tr><td>运行形态</td><td>运行于 Hypervisor</td><td>直接运行在宿主机内核上</td></tr><tr><td>并发性</td><td>一台宿主机上十几个，最多几十个</td><td>上百</td></tr><tr><td>性能</td><td>逊与宿主机</td><td>接近本地进程</td></tr><tr><td>资源利用率</td><td>低</td><td>高</td></tr></tbody></table><h2 id="docker常用命令"><a class="anchor" href="#docker常用命令">#</a> Docker 常用命令</h2><h3 id="帮助命令"><a class="anchor" href="#帮助命令">#</a> 帮助命令</h3><p></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">docker version  # 显示版本信息</span><br><span class="line">docker info		# 显示Docker系统信息，包括镜像和容器</span><br><span class="line">docker --help	# 帮助</span><br></pre></td></tr></table></figure><p></p><h3 id="镜像命令"><a class="anchor" href="#镜像命令">#</a> 镜像命令</h3><p><strong>docker image</strong></p><p></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">列出本地主机上镜像</span></span><br><span class="line">[root@iZc3ncrhf90zylZ ~]# docker images</span><br><span class="line">REPOSITORY    TAG       IMAGE ID       CREATED        SIZE</span><br><span class="line">mysql         5.7       c20987f18b13   2 months ago   448MB</span><br><span class="line">hello-world   latest    feb5d9fea6a5   5 months ago   13.3kB</span><br><span class="line">centos        latest    5d0da3dc9764   6 months ago   231MB</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">解释</span></span><br><span class="line">REPOSITORY  镜像的仓库源</span><br><span class="line">TAG         镜像的标签</span><br><span class="line">IMAGE ID    镜像的ID</span><br><span class="line">CREATED     镜像创建时间</span><br><span class="line">SIZE        镜像大小</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">同一仓库源可以有多个TAG，代表这个仓库源有不同版本，我们使用REPOSITORY:TAG 定义不同镜像，不定义镜像版本默认使用lastest镜像</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">可选项</span></span><br><span class="line">-a			列出本地所有镜像</span><br><span class="line">-q			只显示镜像id</span><br><span class="line">--digests   显示镜像摘要信息</span><br></pre></td></tr></table></figure><p></p><p><strong>docker search</strong></p><p></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">搜索镜像</span></span><br><span class="line">[root@iZc3ncrhf90zylZ ~]# docker search mysql</span><br><span class="line">NAME   DESCRIPTION                                    STARS     OFFICIAL AUTOMATED</span><br><span class="line">mysql  MySQL is a widely used, open-source relation…  12254     [OK]  </span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">docker search 某个镜像名称 对应DockerHub仓库中镜像</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">可选项</span></span><br><span class="line">--filter=stars=50  列出收藏数不小于指定值的镜像</span><br></pre></td></tr></table></figure><p></p><p><strong>docker pull</strong></p><p></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">下载镜像</span></span><br><span class="line">[root@kuangshen ~]# docker pull mysql</span><br><span class="line">Using default tag: latest # 不写tag，默认是latest</span><br><span class="line">latest: Pulling from library/mysql</span><br><span class="line">54fec2fa59d0: Already exists # 分层下载</span><br><span class="line">bcc6c6145912: Already exists</span><br><span class="line">951c3d959c9d: Already exists</span><br><span class="line">05de4d0e206e: Already exists</span><br><span class="line">319f0394ef42: Already exists</span><br><span class="line">d9185034607b: Already exists</span><br><span class="line">013a9c64dadc: Already exists</span><br><span class="line">42f3f7d10903: Pull complete</span><br><span class="line">c4a3851d9207: Pull complete</span><br><span class="line">82a1cc65c182: Pull complete</span><br><span class="line">a0a6b01efa55: Pull complete</span><br><span class="line">bca5ce71f9ea: Pull complete</span><br><span class="line">Digest:</span><br><span class="line">sha256:61a2a33f4b8b4bc93b7b6b9e65e64044aaec594809f818aeffbff69a893d1944 #</span><br><span class="line">签名</span><br><span class="line">Status: Downloaded newer image for mysql:latest</span><br><span class="line">docker.io/library/mysql:latest # 真实位置</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">指定版本下载</span></span><br><span class="line">[root@kuangshen ~]# docker pull mysql:5.7</span><br><span class="line">....</span><br></pre></td></tr></table></figure><p></p><p>docker rmi</p><p></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">删除镜像</span></span><br><span class="line">docker rmi -f 镜像id # 删除单个</span><br><span class="line">docker rmi -f 镜像名:tag 镜像名:tag # 删除多个</span><br><span class="line">docker rmi -f $(docker images -qa) # 删除全部</span><br></pre></td></tr></table></figure><p></p><h3 id="容器命令"><a class="anchor" href="#容器命令">#</a> 容器命令</h3><p>&lt;font&gt; 说明：有镜像才能创建容器，我们这里使用 centos 的镜像进行测试，就是一个虚拟的 centos&lt;/font&gt;</p><p><strong>新建容器并启动</strong></p><p></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">命令</span></span><br><span class="line">docker run [OPTIONS] IMAGE [COMMAND][ARG...]</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">常用参数说明</span></span><br><span class="line">--name=&quot;Name&quot; # 给容器指定一个名字</span><br><span class="line">-d # 后台方式运行容器，并返回容器的id！</span><br><span class="line">-i # 以交互模式运行容器，通过和 -t 一起使用</span><br><span class="line">-t # 给容器重新分配一个终端，通常和 -i 一起使用</span><br><span class="line">-P # 随机端口映射（大写）</span><br><span class="line">-p # 指定端口映射（小结），一般可以有四种写法</span><br><span class="line">ip:hostPort:containerPort</span><br><span class="line">ip::containerPort</span><br><span class="line">本地端口:容器端口 (常用)</span><br><span class="line">containerPort</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">测试</span></span><br><span class="line">[root@kuangshen ~]# docker images</span><br><span class="line">REPOSITORY TAG IMAGE ID CREATED</span><br><span class="line">SIZE</span><br><span class="line">centos latest 470671670cac 3 months ago</span><br><span class="line">237MB</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">使用centos进行用交互模式启动容器，在容器内执行/bin/bash命令！</span></span><br><span class="line">[root@kuangshen ~]# docker run -it centos /bin/bash</span><br><span class="line">[root@dc8f24dd06d0 /]# ls # 注意地址，已经切换到容器内部了！</span><br><span class="line">bin etc lib lost+found mnt proc run srv tmp var</span><br><span class="line">dev home lib64 media opt root sbin sys usr</span><br><span class="line">[root@dc8f24dd06d0 /]# exit # 使用 exit 退出容器</span><br><span class="line">exit</span><br><span class="line">[root@kuangshen ~]#</span><br><span class="line"></span><br></pre></td></tr></table></figure><p></p><p><strong>删除容器</strong></p><p></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">docker rm 容器id # 删除指定容器</span><br><span class="line">docker rm -f $(docker ps -a -q) # 删除所有容器</span><br><span class="line">docker ps -a -q|xargs docker rm # 删除所有容器</span><br></pre></td></tr></table></figure><p></p><h3 id="常用其他命令"><a class="anchor" href="#常用其他命令">#</a> 常用其他命令</h3><p><strong>后台启动</strong></p><p></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">命令 docker run -d 镜像名</span></span><br><span class="line">[root@iZc3ncrhf90zylZ ~]# docker run -d centos</span><br><span class="line">53126313685d9f43c9bca5c16f4714a1b86816deb4732adb9d7dab0975034317</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">问题docker ps 发现centos停止了</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">常见的坑，docker 容器使用后台运行，就必须要有一个前台进程，docker发现没有应用，就会 自动停止</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">nginx容器启动后，发现自己没有提供服务，就会立刻停止，就是没有程序了</span></span><br></pre></td></tr></table></figure><p></p><p><strong>查看日志</strong></p><p></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">-t 显示时间戳</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">-f 打印最新的日志</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">--<span class="built_in">tail</span> 数字 显示多少条！</span></span><br><span class="line"></span><br><span class="line">[root@iZc3ncrhf90zylZ ~]# docker logs -f -t --tail 10 492e64524782</span><br></pre></td></tr></table></figure><p></p><p><strong>查看容器中运行的进程信息，支持 ps 命令参数</strong></p><p></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">命令</span></span><br><span class="line">docker top  容器id</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">测试</span></span><br><span class="line">[root@iZc3ncrhf90zylZ ~]# docker top 492e64524782</span><br><span class="line">UID     PID    PPID   C    STIME    TTY    TIME          CMD</span><br><span class="line">root    1455   11434  0    17:45    pts/0  00:00:00      /bin/bash</span><br></pre></td></tr></table></figure><p></p><p><strong>查看容器 / 镜像的元数据</strong></p><p></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">命令</span></span><br><span class="line">docker inspect 容器id</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">测试</span></span><br><span class="line">[root@iZc3ncrhf90zylZ ~]# docker inspect 492e64524782</span><br></pre></td></tr></table></figure><p></p><p><strong>进入正在运行的容器</strong></p><p></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">命令1</span></span><br><span class="line">docker exec -it 容器id bashShell</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">测试1</span></span><br><span class="line">[root@iZc3ncrhf90zylZ ~]# docker exec -it 492e64524782 /bin/bash</span><br><span class="line">[root@492e64524782 /]# ps -ef</span><br><span class="line">UID        PID  PPID  C STIME TTY          TIME CMD</span><br><span class="line">root         1     0  0 09:45 pts/0    00:00:00 /bin/bash</span><br><span class="line">root        15     0  0 10:11 pts/1    00:00:00 /bin/bash</span><br><span class="line">root        29    15  0 10:11 pts/1    00:00:00 ps -ef</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">命令2</span></span><br><span class="line">docker attach 容器id</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">测试2</span></span><br><span class="line">[root@iZc3ncrhf90zylZ ~]# docker attach 4f48f187ab25</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">区别</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash"><span class="built_in">exec</span> 		是在容器中打开新的终端，并且可以启动新的进程</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">attach 	直接进入容器启动命令终端，不会启动新的进程</span></span><br></pre></td></tr></table></figure><p></p><p><strong>从容器内拷贝文件到主机上</strong></p><p></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">命令</span></span><br><span class="line">docker cp 容器id:容器内路径 目的主机路径</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">测试</span></span><br><span class="line">[root@iZc3ncrhf90zylZ home]# docker attach 492e64524782</span><br><span class="line">[root@492e64524782 /]# cd /home   </span><br><span class="line">[root@492e64524782 home]# ls</span><br><span class="line">[root@492e64524782 home]# touch test.java</span><br><span class="line">[root@492e64524782 home]# ls</span><br><span class="line">test.java</span><br><span class="line">[root@492e64524782 home]# exit</span><br><span class="line">exit</span><br><span class="line">[root@iZc3ncrhf90zylZ home]# docker ps -a</span><br><span class="line">CONTAINER ID   IMAGE     COMMAND       CREATED       STATUS                      PORTS     NAMES</span><br><span class="line">492e64524782   centos    &quot;/bin/bash&quot;   2 hours ago   Exited (0) 10 seconds ago             vibrant_buck</span><br><span class="line">53126313685d   centos    &quot;/bin/bash&quot;   2 hours ago   Exited (0) 2 hours ago                pensive_hamilton</span><br><span class="line">[root@iZc3ncrhf90zylZ home]# docker cp 492e64524782:/home/test.java /home</span><br><span class="line">[root@iZc3ncrhf90zylZ home]# ll</span><br><span class="line">total 4</span><br><span class="line">drwx------ 3 admin admin 4096 Feb  7 15:27 admin</span><br><span class="line">-rw-r--r-- 1 root  root     0 Mar 17 19:35 test.java</span><br><span class="line">-rw-r--r-- 1 root  root     0 Mar 17 19:33 windlin</span><br><span class="line"></span><br></pre></td></tr></table></figure><p></p><h3 id="小结"><a class="anchor" href="#小结">#</a> 小结</h3><p><img data-src="https://raw.githubusercontent.com/Windlinxy/Typora-img/main/img/1647517132421.png" alt="1647517132421"></p><p>常用命令</p><p></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">attach  	#当前shell下attach连接指定环境</span><br><span class="line">build  		#通过Dockerfile定制镜像</span><br><span class="line">commit  	#提交当前容器为新的镜像</span><br><span class="line">cp 			#从容器中拷贝指定文件或者目录到宿主机中</span><br><span class="line">create  	# 创建一个新的容器，同run，但不启动容器</span><br><span class="line">diff  		# 查看 docker 容器变化</span><br><span class="line">events  	# 从 docker 服务获取容器实时事件</span><br><span class="line">exec  		# 在已存在的容器上运行命令</span><br><span class="line">export  	# 导出容器的内容流作为一个 tar 归档文件[对应 import ]</span><br><span class="line">history S 	# 展示一个镜像形成历史</span><br><span class="line">images 		# 列出系统当前镜像</span><br><span class="line">import 		# 从tar包中的内容创建一个新的文件系统映像[对应export]</span><br><span class="line">info  		# 显示系统相关信息</span><br><span class="line">inspect  	# 查看容器详细信息</span><br><span class="line">kill 		# kill 指定 docker 容器</span><br><span class="line">load 		# 从一个 tar 包中加载一个镜像[对应 save]</span><br><span class="line">login  		# 注册或者登陆一个docker 源服务器</span><br><span class="line">logout 		# 从当前 Docker registry 退出</span><br><span class="line">logs  		# 输出当前容器日志信息</span><br><span class="line">port  		#查看映射端口对应的容器内部源端口</span><br><span class="line">pause 		# 暂停容器</span><br><span class="line">ps 			# 列出容器列表</span><br><span class="line">pull  		#从docker镜像源服务器拉取指定镜像或者库镜像</span><br><span class="line">push 		#推送指定镜像或者库镜像至docker源服务器</span><br><span class="line">restart  	# 重启运行的容器</span><br><span class="line">rm  		# 移除一个或者多个容器</span><br><span class="line">rmi  		# 移除一个或多个镜像[无容器使用该镜像才可删除，否则需删除相关容器才可继续或 -f 强制删除]</span><br><span class="line">run  		# 创建一个新的容器并运行一个命令</span><br><span class="line">save  		# 保存一个镜像为一个tar 包[对应 load]</span><br><span class="line">search  	# 在 docker hub 中搜索镜像</span><br><span class="line">start  		# 启动容器</span><br><span class="line">stop 		# 停止容器</span><br><span class="line">tag 		# 给源中镜像打标签</span><br><span class="line">top  		# 查看容器中运行的进程信息</span><br><span class="line">unpause  	# 取消暂停容器</span><br><span class="line">version 	# 查看 docker 版本号</span><br><span class="line">wait  		# 截取容器停止时的退出状态值</span><br></pre></td></tr></table></figure><p></p><h3 id="练习"><a class="anchor" href="#练习">#</a> 练习</h3><h4 id="安装nginx"><a class="anchor" href="#安装nginx">#</a> 安装 Nginx</h4><p></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">1、搜索镜像</span></span><br><span class="line">[root@iZc3ncrhf90zylZ home]# docker search nginx</span><br><span class="line">NAME DESCRIPTION STARS OFFICIAL</span><br><span class="line">nginx Official build of Nginx. 13159 [OK]</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">2、拉取镜像</span></span><br><span class="line">[root@iZc3ncrhf90zylZ home]# docker pull nginx</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">3、启动容器</span></span><br><span class="line">[root@iZc3ncrhf90zylZ home]# docker images</span><br><span class="line">REPOSITORY    TAG       IMAGE ID       CREATED        SIZE</span><br><span class="line">nginx         latest    605c77e624dd   2 months ago   141MB</span><br><span class="line">[root@iZc3ncrhf90zylZ home]# docker run -d --name nginx01 -p 3344:80 nginx</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">4、测试访问</span></span><br><span class="line">[root@iZc3ncrhf90zylZ home]# curl localhost:3344</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">5、进入容器</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p></p><h4 id="安装tomcat"><a class="anchor" href="#安装tomcat">#</a> 安装 tomcat</h4><p></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">官方文档解释</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">-it ：交互模式</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">--<span class="built_in">rm</span>：容器启动成功并退出以后容器就自动移除，一般在测试情况下使用！</span></span><br><span class="line">docker run -it --rm tomcat:9.0</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">1、下载tomcat镜像</span></span><br><span class="line">docker pull tomcat</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">2、启动</span></span><br><span class="line">docker run -d -p 8080:8080 --name tomcat9 tomcat</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">-p 使用 本地端口：容器端口</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">3、进入tomcat</span></span><br><span class="line">docker exec -it tomcat9 /bin/bash</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">4、思考：我们以后要部署项目，还需要进入容器中，是不是十分麻烦，要是有一种技术，可以将容器内和我们Linux进行映射挂载就好了？我们后面会将数据卷技术来进行挂载操作，也是一个核心内容，这里大家先听听名词就好，我们很快就会讲到！</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p></p><h3 id="可视化面板"><a class="anchor" href="#可视化面板">#</a> 可视化面板</h3><ul><li>Porttainer</li></ul><p></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -d -p 8000:8000 -p 9000:9000 --name=portainer --restart=always -v /var/run/docker.sock:/var/run/docker.sock -v portainer_data:/data portainer/portainer-ce</span><br></pre></td></tr></table></figure><p></p><h2 id="docker镜像讲解"><a class="anchor" href="#docker镜像讲解">#</a> Docker 镜像讲解</h2><h3 id="镜像是什么"><a class="anchor" href="#镜像是什么">#</a> 镜像是什么</h3><p>镜像是一种轻量级，可执行的独立软件包，用来打包软件运行环境和基于运行环境开发的软件，它包含运行某个软件所需的所有内容，包括代码、运行时、库、环境变量和配置文件。</p><h3 id="docker镜像加载原理"><a class="anchor" href="#docker镜像加载原理">#</a> Docker 镜像加载原理</h3><h4 id="unionfs联合文件系统"><a class="anchor" href="#unionfs联合文件系统">#</a> UnionFs（联合文件系统）</h4><p>UnionFS（联合文件系统）：Union 文件系统是一种分层、轻量级并且高性能的文件系统，它支持对文件系统的修改作为一次提交来一层层的叠加，同时可以将不同目录挂载到同一虚拟文件系统下。Union 文件系统是 Docker 镜像的基础。镜像可以通过分层来进行继承，基于基础镜像（没有父镜像），可以制作各种具体的应用镜像。</p><p>特性；一次同时加载多个文件系统，但从外面看起来。只能看到一个文件系统，联合加载会把各层文件系统叠加起来，这样最终的文件系统会包含所有底层的文件和目录。</p><h4 id="docker镜像加载原理-2"><a class="anchor" href="#docker镜像加载原理-2">#</a> Docker 镜像加载原理</h4><p>docker 的镜像实际上由一层一层的文件系统组成，这种层级的文件系统 UnionFS</p><p>bootfs（boot file system）主要包含 bootloader 和 kernel，bootloader 主要是引导加载 kernel。Linux 刚启动时会加载 bootfs 文件系统，在 Docker 镜像最底层是 bootfs。这一层与我们典型的 Linux/Unix 系统是一样的，包含 boot 加载器和内核，当 boot 加载完成之后整个内核就都在内存中了，此时内存的使用权已由 bootfs 转交给内核，此时系统也会卸载 bootfs。</p><p>rootfs（root file system），在 boots 之上。包含的就是典型 Linux 系统中的 /dev./proc,/bin,/etc 等标准目录和文件。rootfs 就是各种不同操作系统发行版，如 Ubuntu，Centos 等等。</p><p>平时我们安装进虚拟机的 Centos 都是好几个 G，docker 为什么 200 多 m？</p><p>对于精简的 OS，rootfs 非常小，只需要包含基本的命令工具和程序就可以了，因为底层直接用 Host 的 kernel，自己只需要提供 rootfs 就可以了。由此可见对于不同的 linux 发行版，bootfs 基本是一致的，rootfs 会有差别</p><h3 id="分层理解"><a class="anchor" href="#分层理解">#</a> 分层理解</h3><h4 id="分层的镜像"><a class="anchor" href="#分层的镜像">#</a> 分层的镜像</h4><p>我们可以去下载一个镜像，注意观察日志输出，可以看到一层一层地在下载！</p><p>== 思考：== 为什么 Docekr 要采用分层的结构呢？</p><p>最大的好处，资源共享！</p><p>查看镜像分层的方式可以通过 docker image inspect 命令</p><p><strong>理解：</strong></p><p>所有的 Docker 镜像都起始于一个基础镜像层，当进行修改或增加新的的内容时，就会在当前镜像层之上，创建新的镜像层。</p><p>举一个简单的例子，加入基于 Ubantu linux 16.04 创建一个新的镜像，这就是新镜像的第一层；如果在该镜像中添加 Python 包，就会在基础镜像层之上创建第二个镜像层；如果继续添加一个安全补丁，就会创建第三个镜像层。</p><h3 id="特点"><a class="anchor" href="#特点">#</a> 特点</h3><blockquote><p>Docker 镜像都是只读的，当容器启动时，一个新的可写层被加载到镜像的顶部。</p><p>这一层就是我们通常说的容器层，容器之下都叫镜像层。</p></blockquote><p><img data-src="https://raw.githubusercontent.com/Windlinxy/Typora-img/main/img/1647601588847.png" alt="1647601588847"></p><h3 id="镜像commit"><a class="anchor" href="#镜像commit">#</a> 镜像 Commit</h3><p>docker commit 从容器创建一个新的镜像</p><p></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">docker commit 提交容器副本使之成为一个新的镜像！</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">语法</span></span><br><span class="line">docker commit -m=&quot;提交的描述信息&quot; -a=&quot;作者&quot; 容器id 要创建的目标镜像名:[标签名]</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">测试</span></span><br><span class="line">[root@iZc3ncrhf90zylZ ~]# docker commit -m=&quot;增加了webapps&quot; -a=&quot;windlinxy&quot; tomcat01 tomcat_ex:1.0</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">注意：commit的时候，容器的名字不能有大写，否则报错：invalid reference format</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p></p><h2 id="容器数据卷"><a class="anchor" href="#容器数据卷">#</a> 容器数据卷</h2><h3 id="什么是容器数据卷"><a class="anchor" href="#什么是容器数据卷">#</a> 什么是容器数据卷</h3><p>docker 理念回顾：</p><p>将应用和运行环境打包形成容器运行，运行可以伴随着容器，但是我们对于数据的要求，是希望能够持久化的！</p><p>就好比，你安装一个 Mysql。结果你把容器删了就相当于删库跑路了，这 TM 也太扯了吧！</p><p>所以我们希望容器之间有可能可以共享数据，Docker 容器产生的数据，如果不通过 docker commit 生成新的镜像，使得数据作为镜像的一部分保存下来，那么当容器删除后，数据自然也没有了！这样是行不通的！</p><p><strong>作用：</strong></p><p>卷就是目录或者文件，存在一个或者多个容器中，由 docker 挂载到容器，但不属于联合文件系统，因此能够绕过 Union File System，提供一些用于持续存储或共享数据的特性：</p><p>卷的设计目的就是数据的持久化，完全独立于容器的生存周期，因此 Docker 不会再容器删除时删除其挂载的数据卷。</p><p><strong>特点：</strong></p><ol><li>数据卷可在容器之间共享或重用数据</li><li>卷中的更改可以直接生效</li><li>数据卷中的更改不会包含在镜像的更新中</li><li>数据卷的生命周期一直持续到没有容器使用它为止</li></ol><p><strong>所以：总结一句话，容器的持久化，以及容器间的继承和数据共享！</strong></p><h3 id="使用数据卷"><a class="anchor" href="#使用数据卷">#</a> 使用数据卷</h3><p>&lt;font&gt; 方式一 ：&lt;/font &gt; 容器中直接使用命令来添加</p><p><strong>挂载</strong></p><p></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">#命令</span><br><span class="line">docker run -it -v 宿主机绝对路径目录：容器内目录 镜像名</span><br><span class="line"></span><br><span class="line"># 测试</span><br><span class="line">[root@iZc3ncrhf90zylZ ~]# docker run -it -v /home/ceshi:/home centos /bin/bash</span><br><span class="line">[root@17f40c5e1e8c /]# cd /home</span><br><span class="line">[root@17f40c5e1e8c home]# ls</span><br><span class="line">[root@17f40c5e1e8c home]# touch mount.java</span><br><span class="line"></span><br><span class="line">[root@iZc3ncrhf90zylZ home]# cd ceshi</span><br><span class="line">[root@iZc3ncrhf90zylZ ceshi]# ls</span><br><span class="line">mount.java</span><br><span class="line"></span><br><span class="line"># 宿主机目录是创建的</span><br><span class="line"># 运行后查看容器的信息可看到挂载信息</span><br><span class="line">&quot;Mounts&quot;: [</span><br><span class="line">            &#123;</span><br><span class="line">                &quot;Type&quot;: &quot;bind&quot;,</span><br><span class="line">                &quot;Source&quot;: &quot;/home/ceshi&quot;,</span><br><span class="line">                &quot;Destination&quot;: &quot;/home&quot;,</span><br><span class="line">                &quot;Mode&quot;: &quot;&quot;,</span><br><span class="line">                &quot;RW&quot;: true,</span><br><span class="line">                &quot;Propagation&quot;: &quot;rprivate&quot;</span><br><span class="line">            &#125;</span><br><span class="line">        ]</span><br></pre></td></tr></table></figure><p></p><p>测试容器和宿主机之间数据共享：可以发现，在容器中，创建的会在宿主机中看到！</p><p>容器停止退出后，主机修改的数据是否同步：</p><ol><li>停止容器</li><li>在宿主机上修改文件，增加些内容</li><li>启动刚才停止的容器</li><li>查看对应的文件，数据<strong>依然同步</strong>！</li></ol><h3 id="使用docker安装mysql"><a class="anchor" href="#使用docker安装mysql">#</a> 使用 docker 安装 mysql</h3><p></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">搜索镜像 docker search mysql</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">拉取镜像 docker pull mysql:5.7</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">创建容器并运行</span></span><br><span class="line">docker run -d -p 3307:3306 \</span><br><span class="line">-v /home/mysql/conf:/etc/mysql/conf.d \</span><br><span class="line">-v /home/mysql/data:/var/lib/mysql \</span><br><span class="line">-e MYSQL_ROOT_PASSWORD=root --name mysql_01 mysql:5.7</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">-e 配置环境变量 -v 挂载卷 宿主机绝对路径目录：容器内目录</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">测试连接（ip：3307）没有问题</span></span><br></pre></td></tr></table></figure><p></p><p>&lt;font&gt; 存疑：为什么在挂载文件的时候使用 conf.d 的配置，而不是使用 my.cnf&lt;/font&gt;</p><h3 id="通过docker-file来添加了解"><a class="anchor" href="#通过docker-file来添加了解">#</a> 通过 Docker File 来添加（了解）</h3><p>DockerFile 是用来构建 Docker 镜像的构建文件，是由一些列</p><p>测试：</p><p></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">1、我们在宿主机 /home 目录下新建一个docker-test-volume文件夹</span></span><br><span class="line">[root@iZc3ncrhf90zylZ home]# mkdir docker-test-volume</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">说明：在编写DockerFile文件中使用VOLUME指令给镜像添加一个或多个数据卷</span></span><br><span class="line">VOLUME[&quot;/dataVolumeContainer1&quot;,&quot;/dataVolumeContainer2&quot;]</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">出于可移植和共享的考虑，我们之前使用 -v 主机目录：容器目录 这种方式不能够直接在DockerFile中实现。</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">出于宿主机目录是依赖于特定宿主机的，并不能保证在所有宿主机上都存在这样的特定目录。</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">2、编写DockerFile文件</span></span><br><span class="line">[root@iZc3ncrhf90zylZ home]# mkdir docker-test-volume</span><br><span class="line">[root@iZc3ncrhf90zylZ home]# cd docker-test-volume/</span><br><span class="line">[root@iZc3ncrhf90zylZ docker-test-volume]# pwd</span><br><span class="line">/home/docker-test-volume</span><br><span class="line">[root@iZc3ncrhf90zylZ docker-test-volume]# clear</span><br><span class="line">[root@iZc3ncrhf90zylZ docker-test-volume]# vim dockerfile01</span><br><span class="line">FROM centos</span><br><span class="line">VOLUME [&quot;/dataVolumeContainer1&quot;,&quot;/dataVolumeContainer2&quot;]</span><br><span class="line">CMD echo &quot;-------end------&quot;</span><br><span class="line">CMD /bin/bash</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">3、build后生成镜像，获得一个新镜像</span></span><br><span class="line">[root@iZc3ncrhf90zylZ docker-test-volume]# docker build -f /home/docker-test-volume/dockerfile01 -t centos_op:1.0 .</span><br><span class="line"></span><br><span class="line">[root@iZc3ncrhf90zylZ docker-test-volume]# docker run -it centos_op:1.0</span><br><span class="line">[root@9827179b0667 /]# ls -l</span><br><span class="line">total 56</span><br><span class="line">lrwxrwxrwx   1 root root    7 Nov  3  2020 bin -&gt; usr/bin</span><br><span class="line">drwxr-xr-x   2 root root 4096 Mar 19 10:02 dataVolumeContainer</span><br><span class="line">drwxr-xr-x   2 root root 4096 Mar 19 10:02 dataVolumeContainer1</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">问题:通过上述步骤，容器内的卷目录地址就已经知道了，但是对应的主机目录地址在哪里呢？</span></span><br><span class="line">[root@iZc3ncrhf90zylZ volumes]# docker inspect 9827179b0667</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查看volumes</span></span><br><span class="line">&quot;Mounts&quot;: [</span><br><span class="line">            &#123;</span><br><span class="line">                &quot;Type&quot;: &quot;volume&quot;,</span><br><span class="line">                &quot;Name&quot;: &quot;497b7dbcc55b65d68034b0995bdb513ed235439283eebc16061038ad83dc3328&quot;,</span><br><span class="line">                &quot;Source&quot;: &quot;/var/lib/docker/volumes/497b7dbcc55b65d68034b0995bdb513ed235439283eebc16061038ad83dc3328/_data&quot;,</span><br><span class="line">                &quot;Destination&quot;: &quot;/dataVolumeContainer1&quot;,</span><br><span class="line">                &quot;Driver&quot;: &quot;local&quot;,</span><br><span class="line">                &quot;Mode&quot;: &quot;&quot;,</span><br><span class="line">                &quot;RW&quot;: true,</span><br><span class="line">                &quot;Propagation&quot;: &quot;&quot;</span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">                &quot;Type&quot;: &quot;volume&quot;,</span><br><span class="line">                &quot;Name&quot;: &quot;43abd3237309540f73e0a7a121070c08ca075f416da0959efc36e56530a0a0a2&quot;,</span><br><span class="line">                &quot;Source&quot;: &quot;/var/lib/docker/volumes/43abd3237309540f73e0a7a121070c08ca075f416da0959efc36e56530a0a0a2/_data&quot;,</span><br><span class="line">                &quot;Destination&quot;: &quot;/dataVolumeContainer&quot;,</span><br><span class="line">                &quot;Driver&quot;: &quot;local&quot;,</span><br><span class="line">                &quot;Mode&quot;: &quot;&quot;,</span><br><span class="line">                &quot;RW&quot;: true,</span><br><span class="line">                &quot;Propagation&quot;: &quot;&quot;</span><br><span class="line">            &#125;</span><br><span class="line">        ],</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">容器数据卷在主机对应位置：</span></span><br><span class="line">/var/lib/docker/volumes/</span><br></pre></td></tr></table></figure><p></p><p>注意：如果访问出现了 cannot open dirctory:Permission denied</p><p>解决方法： 在挂载目录后多加一个 --privileged=true 即可</p><h3 id="匿名和具名挂载"><a class="anchor" href="#匿名和具名挂载">#</a> 匿名和具名挂载</h3><p></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">匿名挂载</span></span><br><span class="line">-v 容器内路径</span><br><span class="line">docker run -d -P --name nginx01 -v /etc/nginx nginx</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">匿名挂载的缺点，不好维护，通常使用命令 docker volume维护</span></span><br><span class="line">docker volume ls</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">具名挂载</span></span><br><span class="line">-v 卷名:/容器内路径</span><br><span class="line">docker run -d -P --name nginx02 -v nginxconfig：/etc/nginx nginx</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查看挂载路径</span></span><br><span class="line">docker volume inspect nginxconfig</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">测试</span></span><br><span class="line">[root@iZc3ncrhf90zylZ ~]# docker volume inspect nginxconfig</span><br><span class="line">[</span><br><span class="line">    &#123;</span><br><span class="line">    	#创建时间</span><br><span class="line">        &quot;CreatedAt&quot;: &quot;2022-03-19T16:03:49+08:00&quot;,</span><br><span class="line">        &quot;Driver&quot;: &quot;local&quot;,</span><br><span class="line">        &quot;Labels&quot;: null,</span><br><span class="line">        &quot;Mountpoint&quot;: &quot;/var/lib/docker/volumes/nginxconfig/_data&quot;,</span><br><span class="line">        &quot;Name&quot;: &quot;nginxconfig&quot;,</span><br><span class="line">        &quot;Options&quot;: null,</span><br><span class="line">        &quot;Scope&quot;: &quot;local&quot;</span><br><span class="line">    &#125;</span><br><span class="line">]</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">判断挂载的是卷名而不是本机目录名？</span></span><br><span class="line">不是：开始就是卷名</span><br><span class="line">是：开始就是目录名</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">改变文件读写权限</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">ro：只读		rw：读写</span></span><br><span class="line">例子；</span><br><span class="line">docker run -d -P --name nginx02 -v nginxconfig:/etc/nginx:ro nginx</span><br></pre></td></tr></table></figure><p></p><h3 id="数据卷容器"><a class="anchor" href="#数据卷容器">#</a> 数据卷容器</h3><p>命名的容器挂载数据卷，其他容器通过这个父容器实现数据共享，挂载数据卷容器，称之为数据卷容器</p><p>我们使用上一步的 centos_op 为镜像，运行容器 docker01，docker02，docker02，他们都有容器数据卷：/datavolumContainer1 和 /datavolumContainer2</p><p>使用 <code>--volumes-from</code> 进行共享数据</p><p>退出不停止： <code>ctrl + P + Q</code></p><ol><li>先启动一个父容器 docker01，然后在 dataVolumeContainer2 新增文件</li><li>创建 docker02，docker03 让他们继承 docker01 <code>--volumes-from</code></li><li>回到 docker01 发现可以看到 02 和 03 添加的共享文件</li><li>删除 docker01，docker02 修改后 docker03 还能不能访问</li><li>删除 docker02 ，docker03 还能不能访问</li><li>新建 docker04 继承 docker03，然后再删除 docker03，看下是否可以访问！</li></ol><p>得出结论：<br>容器之间配置信息的传递，数据卷的生命周期一直持续到没有容器使用它为止。<br>存储在本机的文件则会一直保留！</p><h2 id="dockerfile"><a class="anchor" href="#dockerfile">#</a> DockerFile</h2><p>大家想想，Nginx，tomcat，mysql 这些镜像都是哪里来的？</p><p>流程：开发应用 --&gt;DockerFile==&gt; 上传到仓库（私有仓库，公有仓库）=&gt; 下载镜像 =&gt; 启动运行</p><h3 id="什么是dockerfile"><a class="anchor" href="#什么是dockerfile">#</a> 什么是 DockerFile</h3><p>dockerfile 是用来构建 Docker 镜像的构建文件，是由一系列命令和参数构成的脚本。</p><p>构建步骤：</p><ol><li>编写 DockerFile 文件</li><li>docker build 构建镜像</li><li>docker run</li></ol><p>dockerfile 文件我们刚才已经编写过了一次，这里我们继续使用 centos 来看！</p><h3 id="dockerfile构建过程"><a class="anchor" href="#dockerfile构建过程">#</a> DockerFile 构建过程</h3><p><strong>基础知识：</strong></p><ol><li>每条保留字都必须为大写字母且后端要跟随至少一个参数</li><li>指令按照从上到下，顺序执行</li><li>#表示注释</li><li>每条指令都会创建一个新的镜像层，并对镜像进行提交</li></ol><p><strong>流程：</strong></p><ol><li>docker 从基础镜像运行一个容器</li><li>执行一条指令并对容器做出修改</li><li>执行类似 docker commit 的操作提交一个新的镜像层</li><li>Docker 再基于刚提交的镜像运行一个新容器</li><li>执行 dockerfile 中的下一条指令知道所有指令都执行完成</li></ol><p><strong>说明：</strong></p><p>从应用软件的角度来看，DockerFile，docker 镜像与 docker 容器分别代表软件的三个不同阶段。</p><ul><li>DockerFile 是软件的原材料</li><li>Docker 镜像是软件的交付品</li><li>Docker 容器则是软件的运行状态</li></ul><p>DockerFIle 面向开发，Docker 镜像成为交付标准，Docker 容器则涉及部署与运维，三者缺一不可。</p><p><img data-src="C:%5CUsers%5CWindlinxy%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5C1647702227780.png" alt="1647702227780"></p><p>DockerFile：需要定义一个 DockerFile，DockerFile 定义了进程需要的一切东西。DockerFile 涉及的内容包括执行代码或者是文件、环境变量、依赖包、运行时环境、动态链接库、操作系统发行版、服务进程和内核进程（当引用进行需要和系统服务和内核进程打交道，这时需要考虑如何设计 namespace 的权限控制）等等。</p><ul><li><p>Docker 镜像：在 DockerFile 定义了一个文件之后，Docker build 时会产生一个 Docker 镜像，当运行 Docker 镜像时，会真正开始提供服务；</p></li><li><p>Docker 容器：容器是直接提供服务的。</p></li></ul><h3 id="dockerfile指令"><a class="anchor" href="#dockerfile指令">#</a> DockerFile 指令</h3><p></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">FROM		# 基础镜像，当前新镜像是基于哪个镜像的</span><br><span class="line">LABEL		# 镜像维护者的姓名混合邮箱地址 </span><br><span class="line">RUN			# 容器构建时需要运行的命令</span><br><span class="line">EXPOSE		# 当前容器对外保留出的端口</span><br><span class="line">WORKDIR		# 指令在创建容器后，终端默认登录的进来工作目录，一个落脚点</span><br><span class="line">ENV			# 用来在构建镜像过程中设置环境变量</span><br><span class="line">ADD			# 将宿主机目录下的文件拷贝进镜像且ADD命令会自动处理URL和解压tar压缩包</span><br><span class="line">COPY		# 类似ADD，拷贝文件和目录到镜像中！</span><br><span class="line">VOLUME		# 容器数据卷，用于数据保存和持久化工作</span><br><span class="line">CMD			# 指定一个容器启动时要运行的命令，dockerFile中可以有多个CMD指令，但只有最后一个生效！</span><br><span class="line">ENTRYPOINT	# 指定一个容器启动时要运行的命令！和CMD一样</span><br><span class="line">ONBUILD		# 当构建一个被继承的DockerFile时运行命令，父镜像在被子镜像继承后，父镜像的ONBUILD被触发</span><br></pre></td></tr></table></figure><p></p><table><thead><tr><th style="text-align:center">BUILD</th><th style="text-align:center">Both</th><th style="text-align:center">run</th></tr></thead><tbody><tr><td style="text-align:center">FROM</td><td style="text-align:center">WORKDIR</td><td style="text-align:center">CMD</td></tr><tr><td style="text-align:center">LABEL</td><td style="text-align:center">USER</td><td style="text-align:center">ENV</td></tr><tr><td style="text-align:center">COPY</td><td style="text-align:center"></td><td style="text-align:center">EXPOSE</td></tr><tr><td style="text-align:center">ADD</td><td style="text-align:center"></td><td style="text-align:center">VOLUME</td></tr><tr><td style="text-align:center">RUN</td><td style="text-align:center"></td><td style="text-align:center">ENTRYPOINT</td></tr><tr><td style="text-align:center">ONBUILD</td><td style="text-align:center"></td><td style="text-align:center"></td></tr><tr><td style="text-align:center">.dockerignore</td><td style="text-align:center"></td><td style="text-align:center"></td></tr></tbody></table><p><strong>实战</strong></p><p>Docker Hub 中的 99% 的镜像都是通过 base 镜像（Scratch）中安装和配置需要的软件构建出来的</p><blockquote><p>自定义一个 centos</p></blockquote><p><strong>1、编写 DockerFile</strong></p><p>查看下官网默认的 CentOS 的情况：</p><p>目的，使我们自己的镜像具备如下：登录后的默认路径、vim 编辑器、查看网络配置 ifconfig 支持</p><p><strong>1、准备编写 DockerFile</strong></p><p></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">FROM centos</span><br><span class="line">LABEL &quot;com.example.vendor&quot;=&quot;ACME Incorporated&quot;</span><br><span class="line">LABEL com.example.label-with-value=&quot;foo&quot;</span><br><span class="line">LABEL version=&quot;1.0&quot;</span><br><span class="line">LABEL description=&quot;This text illustrates&quot;</span><br><span class="line">ENV MYPATH /usr/local</span><br><span class="line">WORKDIR $MYPATH</span><br><span class="line">RUN yum -y install vim   # 出错</span><br><span class="line">RUN yum -y install net-tools # 出错</span><br><span class="line">EXPOSE 80</span><br><span class="line">CMD echo $MYPATH</span><br><span class="line">CMD echo &quot;----------end--------&quot;</span><br><span class="line">CMD /bin/bash</span><br></pre></td></tr></table></figure><p></p><p><strong>2、构建</strong></p><p><code>docker build -f dockerfile地址 -t 新镜像的名字：[TAG] .</code></p><p></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@iZc3ncrhf90zylZ dockertest]# docker build -t test01:0.1 .</span><br><span class="line"></span><br></pre></td></tr></table></figure><p></p><p><strong>3、运行</strong></p><p><code>docker run -it 名字：[TAG]</code></p><p><strong>4、列出镜像的变更历史</strong></p><p><code>docekr history 镜像名</code></p><blockquote><p>CMD 和 ENTRYPOINT 的区别</p></blockquote><p>我们之前说过，两个命令都是指定一个容器启动时要运行的命令</p><p>**CMD：**Dockerfile 中可以有多个 CMD 指令，但只有最后一个生效，CMD 会被 docker run 之后的参数替换！</p><p>**ENTRYPOINT：**docker run 之后的参数会被当做参数传递给 ENTRPOINT，之后形成新的命令组合！</p><p><strong>测试：</strong></p><p>CMD 命令</p><p></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">1、构建dockerfile</span></span><br><span class="line">[root@kuangshen home]# vim dockerfile-cmd-test</span><br><span class="line">[root@kuangshen home]# cat dockerfile-cmd-test</span><br><span class="line">FROM centos</span><br><span class="line">CMD [ &quot;ls&quot;, &quot;-a&quot; ]</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">2、build 镜像</span></span><br><span class="line">[root@kuangshen home]# docker build -f dockerfile-cmd-test -t cmdtest .</span><br><span class="line">Sending build context to Docker daemon 22.02kB</span><br><span class="line">Step 1/2 : FROM centos</span><br><span class="line"><span class="meta prompt_">---&gt; </span><span class="language-bash">470671670cac</span></span><br><span class="line">Step 2/2 : CMD [ &quot;ls&quot;, &quot;-a&quot; ]</span><br><span class="line"><span class="meta prompt_">---&gt; </span><span class="language-bash">Running <span class="keyword">in</span> a3072987de38</span></span><br><span class="line">Removing intermediate container a3072987de38</span><br><span class="line"><span class="meta prompt_">---&gt; </span><span class="language-bash">554bc6952657</span></span><br><span class="line">Successfully built 554bc6952657</span><br><span class="line">Successfully tagged cmdtest:latest</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">3、执行</span></span><br><span class="line">[root@kuangshen home]# docker run 554bc6952657</span><br><span class="line">.dockerenv</span><br><span class="line">bin</span><br><span class="line">dev</span><br><span class="line">etc</span><br><span class="line">home</span><br><span class="line">lib</span><br><span class="line">lib64</span><br><span class="line">......</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">4、如果我们希望用 -l 列表展示信息，我们就需要加上 -l参数</span></span><br><span class="line">[root@kuangshen home]# docker run cmdtest -l</span><br><span class="line">docker: Error response from daemon: OCI runtime create failed:</span><br><span class="line">container_linux.go:349: starting container process caused &quot;exec: \&quot;-l\&quot;:</span><br><span class="line">executable file not found in $PATH&quot;: unknown.</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">问题：我们可以看到可执行文件找不到的报错，executable file not found。</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">之前我们说过，跟在镜像名后面的是 <span class="built_in">command</span>，运行时会替换 CMD 的默认值。</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">因此这里的 -l 替换了原来的 CMD，而不是添加在原来的 <span class="built_in">ls</span> -a 后面。而 -l 根本不是命令，所</span></span><br><span class="line">以自然找不到。</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">那么如果我们希望加入 -l 这参数，我们就必须重新完整的输入这个命令：</span></span><br><span class="line">docker run cmdtest ls -al</span><br><span class="line"></span><br></pre></td></tr></table></figure><p></p><p><strong>ENTRYPOINT</strong></p><p></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">1、构建dockerfile</span></span><br><span class="line">[root@kuangshen home]# vim dockerfile-entrypoint-test</span><br><span class="line">[root@kuangshen home]# cat dockerfile-entrypoint-test</span><br><span class="line">FROM centos</span><br><span class="line">ENTRYPOINT [ &quot;ls&quot;, &quot;-a&quot; ]</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">2、build 镜像</span></span><br><span class="line">[root@kuangshen home]# docker build -f dockerfile-entrypoint-test -t</span><br><span class="line">entrypointtest .</span><br><span class="line">Sending build context to Docker daemon 23.04kB</span><br><span class="line">Step 1/2 : FROM centos</span><br><span class="line"><span class="meta prompt_">---&gt; </span><span class="language-bash">470671670cac</span></span><br><span class="line">Step 2/2 : ENTRYPOINT [ &quot;ls&quot;, &quot;-a&quot; ]</span><br><span class="line"><span class="meta prompt_">---&gt; </span><span class="language-bash">Running <span class="keyword">in</span> bac4ae055630</span></span><br><span class="line">Removing intermediate container bac4ae055630</span><br><span class="line"><span class="meta prompt_">---&gt; </span><span class="language-bash">ae07199f9144</span></span><br><span class="line">Successfully built ae07199f9144</span><br><span class="line">Successfully tagged entrypointtest:latest</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">3、执行</span></span><br><span class="line">[root@kuangshen home]# docker run ae07199f9144</span><br><span class="line">.dockerenv</span><br><span class="line">bin</span><br><span class="line">dev</span><br><span class="line">etc</span><br><span class="line">home</span><br><span class="line">lib</span><br><span class="line">lib64</span><br><span class="line">......</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">4、测试-l参数，发现可以直接使用，这里就是一种追加，我们可以明显的知道 CMD 和</span></span><br><span class="line">ENTRYPOINT 的区别了</span><br><span class="line">[root@kuangshen home]# docker run entrypointtest -l</span><br><span class="line">total 56</span><br><span class="line">drwxr-xr-x 1 root root 4096 May 12 04:21 .</span><br><span class="line">drwxr-xr-x 1 root root 4096 May 12 04:21 ..</span><br><span class="line">-rwxr-xr-x 1 root root 0 May 12 04:21 .dockerenv</span><br><span class="line">lrwxrwxrwx 1 root root 7 May 11 2019 bin -&gt; usr/bin</span><br><span class="line">drwxr-xr-x 5 root root 340 May 12 04:21 dev</span><br><span class="line">drwxr-xr-x 1 root root 4096 May 12 04:21 etc</span><br><span class="line">drwxr-xr-x 2 root root 4096 May 11 2019 home</span><br><span class="line">.....</span><br></pre></td></tr></table></figure><p></p><blockquote><p>自定义镜像 tomcat</p></blockquote><ol><li><code>mkdir -p myuser/build/tomcat_self</code></li><li>在目录下 touch read.txt</li><li>将 JDK 和 tomcat 安装的压缩包拷贝进上一步目录</li><li>在 myuser/build/tomcat_self 目录下新建 Dockerfile 文件</li></ol><p></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">[root@iZc3ncrhf90zylZ tomcat_self]# cat Dockerfile </span><br><span class="line">FROM centos</span><br><span class="line">LABEL version=&quot;1.0&quot;</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">把宿主机当前上下文的read.txt拷贝到容器/usr/local/路径下</span></span><br><span class="line">COPY read.txt /usr/local/cincontainer.txt</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">把java与tomcat添加到容器中</span></span><br><span class="line">ADD apache-tomcat-8.5.59.tar.gz /usr/local</span><br><span class="line">ADD openlogic-openjdk-jre-8u262-b10-linux-x64.tar.gz /usr/local</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">设置工作访问时候的WORKDIR路径，登录落脚点</span></span><br><span class="line">ENV MYPATH /usr/local</span><br><span class="line">WORKDIR $MYPATH</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">配置java与tomcat环境变量</span></span><br><span class="line">ENV JAVA_HOME /usr/local/openlogic-openjdk-jre-8u262-b10-linux-64</span><br><span class="line">ENV CLASSPATH $JAVA_HOME/lib/dt.jar:$JAVA_HOME/lib/tools.jar</span><br><span class="line">ENV CATALINA_HOME /usr/local/apache-tomcat-8.5.59</span><br><span class="line">ENV CATALINA_BASE /usr/local/apache-tomcat-8.5.59</span><br><span class="line">ENV PATH $PATH:$JAVA_HOME/bin:$CATALINA_HOME/lib:$CATALINA_HOME/bin</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">容器运行时监听的端口</span></span><br><span class="line">EXPOSE 8080</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">启动时运行tomcat</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">ENTRYPOINT [<span class="string">&quot;/usr/local/apache-tomcat-9.0.22/bin/startup.sh&quot;</span> ]</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">CMD [<span class="string">&quot;/usr/local/apache-tomcat-9.0.22/bin/catalina.sh&quot;</span>,<span class="string">&quot;run&quot;</span>]</span></span><br><span class="line">CMD /usr/local/apache-tomcat-8.5.59/bin/startup.sh &amp;&amp; tail -F /usr/local/apache-tocamt-8.5.59/bin/logs/catalina.out</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">测试</span></span><br><span class="line">[root@iZc3ncrhf90zylZ tomcat_self]# docker run -it -p 8080:8080 --name tomcat02 tomcat_self /bin/bash</span><br><span class="line"></span><br></pre></td></tr></table></figure><p></p><p><strong>5、构建镜像</strong></p><p><strong>6、运行启动 run</strong></p><p></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">docker run -d -p 9090:8080 --name mydiytomcat -v \</span><br><span class="line">/home/dockertest/build/tomcat/test:/usr/local/apache-tomcat-9.0.22/webapps/test -v \</span><br><span class="line">/home/dockertest/build/tomcat/tomcat9logs/:/usr/local/apache-tomcat-9.0.22/logs --priviledged=true diytomcat</span><br></pre></td></tr></table></figure><p></p><p>备注：Docker 挂载主机目录 Docker 访问出现 cannot open directory .: Permission denied<br>解决办法：在挂载目录后多加一个 --privileged=true 参数即可</p><p><strong>7、验证测试访问 curl localhost:9090</strong></p><p><strong>8、结合前面学习的容器卷将测试的 web 服务 test 发布</strong></p><h3 id="发布镜像"><a class="anchor" href="#发布镜像">#</a> 发布镜像</h3><h4 id="dockerhub"><a class="anchor" href="#dockerhub">#</a> DockerHub</h4><p>注册 dockerhub <span class="exturl" data-url="aHR0cHM6Ly9odWIuZG9ja2VyLmNvbS8=">https://hub.docker.com/</span></p><p></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">1、查看登录命令[root@iZc3ncrhf90zylZ tomcat_self]#  docker login --<span class="built_in">help</span></span></span><br><span class="line"></span><br><span class="line">Usage:  docker login [OPTIONS] [SERVER]</span><br><span class="line"></span><br><span class="line">Log in to a Docker registry.</span><br><span class="line">If no server is specified, the default is defined by the daemon.</span><br><span class="line"></span><br><span class="line">Options:</span><br><span class="line">  -p, --password string   Password</span><br><span class="line">      --password-stdin    Take the password from stdin</span><br><span class="line">  -u, --username string   Username</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">2、登录</span></span><br><span class="line">[root@iZc3ncrhf90zylZ tomcat_self]# docker login -u yourname</span><br><span class="line">Password: </span><br><span class="line">WARNING! Your password will be stored unencrypted in /root/.docker/config.json.</span><br><span class="line">Configure a credential helper to remove this warning. See</span><br><span class="line">https://docs.docker.com/engine/reference/commandline/login/#credentials-store</span><br><span class="line"></span><br><span class="line">Login Succeeded</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">3、将镜像发布到自己账号下（注意要将镜像名进行修改为 yourname/image）</span></span><br><span class="line">docker push kuangshen/diytomcat:1.0</span><br></pre></td></tr></table></figure><p></p><h4 id="阿里云镜像"><a class="anchor" href="#阿里云镜像">#</a> 阿里云镜像</h4><ol><li>登录阿里云</li><li>找到容器镜像服务</li><li>创建命名空间</li><li>创建镜像仓库</li><li>测试推送发布</li><li>在阿里云查看镜像效果</li></ol><h2 id="总结"><a class="anchor" href="#总结">#</a> 总结</h2><p><img data-src="https://raw.githubusercontent.com/Windlinxy/Typora-img/main/img/image-20220322154032494.png" alt="image-20220322154032494"></p><div class="tags"><a href="/tags/%E5%B7%A5%E5%85%B7/" rel="tag"><i class="ic i-tag"></i> 工具</a> <a href="/tags/%E5%90%8E%E7%AB%AF/" rel="tag"><i class="ic i-tag"></i> 后端</a> <a href="/tags/%E6%9C%8D%E5%8A%A1%E5%99%A8/" rel="tag"><i class="ic i-tag"></i> 服务器</a> <a href="/tags/Docker/" rel="tag"><i class="ic i-tag"></i> Docker</a></div></div><footer><div class="meta"><span class="item"><span class="icon"><i class="ic i-calendar-check"></i> </span><span class="text">更新于</span> <time title="修改时间：2023-03-06 16:11:21" itemprop="dateModified" datetime="2023-03-06T16:11:21+08:00">2023-03-06</time> </span><span id="2022/03/22/b53d308f67cd/" class="item leancloud_visitors" data-flag-title="Docker学习与实践" title="阅读次数"><span class="icon"><i class="ic i-eye"></i> </span><span class="text">阅读次数</span> <span class="leancloud-visitors-count"></span> <span class="text">次</span> </span><span id="busuanzi_container_page_pv">本文阅读量:<span id="busuanzi_value_page_pv"></span></span></div><div class="reward"><button><i class="ic i-heartbeat"></i> 赞赏</button><p>请我喝[茶]~(￣▽￣)~*</p><div id="qr"><div><img data-src="/images/wechatpay.png" alt="Windlinxy 微信支付"><p>微信支付</p></div><div><img data-src="/images/alipay.png" alt="Windlinxy 支付宝"><p>支付宝</p></div></div></div><div id="copyright"><ul><li class="author"><strong>本文作者： </strong>Windlinxy <i class="ic i-at"><em>@</em></i>沨临</li><li class="link"><strong>本文链接：</strong> <a href="https://windlinxy.top/2022/03/22/b53d308f67cd/" title="Docker学习与实践">https://windlinxy.top/2022/03/22/b53d308f67cd/</a></li><li class="license"><strong>版权声明： </strong>本站所有文章除特别声明外，均采用 <span class="exturl" data-url="aHR0cHM6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL2xpY2Vuc2VzL2J5LW5jLXNhLzQuMC9kZWVkLnpo"><i class="ic i-creative-commons"><em>(CC)</em></i>BY-NC-SA</span> 许可协议。转载请注明出处！</li></ul></div></footer></article></div><div class="post-nav"><div class="item left"><a href="/2022/02/16/3f45b94abd7d/" itemprop="url" rel="prev" data-background-image="https:&#x2F;&#x2F;virgil-civil-1311056353.cos.ap-shanghai.myqcloud.com&#x2F;img&#x2F;20230724204246.png" title="SpringBoot学习"><span class="type">上一篇</span> <span class="category"><i class="ic i-flag"></i> 学习笔记</span><h3>SpringBoot学习</h3></a></div><div class="item right"><a href="/2022/03/29/a3ce6e1055e0/" itemprop="url" rel="next" data-background-image="https:&#x2F;&#x2F;virgil-civil-1311056353.cos.ap-shanghai.myqcloud.com&#x2F;img&#x2F;yst-blog-bg18.jpg" title="Hexo搭建博客回顾"><span class="type">下一篇</span> <span class="category"><i class="ic i-flag"></i> 学习笔记</span><h3>Hexo搭建博客回顾</h3></a></div></div><div class="wrap" id="comments"></div></div><div id="sidebar"><div class="inner"><div class="panels"><div class="inner"><div class="contents panel pjax" data-title="文章目录"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#docker%E5%AD%A6%E4%B9%A0"><span class="toc-number">1.</span> <span class="toc-text">Docker 学习</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#docker%E6%A6%82%E8%BF%B0"><span class="toc-number">1.1.</span> <span class="toc-text">Docker 概述</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%80%E8%88%AC%E7%9A%84%E8%99%9A%E6%8B%9F%E6%9C%BA"><span class="toc-number">1.1.1.</span> <span class="toc-text">一般的虚拟机</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%B9%E5%99%A8%E5%8C%96%E6%8A%80%E6%9C%AF"><span class="toc-number">1.1.2.</span> <span class="toc-text">容器化技术</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%89%E8%A3%85%E6%AD%A5%E9%AA%A4"><span class="toc-number">1.2.</span> <span class="toc-text">安装步骤</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%98%BF%E9%87%8C%E4%BA%91%E9%95%9C%E5%83%8F%E5%8A%A0%E9%80%9F"><span class="toc-number">1.2.1.</span> <span class="toc-text">阿里云镜像加速</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#run%E5%91%BD%E4%BB%A4"><span class="toc-number">1.2.2.</span> <span class="toc-text">run 命令</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86"><span class="toc-number">1.3.</span> <span class="toc-text">底层原理</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#docker%E6%98%AF%E6%80%8E%E4%B9%88%E5%B7%A5%E4%BD%9C%E7%9A%84"><span class="toc-number">1.3.0.1.</span> <span class="toc-text">Docker 是怎么工作的</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%BA%E4%BB%80%E4%B9%88docker%E6%AF%94%E8%BE%83vm%E5%BF%AB"><span class="toc-number">1.3.0.2.</span> <span class="toc-text">为什么 Docker 比较 VM 快</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#docker%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4"><span class="toc-number">1.4.</span> <span class="toc-text">Docker 常用命令</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B8%AE%E5%8A%A9%E5%91%BD%E4%BB%A4"><span class="toc-number">1.4.1.</span> <span class="toc-text">帮助命令</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%95%9C%E5%83%8F%E5%91%BD%E4%BB%A4"><span class="toc-number">1.4.2.</span> <span class="toc-text">镜像命令</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%B9%E5%99%A8%E5%91%BD%E4%BB%A4"><span class="toc-number">1.4.3.</span> <span class="toc-text">容器命令</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B8%B8%E7%94%A8%E5%85%B6%E4%BB%96%E5%91%BD%E4%BB%A4"><span class="toc-number">1.4.4.</span> <span class="toc-text">常用其他命令</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B0%8F%E7%BB%93"><span class="toc-number">1.4.5.</span> <span class="toc-text">小结</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BB%83%E4%B9%A0"><span class="toc-number">1.4.6.</span> <span class="toc-text">练习</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%89%E8%A3%85nginx"><span class="toc-number">1.4.6.1.</span> <span class="toc-text">安装 Nginx</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%89%E8%A3%85tomcat"><span class="toc-number">1.4.6.2.</span> <span class="toc-text">安装 tomcat</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%AF%E8%A7%86%E5%8C%96%E9%9D%A2%E6%9D%BF"><span class="toc-number">1.4.7.</span> <span class="toc-text">可视化面板</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#docker%E9%95%9C%E5%83%8F%E8%AE%B2%E8%A7%A3"><span class="toc-number">1.5.</span> <span class="toc-text">Docker 镜像讲解</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%95%9C%E5%83%8F%E6%98%AF%E4%BB%80%E4%B9%88"><span class="toc-number">1.5.1.</span> <span class="toc-text">镜像是什么</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#docker%E9%95%9C%E5%83%8F%E5%8A%A0%E8%BD%BD%E5%8E%9F%E7%90%86"><span class="toc-number">1.5.2.</span> <span class="toc-text">Docker 镜像加载原理</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#unionfs%E8%81%94%E5%90%88%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F"><span class="toc-number">1.5.2.1.</span> <span class="toc-text">UnionFs（联合文件系统）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#docker%E9%95%9C%E5%83%8F%E5%8A%A0%E8%BD%BD%E5%8E%9F%E7%90%86-2"><span class="toc-number">1.5.2.2.</span> <span class="toc-text">Docker 镜像加载原理</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%86%E5%B1%82%E7%90%86%E8%A7%A3"><span class="toc-number">1.5.3.</span> <span class="toc-text">分层理解</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%86%E5%B1%82%E7%9A%84%E9%95%9C%E5%83%8F"><span class="toc-number">1.5.3.1.</span> <span class="toc-text">分层的镜像</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%89%B9%E7%82%B9"><span class="toc-number">1.5.4.</span> <span class="toc-text">特点</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%95%9C%E5%83%8Fcommit"><span class="toc-number">1.5.5.</span> <span class="toc-text">镜像 Commit</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%B9%E5%99%A8%E6%95%B0%E6%8D%AE%E5%8D%B7"><span class="toc-number">1.6.</span> <span class="toc-text">容器数据卷</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%80%E4%B9%88%E6%98%AF%E5%AE%B9%E5%99%A8%E6%95%B0%E6%8D%AE%E5%8D%B7"><span class="toc-number">1.6.1.</span> <span class="toc-text">什么是容器数据卷</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E6%95%B0%E6%8D%AE%E5%8D%B7"><span class="toc-number">1.6.2.</span> <span class="toc-text">使用数据卷</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8docker%E5%AE%89%E8%A3%85mysql"><span class="toc-number">1.6.3.</span> <span class="toc-text">使用 docker 安装 mysql</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%80%9A%E8%BF%87docker-file%E6%9D%A5%E6%B7%BB%E5%8A%A0%E4%BA%86%E8%A7%A3"><span class="toc-number">1.6.4.</span> <span class="toc-text">通过 Docker File 来添加（了解）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8C%BF%E5%90%8D%E5%92%8C%E5%85%B7%E5%90%8D%E6%8C%82%E8%BD%BD"><span class="toc-number">1.6.5.</span> <span class="toc-text">匿名和具名挂载</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E5%8D%B7%E5%AE%B9%E5%99%A8"><span class="toc-number">1.6.6.</span> <span class="toc-text">数据卷容器</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#dockerfile"><span class="toc-number">1.7.</span> <span class="toc-text">DockerFile</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%80%E4%B9%88%E6%98%AFdockerfile"><span class="toc-number">1.7.1.</span> <span class="toc-text">什么是 DockerFile</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#dockerfile%E6%9E%84%E5%BB%BA%E8%BF%87%E7%A8%8B"><span class="toc-number">1.7.2.</span> <span class="toc-text">DockerFile 构建过程</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#dockerfile%E6%8C%87%E4%BB%A4"><span class="toc-number">1.7.3.</span> <span class="toc-text">DockerFile 指令</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%91%E5%B8%83%E9%95%9C%E5%83%8F"><span class="toc-number">1.7.4.</span> <span class="toc-text">发布镜像</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#dockerhub"><span class="toc-number">1.7.4.1.</span> <span class="toc-text">DockerHub</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%98%BF%E9%87%8C%E4%BA%91%E9%95%9C%E5%83%8F"><span class="toc-number">1.7.4.2.</span> <span class="toc-text">阿里云镜像</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%80%BB%E7%BB%93"><span class="toc-number">1.8.</span> <span class="toc-text">总结</span></a></li></ol></div><div class="related panel pjax" data-title="系列文章"><ul><li><a href="/2021/08/22/9fa2c19d8a5c/" rel="bookmark" title="Git学习">Git学习</a></li><li><a href="/2021/08/22/6cc698283cd3/" rel="bookmark" title="Redis学习与基本使用">Redis学习与基本使用</a></li><li><a href="/2022/02/16/3f45b94abd7d/" rel="bookmark" title="SpringBoot学习">SpringBoot学习</a></li><li class="active"><a href="/2022/03/22/b53d308f67cd/" rel="bookmark" title="Docker学习与实践">Docker学习与实践</a></li><li><a href="/2022/03/29/a3ce6e1055e0/" rel="bookmark" title="Hexo搭建博客回顾">Hexo搭建博客回顾</a></li><li><a href="/2022/04/03/efd1fe65915b/" rel="bookmark" title="Nginx学习">Nginx学习</a></li><li><a href="/2022/04/18/fa3fe09e66a1/" rel="bookmark" title="Lambda表达式学习">Lambda表达式学习</a></li><li><a href="/2022/04/19/b3855c64b8fb/" rel="bookmark" title="Optional使用">Optional使用</a></li><li><a href="/2022/04/20/be5fe109faf5/" rel="bookmark" title="函数式接口与方法引用">函数式接口与方法引用</a></li><li><a href="/2022/06/27/4318463f9256/" rel="bookmark" title="RabbitMQ学习_01">RabbitMQ学习_01</a></li><li><a href="/2022/06/30/712cede46373/" rel="bookmark" title="RabbitMQ学习_02">RabbitMQ学习_02</a></li><li><a href="/2022/10/04/8787e59dc4ea/" rel="bookmark" title="JUC:线程与进程">JUC:线程与进程</a></li><li><a href="/2022/11/16/32e7bb3553da/" rel="bookmark" title="IO模型">IO模型</a></li><li><a href="/2022/11/17/b73eedab4ef3/" rel="bookmark" title="NIO的一些问题">NIO的一些问题</a></li><li><a href="/2023/01/21/6c40bdfa1892/" rel="bookmark" title="java注解">java注解</a></li><li><a href="/2023/02/28/48a59f7d755c/" rel="bookmark" title="Springboot自动装配">Springboot自动装配</a></li><li><a href="/2023/03/01/fa472e2adb8b/" rel="bookmark" title="一些模板代码">一些模板代码</a></li><li><a href="/2023/08/17/625794741ec0/" rel="bookmark" title="Git常用">Git常用</a></li><li><a href="/2023/09/12/324da08a924e/" rel="bookmark" title="ADB总结">ADB总结</a></li></ul></div><div class="overview panel" data-title="站点概览"><div class="author" itemprop="author" itemscope itemtype="http://schema.org/Person"><img class="image" itemprop="image" alt="Windlinxy" data-src="/images/windlinxy.jpg"><p class="name" itemprop="name">Windlinxy</p><div class="description" itemprop="description">后端 CS 技术博客</div></div><nav class="state"><div class="item posts"><a href="/archives/"><span class="count">31</span> <span class="name">文章</span></a></div><div class="item categories"><a href="/categories/"><span class="count">5</span> <span class="name">分类</span></a></div><div class="item tags"><a href="/tags/"><span class="count">33</span> <span class="name">标签</span></a></div></nav><div class="social"><span class="exturl item github" data-url="aHR0cHM6Ly9naXRodWIuY29tL3dpbmRsaW54eQ==" title="https:&#x2F;&#x2F;github.com&#x2F;windlinxy"><i class="ic i-github"></i></span> <span class="exturl item zhihu" data-url="aHR0cHM6Ly93d3cuemhpaHUuY29tL3Blb3BsZS9mZW5nLWxpbi0yMy00NQ==" title="https:&#x2F;&#x2F;www.zhihu.com&#x2F;people&#x2F;feng-lin-23-45"><i class="ic i-zhihu"></i></span> <span class="exturl item email" data-url="bWFpbHRvOndpbmRsaW54eUAxNjMuY29t" title="mailto:windlinxy@163.com"><i class="ic i-envelope"></i></span></div><ul class="menu"><li class="item"><a href="/" rel="section"><i class="ic i-home"></i>首页</a></li><li class="item"><a href="/about/" rel="section"><i class="ic i-user"></i>关于</a></li><li class="item dropdown"><a href="javascript:void(0);"><i class="ic i-feather"></i>文章</a><ul class="submenu"><li class="item"><a href="/archives/" rel="section"><i class="ic i-list-alt"></i>归档</a></li><li class="item"><a href="/categories/" rel="section"><i class="ic i-th"></i>分类</a></li><li class="item"><a href="/tags/" rel="section"><i class="ic i-tags"></i>标签</a></li></ul></li><li class="item"><a href="/friends/" rel="section"><i class="ic i-heart"></i>友链</a></li><li class="item"><a href="/links/" rel="section"><i class="ic i-magic"></i>网址</a></li></ul></div></div></div><ul id="quick"><li class="prev pjax"><a href="/2022/02/16/3f45b94abd7d/" rel="prev" title="上一篇"><i class="ic i-chevron-left"></i></a></li><li class="up"><i class="ic i-arrow-up"></i></li><li class="down"><i class="ic i-arrow-down"></i></li><li class="next pjax"><a href="/2022/03/29/a3ce6e1055e0/" rel="next" title="下一篇"><i class="ic i-chevron-right"></i></a></li><li class="percent"></li></ul></div></div><div class="dimmer"></div></div></main><footer id="footer"><div class="inner"><div class="widgets"><div class="rpost pjax"><h2>随机文章</h2><ul><li class="item"><div class="breadcrumb"><a href="/categories/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" title="分类于 学习笔记">学习笔记</a></div><span><a href="/2022/04/19/b3855c64b8fb/" title="Optional使用">Optional使用</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" title="分类于 学习笔记">学习笔记</a> <i class="ic i-angle-right"></i> <a href="/categories/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/Android/" title="分类于 Android">Android</a></div><span><a href="/2023/09/12/324da08a924e/" title="ADB总结">ADB总结</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" title="分类于 学习笔记">学习笔记</a></div><span><a href="/2022/02/16/3f45b94abd7d/" title="SpringBoot学习">SpringBoot学习</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" title="分类于 学习笔记">学习笔记</a></div><span><a href="/2021/08/22/9fa2c19d8a5c/" title="Git学习">Git学习</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/LeetCode%E5%88%B7%E9%A2%98/" title="分类于 LeetCode刷题">LeetCode刷题</a></div><span><a href="/2023/03/24/89bec373c8e7/" title="回文串相关-LeetCode刷题">回文串相关-LeetCode刷题</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" title="分类于 学习笔记">学习笔记</a></div><span><a href="/2023/08/17/625794741ec0/" title="Git常用">Git常用</a></span></li><li class="item"><div class="breadcrumb"></div><span><a href="/2022/03/31/363f23cead54/" title="博客日志">博客日志</a></span></li><li class="item"><div class="breadcrumb"></div><span><a href="/2023/06/27/3f6a96d10637/" title="读《redis设计与实现》">读《redis设计与实现》</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" title="分类于 学习笔记">学习笔记</a></div><span><a href="/2022/04/18/fa3fe09e66a1/" title="Lambda表达式学习">Lambda表达式学习</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/LeetCode%E5%88%B7%E9%A2%98/" title="分类于 LeetCode刷题">LeetCode刷题</a></div><span><a href="/2023/03/02/e88df4d29e80/" title="3月2日LeetCode刷题">3月2日LeetCode刷题</a></span></li></ul></div><div><h2>最新评论</h2><ul class="leancloud-recent-comment"></ul></div></div><div class="status"><div class="copyright">&copy; 2022 – <span itemprop="copyrightYear">2024</span> <span class="with-love"><i class="ic i-sakura rotate"></i> </span><span class="author" itemprop="copyrightHolder">Windlinxy @ Windlinxy's Blog</span></div><div class="count"><span class="post-meta-item-icon"><i class="ic i-chart-area"></i> </span><span title="站点总字数">173k 字</span> <span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="ic i-coffee"></i> </span><span title="站点阅读时长">2:38</span><br><i class="ic i-clock" aria-hidden="true"></i> <span id="time"></span><script>function createtime(){var n=new Date("2022-3-27 14:30:00");now.setTime(now.getTime()+250),days=(now-n)/1e3/60/60/24,dnum=Math.floor(days),hours=(now-n)/1e3/60/60-24*dnum,hnum=Math.floor(hours),1==String(hnum).length&&(hnum="0"+hnum),minutes=(now-n)/1e3/60-1440*dnum-60*hnum,mnum=Math.floor(minutes),1==String(mnum).length&&(mnum="0"+mnum),seconds=(now-n)/1e3-86400*dnum-3600*hnum-60*mnum,snum=Math.round(seconds),1==String(snum).length&&(snum="0"+snum),document.getElementById("time").innerHTML="存活时间:"+dnum+" 天 "+hnum+" 小时 "+mnum+" 分 "+snum+" 秒 |"}var now=new Date;setInterval("createtime()",250)</script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span style="padding-left:10px"><i class="ic i-eye" aria-hidden="true"></i><span id="busuanzi_value_site_pv"></span>(<span id="busuanzi_value_site_uv"></span>) 次 |</span></div><div class="powered-by">基于 <span class="exturl" data-url="aHR0cHM6Ly9oZXhvLmlv">Hexo</span> & Theme.<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2FtZWhpbWUvaGV4by10aGVtZS1zaG9rYQ==">Shoka</span></div></div></div></footer></div><script data-config type="text/javascript">var LOCAL={path:"2022/03/22/b53d308f67cd/",favicon:{show:"（●´3｀●）最喜欢你了",hide:"(´Д｀)你要去哪！"},search:{placeholder:"文章搜索",empty:"关于 「 ${query} 」，什么也没搜到",stats:"${time} ms 内找到 ${hits} 条结果"},valine:!0,fancybox:!0,copyright:'复制成功，转载请遵守 <i class="ic i-creative-commons"></i>BY-NC-SA 协议。',ignores:[function(e){return e.includes("#")},function(e){return new RegExp(LOCAL.path+"$").test(e)}]}</script><script src="https://cdnjs.cloudflare.com/polyfill/v2/polyfill.js"></script><script src="//cdn.jsdelivr.net/combine/npm/pace-js@1.0.2/pace.min.js,npm/pjax@0.2.8/pjax.min.js,npm/whatwg-fetch@3.4.0/dist/fetch.umd.min.js,npm/animejs@3.2.0/lib/anime.min.js,npm/algoliasearch@4/dist/algoliasearch-lite.umd.js,npm/instantsearch.js@4/dist/instantsearch.production.min.js,npm/lozad@1/dist/lozad.min.js,npm/quicklink@2/dist/quicklink.umd.js"></script><script src="/js/app.js?v=0.2.5"></script></body></html><!-- rebuild by hrmmi -->