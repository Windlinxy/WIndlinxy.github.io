{
    "version": "https://jsonfeed.org/version/1",
    "title": "沨临",
    "subtitle": "记录回忆，分享经验，慢慢进步",
    "icon": "https://windlinxy.top/images/favicon.ico",
    "description": "后端 CS 技术博客",
    "home_page_url": "https://windlinxy.top",
    "items": [
        {
            "id": "https://windlinxy.top/2023/09/12/324da08a924e/",
            "url": "https://windlinxy.top/2023/09/12/324da08a924e/",
            "title": "ADB总结",
            "date_published": "2023-09-12T15:31:47.000Z",
            "content_html": "<h1 id=\"adb\"><a class=\"anchor\" href=\"#adb\">#</a> adb</h1>\n<blockquote>\n<p>ADB 是 Android Debug Bridge 的缩写，是一种用于在 Android 设备和计算机之间进行通信的命令行工具。ADB 可以用于调试和测试 Android 应用程序，以及在 Android 设备上执行各种操作，如安装和卸载应用程序、复制文件、查看设备日志等。</p>\n</blockquote>\n<h2 id=\"将adb变成全局可用命令\"><a class=\"anchor\" href=\"#将adb变成全局可用命令\">#</a> 将 adb 变成全局可用命令：</h2>\n<ol>\n<li>配置环境变量： <code>sudo gedit ~/.zshrc</code>  （注意，是使用的是哪个 shell 就编辑哪个 shell resource 文件）</li>\n<li>添加参数变量：\n<ol>\n<li>\n<pre><code class=\"language-Bash\">#Android SDK\nexport SDK_PATH=/home/Android/Sdk\nexport PATH=/home/Android/Sdk/platform-tools:$&#123;PATH&#125;\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">3. 生效配置：`source ~/.zshrc`</span><br><span class=\"line\"></span><br><span class=\"line\">另一种方法 ： 进入目录 /usr/local/bin/ ：`sudo ln -s /home/Android/Sdk/platform-tools/adb`</span><br><span class=\"line\"></span><br><span class=\"line\">*`ln`**命令：link files，为某一个文件在另外一个位置建立一个同步的链接。*</span><br><span class=\"line\"></span><br><span class=\"line\">## adb常用命令：</span><br><span class=\"line\"></span><br><span class=\"line\">- 查看连接设备：`adb devices`</span><br><span class=\"line\">- 启用交互模式：`adb shell`</span><br><span class=\"line\">- 获得系统权限：`adb root`</span><br><span class=\"line\">- 将 &#x27;/system&#x27; 部分置于可写入的模式，默认情况下 &#x27;/system&#x27; 部分是只读模式的：`adb remount`</span><br><span class=\"line\">- 文件</span><br><span class=\"line\">  - 设备文件复制到本机;</span><br><span class=\"line\">  - 本机复制到设备：</span><br><span class=\"line\">- bugreport保存位置(不指定默认是保存在手机本地目录)：`adb bugreport /home/xxx`</span><br><span class=\"line\">- 屏幕截图</span><br><span class=\"line\">  - `adb exec-out screencap -p &gt; /home/xxx/xx.png`</span><br><span class=\"line\">  - `adb shell screencap -p &gt; /home/xxx/xx.png`</span><br><span class=\"line\">- 获取当前活动的类名和包名</span><br><span class=\"line\">  -  `adb shell dumpsys window | grep mCurrentFocus`</span><br><span class=\"line\"></span><br><span class=\"line\">使用sqlite遇到的问题解决： /system目录为只读，需要  adb remount来开写权限</span><br><span class=\"line\"></span><br><span class=\"line\">```bash</span><br><span class=\"line\"># 启动交互式 shell</span><br><span class=\"line\">adb shell</span><br><span class=\"line\"># 获取系统权限</span><br><span class=\"line\">adb root</span><br><span class=\"line\"># 将 &#x27;/system&#x27; 部分置于可写入的模式，默认情况下 &#x27;/system&#x27; 部分是只读模式的。</span><br><span class=\"line\">adb remount</span><br><span class=\"line\"># 从设备中复制某个文件或目录（及其子目录）</span><br><span class=\"line\">adb pull remote local</span><br><span class=\"line\"># 将本地文件复制到设备</span><br><span class=\"line\">adb push local remote</span><br><span class=\"line\"># 截图</span><br><span class=\"line\">adb shell screencap -p &gt; /home/基础模式.png</span><br><span class=\"line\"># 安装apk </span><br><span class=\"line\">adb install -r 安装包路径</span><br></pre></td></tr></table></figure>\n\n</code></pre>\n</li>\n</ol>\n</li>\n</ol>\n<h2 id=\"工作用到的\"><a class=\"anchor\" href=\"#工作用到的\">#</a> 工作用到的</h2>\n<p><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">adb root</span><br><span class=\"line\">adb devices</span><br><span class=\"line\">adb kill-server</span><br><span class=\"line\">adb start-server</span><br><span class=\"line\">adb devices -l | grep offline | awk <span class=\"string\">&#x27;&#123;print $1&#125;&#x27;</span> | xargs -n1 adb -s <span class=\"built_in\">rm</span></span><br><span class=\"line\">adb devices -l | grep offline | xargs -n1 adb -s <span class=\"built_in\">rm</span></span><br><span class=\"line\">adb -s <span class=\"built_in\">rm</span> emu</span><br><span class=\"line\">adb -s emulator-5556 emu <span class=\"built_in\">kill</span></span><br><span class=\"line\">adb -s emulator-5556 emu <span class=\"built_in\">kill</span> -9</span><br><span class=\"line\">adb -s emulator-5556 emu <span class=\"built_in\">kill</span> emulator-5556</span><br><span class=\"line\">adb shell</span><br><span class=\"line\">adb push /usr/bin/sqlite3 /system/xbin</span><br><span class=\"line\">adb shell <span class=\"built_in\">chmod</span> 4755 /system/xbin/sqlite3</span><br><span class=\"line\">adb push /bin/sqlite3 /system/xbin</span><br><span class=\"line\">adb disable-verity</span><br><span class=\"line\">adb reboot</span><br><span class=\"line\">adb remount</span><br><span class=\"line\">adb sell pm list packages</span><br><span class=\"line\">adb shell pm list packages</span><br><span class=\"line\">adb shell pm list packages -s</span><br><span class=\"line\">adb logcat | grep -i <span class=\"string\">&quot;XXX&quot;</span></span><br><span class=\"line\">adb get-serialno</span><br><span class=\"line\">adb shell getprop ro.product.model</span><br><span class=\"line\">adb shell wm density</span><br><span class=\"line\">adb shell dumpsys -h</span><br><span class=\"line\">adb su</span><br><span class=\"line\">adb reboot bootloader</span><br><span class=\"line\">adb sevices</span><br><span class=\"line\">adb devicecs</span><br><span class=\"line\">adb shell mount -o rw,remount /system</span><br><span class=\"line\">adb push charles.0 /system/etc/security/cacerts</span><br><span class=\"line\">adb push 386e7bc3.0 /system/etc/security/cacerts</span><br><span class=\"line\">adb shell <span class=\"built_in\">ls</span> /system/etc/security/cacerts</span><br><span class=\"line\">adb shell </span><br><span class=\"line\">adb reboot </span><br><span class=\"line\">adb shelljmount -0 rw,remount /system</span><br><span class=\"line\">adb shell p, list packages -3</span><br><span class=\"line\">adb shell pm list packages -3</span><br><span class=\"line\">adb shell pm uninstall --user 0 com.android.browser</span><br><span class=\"line\">adb bugreport 1447</span><br><span class=\"line\">adb bugreport bugreport</span><br><span class=\"line\">adb bugreport bugreport-2</span><br><span class=\"line\">adb install -r jiameng.apk</span><br><span class=\"line\">adb shell dumpsys window | grep mCurrentFocus</span><br><span class=\"line\">adb install -r ./app/build/outputs/apk/debug/app-debug.apk\\n</span><br><span class=\"line\">adb uninstall -d com.tenxx.xcx</span><br><span class=\"line\">adb install -t ./toStartOf.apk</span><br><span class=\"line\">adb push ~/文档/386e7bc3.0 /system/etc/security/cacerts</span><br><span class=\"line\">adb shell am start -a android.intent.action.VIEW -d <span class=\"string\">&#x27;scheme://details?id=com.tencent.mm\\n\\n\\n&#x27;</span></span><br></pre></td></tr></table></figure></p>\n",
            "tags": [
                "学习笔记",
                "Android"
            ]
        },
        {
            "id": "https://windlinxy.top/2023/08/17/625794741ec0/",
            "url": "https://windlinxy.top/2023/08/17/625794741ec0/",
            "title": "Git常用",
            "date_published": "2023-08-17T14:55:09.000Z",
            "content_html": "<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2dlZWVlZWVlZWVrL2dpdC1yZWNpcGVzL3RyZWUvbWFzdGVyL3NvdXJjZXM=\">Git 指南</span></p>\n<h2 id=\"工作常用\"><a class=\"anchor\" href=\"#工作常用\">#</a> 工作常用</h2>\n<h3 id=\"配置\"><a class=\"anchor\" href=\"#配置\">#</a> 配置</h3>\n<p><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 配置帐户</span></span><br><span class=\"line\">git config --global user.name xxx</span><br><span class=\"line\">git config --global user.email yyy</span><br><span class=\"line\"><span class=\"comment\"># check配置是否正确</span></span><br><span class=\"line\">git config --global --list</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 把git的默认编辑器换成im</span></span><br><span class=\"line\">git config --global core.editor vim </span><br><span class=\"line\"><span class=\"comment\"># 为Git命令创建一个快捷方式（别名）</span></span><br><span class=\"line\">git config --global <span class=\"built_in\">alias</span>.&lt;alias-name&gt; &lt;git-command&gt;</span><br><span class=\"line\"><span class=\"comment\"># 定义当前机器所有用户使用命令时用到的文本编辑器，如 git commit。&lt;editor&gt; 参数用编辑器的启动命令（如 vi）替代。</span></span><br><span class=\"line\">git config --system core.editor &lt;editor&gt;</span><br><span class=\"line\"><span class=\"comment\"># 用文本编辑器打开全局配置文件，手动编辑</span></span><br><span class=\"line\">git config --global --edit</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 在指定目录下创建一个裸仓库</span></span><br><span class=\"line\">git init --bare &lt;directory&gt;</span><br></pre></td></tr></table></figure></p>\n<h3 id=\"查看\"><a class=\"anchor\" href=\"#查看\">#</a> 查看</h3>\n<p><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 查看当前git状态</span></span><br><span class=\"line\">git status</span><br><span class=\"line\"><span class=\"comment\"># 查看某次提交的内容</span></span><br><span class=\"line\">git show 提交记录<span class=\"built_in\">id</span></span><br><span class=\"line\"><span class=\"comment\"># 比较暂存区域中的文件和最新提交的文件之间的差异</span></span><br><span class=\"line\">git diff --staged</span><br><span class=\"line\"><span class=\"comment\"># 比较两个提交之间的差异。</span></span><br><span class=\"line\">git diff &lt;commit&gt; &lt;commit&gt;</span><br><span class=\"line\"><span class=\"comment\"># 比较两个分支之间的差异。</span></span><br><span class=\"line\">git diff &lt;branch&gt;..&lt;branch&gt;</span><br><span class=\"line\"><span class=\"comment\"># 查看远程分支</span></span><br><span class=\"line\">git branch -r</span><br><span class=\"line\">git checkout XXX</span><br><span class=\"line\">git remote add origin &lt;server&gt;</span><br></pre></td></tr></table></figure></p>\n<h3 id=\"还原\"><a class=\"anchor\" href=\"#还原\">#</a> 还原</h3>\n<p><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 还原工作区的文件</span></span><br><span class=\"line\">git restore filename</span><br><span class=\"line\"><span class=\"comment\"># 还原暂存区中的文件</span></span><br><span class=\"line\">git restore --staged filename</span><br><span class=\"line\"><span class=\"comment\"># 从指定的提交中还原文件：</span></span><br><span class=\"line\">git restore --<span class=\"built_in\">source</span>=HEAD-1 filename</span><br><span class=\"line\"><span class=\"comment\"># 还原整个目录</span></span><br><span class=\"line\">git restore <span class=\"built_in\">dir</span>/</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 回溯版本-回溯版本后的版本可能会丢失</span></span><br><span class=\"line\">git reset --hard df66027f00c(版本号)</span><br></pre></td></tr></table></figure></p>\n<h3 id=\"分支\"><a class=\"anchor\" href=\"#分支\">#</a> 分支</h3>\n<p><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 列出本地分支；-r 远程分支 ；-a 全部分支（本地+远程）</span></span><br><span class=\"line\">git branch</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 创建新分支; -d删除分支</span></span><br><span class=\"line\">git branch branch-name</span><br><span class=\"line\">git branch -d branch-name</span><br><span class=\"line\"><span class=\"comment\"># -D命令用于强制删除指定的本地分支，即使该分支包含未合并的提交。</span></span><br><span class=\"line\">git branch -D branch-name</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 切换分支；-b创建并切换新的分支</span></span><br><span class=\"line\">git checkout branch-name</span><br><span class=\"line\">git checkout -b branch-name</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 指定分支合并到当前分支</span></span><br><span class=\"line\">git merge branch-name</span><br></pre></td></tr></table></figure></p>\n<h3 id=\"提交\"><a class=\"anchor\" href=\"#提交\">#</a> 提交</h3>\n<p><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">将文件从工作区添加到暂存区，以便将其包含在下一次提交中</span></span><br><span class=\"line\">git add</span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">提交带有签名的提交</span></span><br><span class=\"line\">git commit -s</span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">追加提交,将add的内容追加到最近一次提交</span></span><br><span class=\"line\">git commit --amend</span><br><span class=\"line\"><span class=\"meta prompt_\"></span></span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">--no-edit 选项表示不打开编辑器，直接使用原来的提交信息。这个选项通常用于只修改文件内容而不修改提交信息的情况。</span></span><br><span class=\"line\">git commit --amend --no-edit</span><br></pre></td></tr></table></figure></p>\n<h3 id=\"暂存\"><a class=\"anchor\" href=\"#暂存\">#</a> 暂存</h3>\n<p><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 将修改暂存，需要先add</span></span><br><span class=\"line\">git stash</span><br><span class=\"line\">git stash list</span><br><span class=\"line\">git stash clear</span><br><span class=\"line\">git stash apply</span><br><span class=\"line\"><span class=\"comment\"># 拿出第一个暂存的修改</span></span><br><span class=\"line\">git stash pop</span><br></pre></td></tr></table></figure></p>\n<h3 id=\"远程相关\"><a class=\"anchor\" href=\"#远程相关\">#</a> 远程相关</h3>\n<p><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">工作常用，用于拉取远程代码并且将自己的修改置于<span class=\"built_in\">head</span></span></span><br><span class=\"line\">git pull --rebase</span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">从远程仓库获取最新的代码，并且删除本地已经不存在的远程分支。</span></span><br><span class=\"line\">git fetch -p</span><br><span class=\"line\"><span class=\"meta prompt_\"></span></span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">提交远程</span></span><br><span class=\"line\">git push origin branch-name</span><br><span class=\"line\">git push ssh://账号@项目路径  HEAD:分支</span><br><span class=\"line\"><span class=\"meta prompt_\"></span></span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">将指定的提交(可多个提交)应用到当前分支中。</span></span><br><span class=\"line\">git cherry-pick &lt;commit&gt;..</span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">继续之前被中断的 cherry-pick 操作（一般是冲突了之后会中断，手动解决后使用）</span></span><br><span class=\"line\">git cherry-pick --continue</span><br></pre></td></tr></table></figure></p>\n<p><code>--rebase</code>  是将远程代码拉取到本地，并且将自己的修改放置在最前面。 <span class=\"exturl\" data-url=\"aHR0cHM6Ly9qdWVqaW4uY24vcG9zdC82ODQ0OTAzNjE4MTc3NDMzNjEzP3NlYXJjaElkPTIwMjMwODE1MTU0MDM1REM2MEU5NUU2MkRBQkVBNkQxREY=\">pull 对比 pull --rebase</span></p>\n<h2 id=\"原理相关\"><a class=\"anchor\" href=\"#原理相关\">#</a> 原理相关</h2>\n<p><img data-src=\"https://raw.githubusercontent.com/Windlinxy/Typora-img/main/img/202308172300393.png\" alt=\"img\" /><img data-src=\"https://raw.githubusercontent.com/Windlinxy/Typora-img/main/img/202308172300839.png\" alt=\"img\" /><img data-src=\"https://raw.githubusercontent.com/Windlinxy/Typora-img/main/img/202308172300497.png\" alt=\"img\" /></p>\n<h2 id=\"文件的状态\"><a class=\"anchor\" href=\"#文件的状态\">#</a> 文件的状态：</h2>\n<ul>\n<li>untracked 未跟踪</li>\n<li>unmodified 未修改</li>\n<li>modified 已修改</li>\n<li>staged 已暂存</li>\n<li>committed 已提交</li>\n</ul>\n<h2 id=\"git提交规范\"><a class=\"anchor\" href=\"#git提交规范\">#</a> Git 提交规范</h2>\n<ul>\n<li>feat：新功能</li>\n<li>fix：修补 bug</li>\n<li>docs：文档</li>\n<li>style ： 格式</li>\n<li>refactor：重构</li>\n<li>test：增加测试</li>\n<li>chore：构建过程或辅助工具的变动</li>\n</ul>\n<h1 id=\"gerrit\"><a class=\"anchor\" href=\"#gerrit\">#</a> Gerrit</h1>\n<p>使用 commit --amend 追加前面提交的时候，gerrit 通过 changeId 来判断，从而使得 push 的时候可以追加到之前的提交，只是在远程加了 patchsetN</p>\n",
            "tags": [
                "学习笔记",
                "工具",
                "后端",
                "Git"
            ]
        },
        {
            "id": "https://windlinxy.top/2023/06/27/3f6a96d10637/",
            "url": "https://windlinxy.top/2023/06/27/3f6a96d10637/",
            "title": "读《redis设计与实现》",
            "date_published": "2023-06-27T01:13:03.000Z",
            "content_html": "<h1 id=\"概述\"><a class=\"anchor\" href=\"#概述\">#</a> 概述</h1>\n<p>《redis 设计与实现》是基于 2.9 版本写作的，现在（2023.06.27）redis 已经更新到 7.0.11 版本了，虽然书中有些介绍已经过时，但是还是可以对 redis 建立起大致的认知的。</p>\n<h1 id=\"一-数据结构与对象\"><a class=\"anchor\" href=\"#一-数据结构与对象\">#</a> 一、数据结构与对象</h1>\n<p>redis 有五种基本类型：String、List、Hash、Set、ZSet，目前 7 版本还有五种特殊类型：HyperLogLog、Geospatial、Stream、Bitmaps、Bitfields。</p>\n<h2 id=\"数据结构\"><a class=\"anchor\" href=\"#数据结构\">#</a> 数据结构</h2>\n<p>五种常用的基本类型，底层使用的数据结构有：SDS（Simple Dynamic String）、list、hashtable、zipList、intset、skiplist。</p>\n<p><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">graph TB;</span><br><span class=\"line\">String ==&gt; SDS</span><br><span class=\"line\">List ==&gt; list</span><br><span class=\"line\">List ==&gt; ziplist</span><br><span class=\"line\">Hash ==&gt; ziplist</span><br><span class=\"line\">Hash ==&gt; hashtable</span><br><span class=\"line\">Set\t==&gt; hashtable</span><br><span class=\"line\">Set ==&gt; intset</span><br><span class=\"line\">Zset ==&gt; ziplist</span><br><span class=\"line\">Zset ==&gt; skiplist</span><br></pre></td></tr></table></figure></p>\n<p>在 redis3.2 版本之后 List 底层数据采用快表（quicklist）实现。</p>\n<h3 id=\"sds\"><a class=\"anchor\" href=\"#sds\">#</a> SDS</h3>\n<p>简单动态字符串，其（3.2 版本之前）结构是：</p>\n<p><figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">struct</span> <span class=\"title\">sdshdr</span> &#123;</span></span><br><span class=\"line\">    <span class=\"type\">unsigned</span> <span class=\"type\">int</span> len;   <span class=\"comment\">//buf中已经使用的长度</span></span><br><span class=\"line\">    <span class=\"type\">unsigned</span> <span class=\"type\">int</span> <span class=\"built_in\">free</span>;  <span class=\"comment\">//buf中未使用的长度</span></span><br><span class=\"line\">    <span class=\"type\">char</span> buf[];         <span class=\"comment\">//柔性数组buf</span></span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure></p>\n<p>SDS 与 C 字符串区别：</p>\n<ul>\n<li>与 C 字符串不同，使用额外两个变量记录长度，可以使得我们可以 O (1) 时间复杂度级别获取字符串长度。</li>\n<li>二进制安全：C 字符串只能使用 ASCII 编码，可能因为二进制文件中可能包含空字符 '\\0'，导致 C 字符串误以为终止符，而 sds 使用 len 属性判定终止，不会与文件内容冲突。</li>\n<li>杜绝缓存区溢出：C 字符串中，如果出现两个字符串在内存中相邻，修改前字符串 1（长度变长）而不分配空间，就会导致字符串 2 内容被修改。SDS 在修改字符串会先判断给定空间是否足够，足够就直接修改，不够就会先分配空间再去修改。</li>\n<li>减少字符串修改带来的内存重分配次数：C 字符串并不记录自身长度，每次修改都需要进行内存重分配：增长字符串不进行内存重分配 — 缓冲区溢出，缩小字符串长度不进行内存重分配 — 内存泄露。Redis 作为数据库，如果每次修改都去做内存中分配，就会对性能造成影响，所以 redis 采用空间预分配以及惰性空间释放策略。</li>\n</ul>\n<h4 id=\"空间预分配\"><a class=\"anchor\" href=\"#空间预分配\">#</a> 空间预分配</h4>\n<p>在 SDS 增长字符串长度时，如果发现原本的空间不足以修改，需要内存重分配，除了为 SDS 分配修改所必需的空间，还会分配额外的空间：</p>\n<ul>\n<li>如果 SDS 修改之后长度小于 1MB，程序会分配和 len 属性同样大小的未使用空间，此时 SDS 的值等于 free 的值</li>\n<li>如果 SDS 修改之后长度大于等于 1MB，会分配 1MB 的未使用空间</li>\n</ul>\n<p><strong>执行过 APPEND 命令的字符串会带有额外的预分配空间，这些预分配空间不会被释放，除非该字符串所对应的键被删除，或者等到关闭 Redis 之后，再次启动时重新载入的字符串对象将不会有预分配空间。</strong></p>\n<h3 id=\"链表list\"><a class=\"anchor\" href=\"#链表list\">#</a> 链表 list</h3>\n<p>作为 List 类型的底层实现，3.2 之后就废用了，使用快表代替。</p>\n<p><figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">typedef</span> <span class=\"class\"><span class=\"keyword\">struct</span> <span class=\"title\">listNode</span>&#123;</span></span><br><span class=\"line\">    <span class=\"class\"><span class=\"keyword\">struct</span> <span class=\"title\">listNode</span> *<span class=\"title\">prev</span>;</span></span><br><span class=\"line\">    <span class=\"class\"><span class=\"keyword\">struct</span> <span class=\"title\">listNode</span> *<span class=\"title\">next</span>;</span></span><br><span class=\"line\">    <span class=\"type\">void</span> *value;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<p>双端链表</p>\n<p><figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">typedef</span> <span class=\"class\"><span class=\"keyword\">struct</span> <span class=\"title\">list</span>&#123;</span></span><br><span class=\"line\">\t<span class=\"class\"><span class=\"keyword\">struct</span> <span class=\"title\">listNode</span> *<span class=\"title\">head</span>;</span></span><br><span class=\"line\">    <span class=\"class\"><span class=\"keyword\">struct</span> <span class=\"title\">listNode</span> *<span class=\"title\">tail</span>;</span></span><br><span class=\"line\">    <span class=\"type\">unsigned</span> <span class=\"type\">long</span> len;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<h3 id=\"压缩列表ziplist\"><a class=\"anchor\" href=\"#压缩列表ziplist\">#</a> 压缩列表 ziplist</h3>\n<p>压缩列表是列表（3.2 版本之前）和 Hash 表底层实现。</p>\n<p>大致结构：</p>\n<table>\n<thead>\n<tr>\n<th>zlbytes</th>\n<th>ztail</th>\n<th>zllen</th>\n<th>entry1</th>\n<th>...</th>\n<th>entryX</th>\n<th>zlend</th>\n</tr>\n</thead>\n</table>\n<ul>\n<li>zlbytes：压缩列表总字节数</li>\n<li>ztail：尾部偏移量</li>\n<li>zllen：节点数量</li>\n<li>entryX：节点</li>\n</ul>\n<p>entry 结构：</p>\n<table>\n<thead>\n<tr>\n<th>previous_entry_length</th>\n<th>encoding</th>\n<th>content</th>\n</tr>\n</thead>\n</table>\n<ul>\n<li>previous_entry_length： 前一个节点的长度</li>\n<li>encoding：值的编码</li>\n<li>content：存储内容（指针指向）</li>\n</ul>\n<p><figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/* ziplist header的大小：两个32位整数，用于总字节计数(bytes)和最后一项偏移量(ZIPLIST_TAIL_OFFSET)。一个16位整数，节点数(ZIPLIST_LENGTH(zl))。*/</span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">define</span> ZIPLIST_HEADER_SIZE     (sizeof(uint32_t)*2+sizeof(uint16_t))</span></span><br><span class=\"line\"><span class=\"comment\">/* ziplist结尾标识，1字节. */</span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">define</span> ZIPLIST_END_SIZE        (sizeof(uint8_t))</span></span><br><span class=\"line\"><span class=\"comment\">/* 创建一个新的压缩列表 . */</span></span><br><span class=\"line\"><span class=\"type\">unsigned</span> <span class=\"type\">char</span> *<span class=\"title function_\">ziplistNew</span><span class=\"params\">(<span class=\"type\">void</span>)</span> &#123;</span><br><span class=\"line\">    <span class=\"type\">unsigned</span> <span class=\"type\">int</span> bytes = ZIPLIST_HEADER_SIZE + ZIPLIST_END_SIZE;</span><br><span class=\"line\">    <span class=\"type\">unsigned</span> <span class=\"type\">char</span> *zl = zmalloc(bytes);</span><br><span class=\"line\">    <span class=\"comment\">// 压缩列表总字节长度</span></span><br><span class=\"line\">    ZIPLIST_BYTES(zl) = intrev32ifbe(bytes);</span><br><span class=\"line\">    <span class=\"comment\">// 尾节点的偏移量</span></span><br><span class=\"line\">    ZIPLIST_TAIL_OFFSET(zl) = intrev32ifbe(ZIPLIST_HEADER_SIZE);</span><br><span class=\"line\">    <span class=\"comment\">// 节点个数</span></span><br><span class=\"line\">    ZIPLIST_LENGTH(zl) = <span class=\"number\">0</span>;</span><br><span class=\"line\">    <span class=\"comment\">// 特殊结尾值</span></span><br><span class=\"line\">    zl[bytes<span class=\"number\">-1</span>] = ZIP_END;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> zl;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 压缩列表节点</span></span><br><span class=\"line\"><span class=\"keyword\">typedef</span> <span class=\"class\"><span class=\"keyword\">struct</span> <span class=\"title\">zlentry</span> &#123;</span>    </span><br><span class=\"line\">    <span class=\"type\">unsigned</span> <span class=\"type\">int</span> prevrawlensize <span class=\"comment\">// prevrawlen的大小，有1字节和5字节两种</span></span><br><span class=\"line\">    <span class=\"type\">unsigned</span> <span class=\"type\">int</span> prevrawlen;    <span class=\"comment\">// prevrawlen是前一个节点的长度</span></span><br><span class=\"line\">    <span class=\"type\">unsigned</span> <span class=\"type\">int</span> lensize;\t\t<span class=\"comment\">//  lensize为编码len所需的字节大小</span></span><br><span class=\"line\">    <span class=\"type\">unsigned</span> <span class=\"type\">int</span> len \t\t\t<span class=\"comment\">// len为当前节点长度</span></span><br><span class=\"line\">    <span class=\"type\">unsigned</span> <span class=\"type\">int</span> headersize;    <span class=\"comment\">// 当前节点的header大小</span></span><br><span class=\"line\">    <span class=\"type\">unsigned</span> <span class=\"type\">char</span> encoding; \t<span class=\"comment\">// 节点的编码方式</span></span><br><span class=\"line\">    <span class=\"type\">unsigned</span> <span class=\"type\">char</span> *p;   \t\t<span class=\"comment\">// 指向节点的指针</span></span><br><span class=\"line\">&#125; zlentry;</span><br></pre></td></tr></table></figure></p>\n<h3 id=\"快表quicklist\"><a class=\"anchor\" href=\"#快表quicklist\">#</a> 快表 quicklist</h3>\n<p>3.2 版本之后作为 List 类型的底层实现，是双端链表和压缩列表的结合，使用压缩列表作为双端链表的节点</p>\n<p><figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">typedef</span> <span class=\"class\"><span class=\"keyword\">struct</span> <span class=\"title\">quicklistNode</span> &#123;</span></span><br><span class=\"line\">    <span class=\"class\"><span class=\"keyword\">struct</span> <span class=\"title\">quicklistNode</span> *<span class=\"title\">prev</span>;</span></span><br><span class=\"line\">    <span class=\"class\"><span class=\"keyword\">struct</span> <span class=\"title\">quicklistNode</span> *<span class=\"title\">next</span>;</span></span><br><span class=\"line\">    <span class=\"type\">unsigned</span> <span class=\"type\">char</span> *entry; <span class=\"comment\">/* 指向压缩列表 */</span></span><br><span class=\"line\">    <span class=\"type\">size_t</span> sz;             <span class=\"comment\">/* ziplist字节数 */</span></span><br><span class=\"line\">    <span class=\"type\">unsigned</span> <span class=\"type\">int</span> count : <span class=\"number\">16</span>;     <span class=\"comment\">/* ziplist节点数量 */</span></span><br><span class=\"line\">    <span class=\"type\">unsigned</span> <span class=\"type\">int</span> encoding : <span class=\"number\">2</span>;   <span class=\"comment\">/* 编码RAW=1，LZF=2 */</span></span><br><span class=\"line\">    <span class=\"type\">unsigned</span> <span class=\"type\">int</span> container : <span class=\"number\">2</span>;  <span class=\"comment\">/* 容器，NONE=1，ziplist=2 */</span></span><br><span class=\"line\">    <span class=\"type\">unsigned</span> <span class=\"type\">int</span> recompress : <span class=\"number\">1</span>; <span class=\"comment\">/*  节点是否已被压缩 */</span></span><br><span class=\"line\">    <span class=\"type\">unsigned</span> <span class=\"type\">int</span> attempted_compress : <span class=\"number\">1</span>; <span class=\"comment\">/*  测试使用，在压缩时，设为1，解压时设为0 */</span></span><br><span class=\"line\">    <span class=\"type\">unsigned</span> <span class=\"type\">int</span> dont_compress : <span class=\"number\">1</span>; <span class=\"comment\">/* 防止压缩稍后将使用的节点 */</span></span><br><span class=\"line\">    <span class=\"type\">unsigned</span> <span class=\"type\">int</span> extra : <span class=\"number\">9</span>; <span class=\"comment\">/* 留用字段 */</span></span><br><span class=\"line\">&#125; quicklistNode;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 存储LZF压缩后的数据，对于quicklistNode来说：</span></span><br><span class=\"line\"><span class=\"comment\">// 如果数据未被压缩，数据直接存储在node-&gt;zl中</span></span><br><span class=\"line\"><span class=\"comment\">// 如果数据被压缩，则node-&gt;zl存储一个quicklistLZF，压缩后的数据存在quicklistLZF中</span></span><br><span class=\"line\"><span class=\"keyword\">typedef</span> <span class=\"class\"><span class=\"keyword\">struct</span> <span class=\"title\">quicklistLZF</span> &#123;</span></span><br><span class=\"line\">    <span class=\"type\">unsigned</span> <span class=\"type\">int</span> sz; <span class=\"comment\">// compressed的大小</span></span><br><span class=\"line\">    <span class=\"type\">char</span> compressed[]; <span class=\"comment\">// LZF压缩后的数据</span></span><br><span class=\"line\">&#125; quicklistLZF;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 书签 </span></span><br><span class=\"line\"><span class=\"keyword\">typedef</span> <span class=\"class\"><span class=\"keyword\">struct</span> <span class=\"title\">quicklistBookmark</span> &#123;</span></span><br><span class=\"line\">    quicklistNode *node; <span class=\"comment\">// 书签标记的节点</span></span><br><span class=\"line\">    <span class=\"type\">char</span> *name; <span class=\"comment\">// 书签名</span></span><br><span class=\"line\">&#125; quicklistBookmark;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 快表定义，size: 40 bytes</span></span><br><span class=\"line\"><span class=\"keyword\">typedef</span> <span class=\"class\"><span class=\"keyword\">struct</span> <span class=\"title\">quicklist</span> &#123;</span></span><br><span class=\"line\">    quicklistNode *head; <span class=\"comment\">// 头节点</span></span><br><span class=\"line\">    quicklistNode *tail; <span class=\"comment\">// 尾节点</span></span><br><span class=\"line\">    <span class=\"type\">unsigned</span> <span class=\"type\">long</span> count; <span class=\"comment\">// 元素的数量</span></span><br><span class=\"line\">    <span class=\"type\">unsigned</span> <span class=\"type\">long</span> len; <span class=\"comment\">// quicklistNode的数量</span></span><br><span class=\"line\">    <span class=\"type\">int</span> fill : QL_FILL_BITS; <span class=\"comment\">/* QL_FILL_BITS=16 单个节点的填充系数</span></span><br><span class=\"line\"><span class=\"comment\">        如果为负数则使用的为默认值，参考optimization_level*/</span></span><br><span class=\"line\">    <span class=\"type\">unsigned</span> <span class=\"type\">int</span> compress : QL_COMP_BITS;  <span class=\"comment\">/* QL_COMP_BITS=16，</span></span><br><span class=\"line\"><span class=\"comment\">        压缩深度，对整个列表压缩时，只压缩头尾往中各compress个节点，如果为0则表示不压缩 */</span></span><br><span class=\"line\">    <span class=\"type\">unsigned</span> <span class=\"type\">int</span> bookmark_count : QL_BM_BITS;  <span class=\"comment\">/* QL_BM_BITS=4，</span></span><br><span class=\"line\"><span class=\"comment\">        书签的数量；默认只给了4位，空了4位没有使用，使用过多的书签会导致性能下降 */</span></span><br><span class=\"line\">    quicklistBookmark bookmarks[]; <span class=\"comment\">// 当前使用的书签</span></span><br><span class=\"line\">&#125; quicklist;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 快表条目</span></span><br><span class=\"line\"><span class=\"keyword\">typedef</span> <span class=\"class\"><span class=\"keyword\">struct</span> <span class=\"title\">quicklistEntry</span> &#123;</span></span><br><span class=\"line\">    <span class=\"type\">const</span> quicklist *quicklist; <span class=\"comment\">// 条目所属快表</span></span><br><span class=\"line\">    quicklistNode *node; <span class=\"comment\">// 条目所属节点</span></span><br><span class=\"line\">    <span class=\"type\">unsigned</span> <span class=\"type\">char</span> *zi; <span class=\"comment\">// ziplist item指针</span></span><br><span class=\"line\">    <span class=\"type\">unsigned</span> <span class=\"type\">char</span> *value; <span class=\"comment\">// 条目的字符串值起始指针</span></span><br><span class=\"line\">    <span class=\"type\">long</span> <span class=\"type\">long</span> longval; <span class=\"comment\">// 条目的整数值</span></span><br><span class=\"line\">    <span class=\"type\">unsigned</span> <span class=\"type\">int</span> sz; <span class=\"comment\">// 条目的大小</span></span><br><span class=\"line\">    <span class=\"type\">int</span> offset; <span class=\"comment\">// 条目在节点中的偏移量（位置）</span></span><br><span class=\"line\">&#125; quicklistEntry;</span><br><span class=\"line\">快表源码解释原文链接：https:<span class=\"comment\">//blog.csdn.net/weixin_44016271/article/details/110286635</span></span><br></pre></td></tr></table></figure></p>\n<h3 id=\"字典哈希表dict\"><a class=\"anchor\" href=\"#字典哈希表dict\">#</a> 字典 / 哈希表 dict</h3>\n<p>字典是 Set 和 Hash 的底层数据结构。以下是 7 版本的源码。</p>\n<p><figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">struct</span> <span class=\"title\">dict</span> &#123;</span></span><br><span class=\"line\">    dictType *type;</span><br><span class=\"line\">\t<span class=\"comment\">// 哈希表数组，有两个用于rehash</span></span><br><span class=\"line\">    dictEntry **ht_table[<span class=\"number\">2</span>];</span><br><span class=\"line\">    <span class=\"comment\">// 两张哈希表中，分别使用了多少</span></span><br><span class=\"line\">    <span class=\"type\">unsigned</span> <span class=\"type\">long</span> ht_used[<span class=\"number\">2</span>];</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"type\">long</span> rehashidx; <span class=\"comment\">/* 记录 rehash 进度的标志，-1表示rehash未进行*/</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/* Keep small vars at end for optimal (minimal) struct padding */</span></span><br><span class=\"line\">    <span class=\"comment\">// pauserehash为6后新加入的特性，为保证效率新增rehash的paused的操作。</span></span><br><span class=\"line\">    <span class=\"type\">int16_t</span> pauserehash; <span class=\"comment\">/* If &gt;0 rehashing is paused (&lt;0 indicates coding error) */</span></span><br><span class=\"line\">    <span class=\"type\">signed</span> <span class=\"type\">char</span> ht_size_exp[<span class=\"number\">2</span>]; <span class=\"comment\">/* hash表的长度，2的n次方 */</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"type\">void</span> *metadata[];           <span class=\"comment\">/* An arbitrary number of bytes (starting at a</span></span><br><span class=\"line\"><span class=\"comment\">                                 * pointer-aligned address) of size as defined</span></span><br><span class=\"line\"><span class=\"comment\">                                 * by dictType&#x27;s dictEntryBytes. */</span></span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/*</span></span><br><span class=\"line\"><span class=\"comment\">* dictType中是一个存放函数的结构体，定义了一些函数指针。</span></span><br><span class=\"line\"><span class=\"comment\">*/</span></span><br><span class=\"line\"><span class=\"keyword\">typedef</span> <span class=\"class\"><span class=\"keyword\">struct</span> <span class=\"title\">dictType</span> &#123;</span></span><br><span class=\"line\">    <span class=\"type\">uint64_t</span> (*hashFunction)(<span class=\"type\">const</span> <span class=\"type\">void</span> *key);<span class=\"comment\">//哈希函数</span></span><br><span class=\"line\">    <span class=\"type\">void</span> *(*keyDup)(dict *d, <span class=\"type\">const</span> <span class=\"type\">void</span> *key);<span class=\"comment\">//复制key</span></span><br><span class=\"line\">    <span class=\"type\">void</span> *(*valDup)(dict *d, <span class=\"type\">const</span> <span class=\"type\">void</span> *obj);<span class=\"comment\">//复制val</span></span><br><span class=\"line\">    <span class=\"type\">int</span> (*keyCompare)(dict *d, <span class=\"type\">const</span> <span class=\"type\">void</span> *key1, <span class=\"type\">const</span> <span class=\"type\">void</span> *key2);<span class=\"comment\">//比较key</span></span><br><span class=\"line\">    <span class=\"type\">void</span> (*keyDestructor)(dict *d, <span class=\"type\">void</span> *key);<span class=\"comment\">//删除key</span></span><br><span class=\"line\">    <span class=\"type\">void</span> (*valDestructor)(dict *d, <span class=\"type\">void</span> *obj);<span class=\"comment\">//删除val</span></span><br><span class=\"line\">    <span class=\"type\">int</span> (*expandAllowed)(<span class=\"type\">size_t</span> moreMem, <span class=\"type\">double</span> usedRatio);</span><br><span class=\"line\">    <span class=\"comment\">/* Allow a dictEntry to carry extra caller-defined metadata.  The</span></span><br><span class=\"line\"><span class=\"comment\">     * extra memory is initialized to 0 when a dictEntry is allocated. */</span></span><br><span class=\"line\">    <span class=\"type\">size_t</span> (*dictEntryMetadataBytes)(dict *d);</span><br><span class=\"line\">&#125; dictType;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">typedef</span> <span class=\"class\"><span class=\"keyword\">struct</span> <span class=\"title\">dictEntry</span> &#123;</span></span><br><span class=\"line\">    <span class=\"type\">void</span> *key;<span class=\"comment\">//键</span></span><br><span class=\"line\">    <span class=\"class\"><span class=\"keyword\">union</span> &#123;</span></span><br><span class=\"line\">        <span class=\"type\">void</span> *val;</span><br><span class=\"line\">        <span class=\"type\">uint64_t</span> u64;</span><br><span class=\"line\">        <span class=\"type\">int64_t</span> s64;</span><br><span class=\"line\">        <span class=\"type\">double</span> d;</span><br><span class=\"line\">    &#125; v;<span class=\"comment\">//值</span></span><br><span class=\"line\">    <span class=\"class\"><span class=\"keyword\">struct</span> <span class=\"title\">dictEntry</span> *<span class=\"title\">next</span>;</span>     <span class=\"comment\">/* Next entry in the same hash bucket. */</span></span><br><span class=\"line\">    <span class=\"type\">void</span> *metadata[];           <span class=\"comment\">/* An arbitrary number of bytes (starting at a</span></span><br><span class=\"line\"><span class=\"comment\">                                 * pointer-aligned address) of size as returned</span></span><br><span class=\"line\"><span class=\"comment\">                                 * by dictType&#x27;s dictEntryMetadataBytes(). */</span></span><br><span class=\"line\">&#125; dictEntry;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure></p>\n<p>在书中有提到 dict 是这样的：</p>\n<p><figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">typedef</span> <span class=\"class\"><span class=\"keyword\">struct</span> <span class=\"title\">dict</span> &#123;</span></span><br><span class=\"line\">    dictType *type;</span><br><span class=\"line\">    <span class=\"type\">void</span> *privdata;</span><br><span class=\"line\">    dictht ht[<span class=\"number\">2</span>];</span><br><span class=\"line\">    <span class=\"type\">int</span> trehashidx;</span><br><span class=\"line\">&#125; dict;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">typedef</span> <span class=\"class\"><span class=\"keyword\">struct</span> <span class=\"title\">dictht</span> &#123;</span></span><br><span class=\"line\">    dictEntry **table;</span><br><span class=\"line\">    dictType *type;</span><br><span class=\"line\">    <span class=\"type\">unsigned</span> <span class=\"type\">long</span> size;</span><br><span class=\"line\">    <span class=\"type\">unsigned</span> <span class=\"type\">long</span> sizemask;</span><br><span class=\"line\">    <span class=\"type\">unsigned</span> <span class=\"type\">long</span> used;</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure></p>\n<p>但是在 7 版本并未使用，而是直接使用 <code>dictEntry **ht_table[2];</code>  等属性来构造字典</p>\n<h4 id=\"rehash\"><a class=\"anchor\" href=\"#rehash\">#</a> rehash</h4>\n<ul>\n<li>当负载因子<strong>小于</strong> 0.1 时，进行收缩操作。</li>\n<li>当未执行 BGSAVE/BGREWRITEAOF 命令时，负载因子<strong>大于等于</strong> 1 时，进行扩展操作。</li>\n<li>当在执行 BGSAVE/BGREWRITEAOF 命令时，负载因子<strong>大于等于</strong> 5 时，进行扩展操作。</li>\n</ul>\n<p>当执行 BGSAVE/BGREWRITEAOF 时提高扩展所需负载因子，主要是因为执行这两个命令时都需要 redis 创建子进程，而此时进行 rehash 操作可能会触发子进程的 &quot;写时复制&quot; 机制。所以此时减少 rehash 操作即可避免不必要的内存写入操作，最大限度的节约内存。</p>\n<p>rehash 步骤：</p>\n<ol>\n<li>为字典两个哈希表中下标为 1 的未使用的哈希表分配空间：\n<ul>\n<li>扩展操作：ht [1] 大小 = 大于等于 ht [0].used*2 的 2 的 n 次方。（15 扩展后 32）</li>\n<li>收缩操作：ht [1] 大小 = 大于等于 ht [0].used 的 2 的 n 次方。 （12 收缩后 16）</li>\n<li>注意是按照已使用也就是元素个数来 rehash，并不是按照 ht [0] 的空间大小来分。</li>\n</ul>\n</li>\n<li>将保存在 ht [0] 的所有键值对 rehash 到 ht [1] 中；</li>\n<li>迁移完成后 ht [0] 变为空表，释放 ht [0] 空间，将 ht [1] 设置成 ht [0]，并为 ht [1] 创建空白哈希表，为下一次 rehash 做准备。</li>\n</ol>\n<h4 id=\"渐进式rehash\"><a class=\"anchor\" href=\"#渐进式rehash\">#</a> 渐进式 rehash</h4>\n<p>为了防止在进行扩展 / 收缩的 rehash 时，由于数据过多造成服务器停止服务，采用了渐进式 rehash 思路。</p>\n<ol>\n<li>为 ht [1] 分配空间，此时字典同时持有两个哈希表；</li>\n<li>将 rehashidx 设置为 0，表示 rehash 开始；</li>\n<li>在 rehash 期间，每次对字典执行增删改查都会额外将 ht [0] 中 rehashidex 索引上的的键值对 rehash 到 ht [1] 中，然后对于 rehashidx++；</li>\n<li>所有键值对都被 rehash 到 ht [1] 上之后，rehashidx 置为 - 1，rehash 完成。</li>\n</ol>\n<h3 id=\"跳跃表skiplist\"><a class=\"anchor\" href=\"#跳跃表skiplist\">#</a> 跳跃表 skiplist</h3>\n<p>跳跃表是 ZSet 的底层数据结构，跳跃表的缺点就是需要的存储空间比较大，属于利用空间来换取时间的数据结构。redis 跳跃表并没有在单独的类（比如 skplist.c) 中定义，而是其定义在 server.h 中：</p>\n<p><figure class=\"highlight c\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/* ZSETs use a specialized version of Skiplists */</span></span><br><span class=\"line\"><span class=\"keyword\">typedef</span> <span class=\"class\"><span class=\"keyword\">struct</span> <span class=\"title\">zskiplistNode</span> &#123;</span></span><br><span class=\"line\">    <span class=\"comment\">// 持有数据，是sds类型</span></span><br><span class=\"line\">    sds ele;</span><br><span class=\"line\">    <span class=\"comment\">// 结点之间凭借得分来判断先后顺序, 跳跃表中的结点按结点的得分升序排列.</span></span><br><span class=\"line\">    <span class=\"type\">double</span> score;</span><br><span class=\"line\">    <span class=\"comment\">// 原版跳跃表中所没有的. 该指针指向结点的前一个紧邻结点.</span></span><br><span class=\"line\">    <span class=\"class\"><span class=\"keyword\">struct</span> <span class=\"title\">zskiplistNode</span> *<span class=\"title\">backward</span>;</span></span><br><span class=\"line\">    <span class=\"comment\">// level数组用以记录所有结点(除过头节点外)，每个结点中最多持有32个zskiplistLevel结构</span></span><br><span class=\"line\">    <span class=\"class\"><span class=\"keyword\">struct</span> <span class=\"title\">zskiplistLevel</span> &#123;</span></span><br><span class=\"line\">        <span class=\"comment\">// 指向比自己得分高的某个结点(不一定是紧邻的)</span></span><br><span class=\"line\">        <span class=\"class\"><span class=\"keyword\">struct</span> <span class=\"title\">zskiplistNode</span> *<span class=\"title\">forward</span>;</span></span><br><span class=\"line\">        <span class=\"comment\">// 表forward字段指向的结点, 距离当前结点的距离. </span></span><br><span class=\"line\">        <span class=\"type\">unsigned</span> <span class=\"type\">long</span> span;</span><br><span class=\"line\">    &#125; level[];</span><br><span class=\"line\">&#125; zskiplistNode;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">typedef</span> <span class=\"class\"><span class=\"keyword\">struct</span> <span class=\"title\">zskiplist</span> &#123;</span></span><br><span class=\"line\">    <span class=\"class\"><span class=\"keyword\">struct</span> <span class=\"title\">zskiplistNode</span> *<span class=\"title\">header</span>, *<span class=\"title\">tail</span>;</span></span><br><span class=\"line\">    <span class=\"type\">unsigned</span> <span class=\"type\">long</span> length;</span><br><span class=\"line\">    <span class=\"type\">int</span> level;</span><br><span class=\"line\">&#125; zskiplist;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">typedef</span> <span class=\"class\"><span class=\"keyword\">struct</span> <span class=\"title\">zset</span> &#123;</span></span><br><span class=\"line\">    dict *dict;</span><br><span class=\"line\">    zskiplist *zsl;</span><br><span class=\"line\">&#125; zset;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure></p>\n<p>为什么不使用其他数据结构？</p>\n<ul>\n<li>skiplist 和各种平衡树（如 AVL、红黑树等）的元素是有序排列的，而哈希表不是有序的。因此，在哈希表上只能做单个 key 的查找，不适宜做范围查找。所谓范围查找，指的是查找那些大小在指定的两个值之间的所有节点。</li>\n<li></li>\n</ul>\n",
            "tags": [
                "后端"
            ]
        },
        {
            "id": "https://windlinxy.top/2023/03/24/89bec373c8e7/",
            "url": "https://windlinxy.top/2023/03/24/89bec373c8e7/",
            "title": "回文串相关-LeetCode刷题",
            "date_published": "2023-03-24T09:05:51.000Z",
            "content_html": "<h1 id=\"回文串\"><a class=\"anchor\" href=\"#回文串\">#</a> 回文串</h1>\n<p>回文的概念就是一个序列正着来倒着来是一样的，比如回文数字 <code>12321</code> ，回文字符串 <code>abbccdccbba</code> ，诸如此类。</p>\n<h2 id=\"判断是否是回文串\"><a class=\"anchor\" href=\"#判断是否是回文串\">#</a> 判断是否是回文串</h2>\n<p>一般就是两头对比</p>\n<p><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"type\">boolean</span> <span class=\"title function_\">isPalindrome</span><span class=\"params\">(String s)</span> &#123;</span><br><span class=\"line\">    <span class=\"type\">int</span> <span class=\"variable\">len</span> <span class=\"operator\">=</span> s.length();</span><br><span class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"type\">int</span> <span class=\"variable\">i</span> <span class=\"operator\">=</span> <span class=\"number\">0</span>; i &lt; len; i++) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (s.charAt(i) != s.charAt(len - i - <span class=\"number\">1</span>))&#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"literal\">false</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\">// 或者</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"type\">boolean</span> <span class=\"title function_\">isPalindrome</span><span class=\"params\">(String s)</span> &#123;</span><br><span class=\"line\">    <span class=\"type\">int</span> <span class=\"variable\">len</span> <span class=\"operator\">=</span> s.length();</span><br><span class=\"line\">    <span class=\"type\">int</span> <span class=\"variable\">i</span> <span class=\"operator\">=</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">    <span class=\"type\">int</span> <span class=\"variable\">j</span> <span class=\"operator\">=</span> len -<span class=\"number\">1</span>;</span><br><span class=\"line\">    <span class=\"keyword\">while</span>(i &lt; j)&#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(s.charAt(i) != s.charAt(j))&#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"literal\">false</span>;     </span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        i++;</span><br><span class=\"line\">        j--;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<p>使用 StringBuffer 反转后比较</p>\n<p><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"type\">boolean</span> <span class=\"title function_\">isPalindrome</span><span class=\"params\">(String s)</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"title class_\">StringBuffer</span>(str).reverse().toString().equals(str);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<h1 id=\"题目\"><a class=\"anchor\" href=\"#题目\">#</a> 题目</h1>\n<h2 id=\"简单难度\"><a class=\"anchor\" href=\"#简单难度\">#</a> 简单难度</h2>\n<h3 id=\"验证回文串\"><a class=\"anchor\" href=\"#验证回文串\">#</a> 验证回文串</h3>\n<p>[125. 验证回文串][<span class=\"exturl\" data-url=\"aHR0cHM6Ly9sZWV0Y29kZS5jbi9wcm9ibGVtcy92YWxpZC1wYWxpbmRyb21lLw==\">https://leetcode.cn/problems/valid-palindrome/</span>]</p>\n<blockquote>\n<p>如果在将所有大写字符转换为小写字符、并移除所有非字母数字字符之后，短语正着读和反着读都一样。则可以认为该短语是一个 <strong>回文串</strong> 。</p>\n<p>字母和数字都属于字母数字字符。</p>\n<p>给你一个字符串  <code>s</code> ，如果它是 <strong>回文串</strong> ，返回  <code>true</code>  ；否则，返回  <code>false</code>  。</p>\n</blockquote>\n<p><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">class</span> <span class=\"title class_\">Solution</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"type\">boolean</span> <span class=\"title function_\">isPalindrome</span><span class=\"params\">(String s)</span> &#123;</span><br><span class=\"line\">        <span class=\"comment\">// 去除非字母数字的字符</span></span><br><span class=\"line\">        s = s.replaceAll(<span class=\"string\">&quot;[^a-zA-Z0-9]&quot;</span>, <span class=\"string\">&quot;&quot;</span>);</span><br><span class=\"line\">        <span class=\"comment\">// 全部转换为小写</span></span><br><span class=\"line\">        s = s.toLowerCase();</span><br><span class=\"line\">        <span class=\"comment\">// 字符串翻转比较</span></span><br><span class=\"line\">       <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"title class_\">StringBuffer</span>(s).reverse().toString().equals(s);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<h3 id=\"验证回文串-ii\"><a class=\"anchor\" href=\"#验证回文串-ii\">#</a> 验证回文串 II</h3>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly9sZWV0Y29kZS5jbi9wcm9ibGVtcy92YWxpZC1wYWxpbmRyb21lLWlpLw==\">680. 验证回文串 II</span></p>\n<blockquote>\n<p>给你一个字符串  <code>s</code> ，<strong>最多</strong> 可以从中删除一个字符。</p>\n<p>请你判断  <code>s</code>  是否能成为回文字符串：如果能，返回  <code>true</code>  ；否则，返回  <code>false</code>  。</p>\n</blockquote>\n<p><strong>思路：</strong> <code>双指针</code></p>\n<ul>\n<li>考虑到只能删除一个，查找到第一对不相等的字符的时候会有两种情况。\n<ul>\n<li>删除左侧的字符，删除右侧的字符。</li>\n<li>所以会有两个分支判断</li>\n</ul>\n</li>\n<li>如果这个字符串符合题目的要求，那么删除后的字符串一定是回文的。</li>\n<li>当比较到第一对不相等的字符位置时，只需要考虑删除后的子串是否是回文的就行。</li>\n</ul>\n<p><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">class</span> <span class=\"title class_\">Solution</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"type\">boolean</span> <span class=\"title function_\">validPalindrome</span><span class=\"params\">(String s)</span> &#123;</span><br><span class=\"line\">        <span class=\"type\">int</span> <span class=\"variable\">len</span> <span class=\"operator\">=</span> s.length();</span><br><span class=\"line\">        <span class=\"type\">boolean</span> <span class=\"variable\">flag</span> <span class=\"operator\">=</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">        <span class=\"type\">int</span> <span class=\"variable\">i</span> <span class=\"operator\">=</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">        <span class=\"type\">int</span> <span class=\"variable\">j</span> <span class=\"operator\">=</span> len -<span class=\"number\">1</span>;</span><br><span class=\"line\">        <span class=\"keyword\">while</span>(i &lt; j)&#123;</span><br><span class=\"line\">            <span class=\"keyword\">if</span>(s.charAt(i) != s.charAt(j))&#123;</span><br><span class=\"line\">                <span class=\"keyword\">return</span> jud(s.substring(i+<span class=\"number\">1</span>, j+<span class=\"number\">1</span>)) || jud(s.substring(i, j));     </span><br><span class=\"line\">            &#125;<span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">                i++;</span><br><span class=\"line\">                j--;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"type\">boolean</span> <span class=\"title function_\">jud</span><span class=\"params\">(String str)</span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"title class_\">StringBuffer</span>(str).reverse().toString().equals(str);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<p><em>注意： <code>subString</code>  方法在取字符串时左闭右开， <code>[a,b)</code> </em></p>\n<h3 id=\"回文数\"><a class=\"anchor\" href=\"#回文数\">#</a> 回文数</h3>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly9sZWV0Y29kZS5jbi9wcm9ibGVtcy9wYWxpbmRyb21lLW51bWJlci8=\">9. 回文数</span></p>\n<blockquote>\n<p>给你一个整数  <code>x</code>  ，如果  <code>x</code>  是一个回文整数，返回  <code>true</code>  ；否则，返回  <code>false</code>  。</p>\n<p>回文数是指正序（从左向右）和倒序（从右向左）读都是一样的整数。</p>\n<ul>\n<li>例如， <code>121</code>  是回文，而  <code>123</code>  不是。</li>\n<li><code>-121</code>  ， 从右向左读，为  <code>121- </code> 。因此它不是一个回文数。</li>\n</ul>\n</blockquote>\n<p><strong>思路：</strong></p>\n<ul>\n<li>首先排除负数</li>\n<li>以若干连续 0 结尾的数也不是回文的</li>\n</ul>\n<h4 id=\"直接数转化字符串\"><a class=\"anchor\" href=\"#直接数转化字符串\">#</a> 直接数转化字符串</h4>\n<p><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">class</span> <span class=\"title class_\">Solution</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"type\">boolean</span> <span class=\"title function_\">isPalindrome</span><span class=\"params\">(<span class=\"type\">int</span> x)</span> &#123;</span><br><span class=\"line\">        <span class=\"comment\">// 负数直接拜拜</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (x &lt; <span class=\"number\">0</span> || (x % <span class=\"number\">10</span> == <span class=\"number\">0</span> &amp;&amp; x != <span class=\"number\">0</span>)) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"literal\">false</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"type\">String</span> <span class=\"variable\">str</span> <span class=\"operator\">=</span> x + <span class=\"string\">&quot;&quot;</span>;</span><br><span class=\"line\">        <span class=\"type\">int</span> <span class=\"variable\">len</span> <span class=\"operator\">=</span> str.length();</span><br><span class=\"line\">        <span class=\"comment\">// return new StringBuffer(str).reverse().toString().equals(str);</span></span><br><span class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"type\">int</span> <span class=\"variable\">i</span> <span class=\"operator\">=</span> <span class=\"number\">0</span>; i &lt; len; i++) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (str.charAt(i) != str.charAt(len - i - <span class=\"number\">1</span>))&#123;</span><br><span class=\"line\">                    <span class=\"keyword\">return</span> <span class=\"literal\">false</span>;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<h4 id=\"使用数字解决可以使用折半思想\"><a class=\"anchor\" href=\"#使用数字解决可以使用折半思想\">#</a> 使用数字解决，可以使用折半思想</h4>\n<p><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">class</span> <span class=\"title class_\">Solution</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"type\">boolean</span> <span class=\"title function_\">isPalindrome</span><span class=\"params\">(<span class=\"type\">int</span> x)</span> &#123;</span><br><span class=\"line\">        <span class=\"comment\">//思考：这里大家可以思考一下，为什么末尾为 0 就可以直接返回 false</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (x &lt; <span class=\"number\">0</span> || (x % <span class=\"number\">10</span> == <span class=\"number\">0</span> &amp;&amp; x != <span class=\"number\">0</span>)) <span class=\"keyword\">return</span> <span class=\"literal\">false</span>;</span><br><span class=\"line\">        <span class=\"type\">int</span> <span class=\"variable\">revertedNumber</span> <span class=\"operator\">=</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">        <span class=\"comment\">// 翻转到一般就行</span></span><br><span class=\"line\">        <span class=\"keyword\">while</span> (x &gt; revertedNumber) &#123;</span><br><span class=\"line\">            revertedNumber = revertedNumber * <span class=\"number\">10</span> + x % <span class=\"number\">10</span>;</span><br><span class=\"line\">            x /= <span class=\"number\">10</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"comment\">// 考虑数字的位数是奇数和偶数</span></span><br><span class=\"line\">        <span class=\"keyword\">return</span> x == revertedNumber || x == revertedNumber / <span class=\"number\">10</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<h3 id=\"最长回文串-简单\"><a class=\"anchor\" href=\"#最长回文串-简单\">#</a> 最长回文串 - 简单</h3>\n<blockquote>\n<p>给一个包含大写字母和小写字母的字符串  <code>s</code>  ，返回 <em>这些字母构造成的 <strong>最长的回文串</strong></em> 。</p>\n<p>在构造过程中，请注意 <strong>区分大小写</strong> 。比如  <code>&quot;Aa&quot;</code>  不能当做一个回文字符串。</p>\n</blockquote>\n<p><strong>思路：</strong></p>\n<ul>\n<li>题目问的是这些字母拼成的字符串，只需要考虑各个字母的数量即可</li>\n<li>根据各个字母的数量的奇偶，有两种情况\n<ul>\n<li>回文串字符数量为奇数，用了一个奇数数量的字母</li>\n<li>回文串字符数量为偶数，所有字母的数量都为偶数</li>\n</ul>\n</li>\n<li>开一个数组存各个字符数量</li>\n<li>第一个奇数数量的字符可以全部加到回文串中</li>\n<li>之后的字符数量只能为偶数加入回文串</li>\n</ul>\n<p><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">class</span> <span class=\"title class_\">Solution</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"type\">int</span> <span class=\"title function_\">longestPalindrome</span><span class=\"params\">(String s)</span> &#123;</span><br><span class=\"line\">        <span class=\"type\">int</span>[] count = <span class=\"keyword\">new</span> <span class=\"title class_\">int</span>[<span class=\"number\">60</span>];</span><br><span class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"type\">char</span> ch : s.toCharArray()) &#123;</span><br><span class=\"line\">            count[ch - <span class=\"string\">&#x27;A&#x27;</span>]++;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"type\">int</span> <span class=\"variable\">res</span> <span class=\"operator\">=</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">        <span class=\"type\">boolean</span> <span class=\"variable\">flag</span> <span class=\"operator\">=</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"type\">int</span> <span class=\"variable\">i</span> <span class=\"operator\">=</span> <span class=\"number\">0</span>; i &lt; <span class=\"number\">60</span>; i++) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">if</span>((count[i] &amp; <span class=\"number\">1</span>) == <span class=\"number\">1</span> &amp;&amp; flag)&#123;</span><br><span class=\"line\">                res++;</span><br><span class=\"line\">                flag = <span class=\"literal\">false</span>;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            res += ((count[i] &gt;&gt; <span class=\"number\">1</span>) &lt;&lt; <span class=\"number\">1</span>);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> res;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<p>使用 Java 的流进行优化一下</p>\n<p><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"type\">int</span> <span class=\"title function_\">longestPalindrome</span><span class=\"params\">(String s)</span> &#123;</span><br><span class=\"line\">    Map&lt;Integer, Integer&gt; count = s.chars().boxed()</span><br><span class=\"line\">        .collect(Collectors.toMap(k -&gt; k, v -&gt; <span class=\"number\">1</span>, Integer::sum));</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"type\">int</span> <span class=\"variable\">ans</span> <span class=\"operator\">=</span> count.values().stream().mapToInt(i -&gt; i - (i &amp; <span class=\"number\">1</span>)).sum();</span><br><span class=\"line\">    <span class=\"keyword\">return</span> ans &lt; s.length() ? ans + <span class=\"number\">1</span> : ans;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<h3 id=\"回文链表\"><a class=\"anchor\" href=\"#回文链表\">#</a> 回文链表</h3>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly9sZWV0Y29kZS5jbi9wcm9ibGVtcy9wYWxpbmRyb21lLWxpbmtlZC1saXN0Lw==\">234. 回文链表</span></p>\n<blockquote>\n<p>给你一个单链表的头节点  <code>head</code>  ，请你判断该链表是否为回文链表。如果是，返回  <code>true</code>  ；否则，返回  <code>false</code>  。</p>\n</blockquote>\n<p>折半思想，使用快慢指针找到中间节点，之后的链表翻转，最后比较就行</p>\n<p><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * Definition for singly-linked list.</span></span><br><span class=\"line\"><span class=\"comment\"> * public class ListNode &#123;</span></span><br><span class=\"line\"><span class=\"comment\"> *     int val;</span></span><br><span class=\"line\"><span class=\"comment\"> *     ListNode next;</span></span><br><span class=\"line\"><span class=\"comment\"> *     ListNode() &#123;&#125;</span></span><br><span class=\"line\"><span class=\"comment\"> *     ListNode(int val) &#123; this.val = val; &#125;</span></span><br><span class=\"line\"><span class=\"comment\"> *     ListNode(int val, ListNode next) &#123; this.val = val; this.next = next; &#125;</span></span><br><span class=\"line\"><span class=\"comment\"> * &#125;</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">class</span> <span class=\"title class_\">Solution</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"type\">boolean</span> <span class=\"title function_\">isPalindrome</span><span class=\"params\">(ListNode head)</span> &#123;</span><br><span class=\"line\">        <span class=\"type\">ListNode</span> <span class=\"variable\">mid</span> <span class=\"operator\">=</span> midNode(head);</span><br><span class=\"line\">        <span class=\"type\">ListNode</span> <span class=\"variable\">cmp</span> <span class=\"operator\">=</span> reverseList(mid);</span><br><span class=\"line\">        <span class=\"keyword\">while</span> (head != <span class=\"literal\">null</span> &amp;&amp; cmp != <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">if</span>(head.val != cmp.val)&#123;</span><br><span class=\"line\">                <span class=\"keyword\">return</span> <span class=\"literal\">false</span>;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            head = head.next;</span><br><span class=\"line\">            cmp = cmp.next;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">private</span> ListNode <span class=\"title function_\">midNode</span><span class=\"params\">(ListNode head)</span>&#123;</span><br><span class=\"line\">        <span class=\"type\">ListNode</span> <span class=\"variable\">slow</span> <span class=\"operator\">=</span> head;</span><br><span class=\"line\">        <span class=\"type\">ListNode</span> <span class=\"variable\">fast</span> <span class=\"operator\">=</span> head;</span><br><span class=\"line\">        <span class=\"keyword\">while</span> (fast != <span class=\"literal\">null</span> &amp;&amp; fast.next != <span class=\"literal\">null</span>)&#123;</span><br><span class=\"line\">            slow = slow.next;</span><br><span class=\"line\">            fast = fast.next.next;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> slow;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">private</span> ListNode <span class=\"title function_\">reverseList</span><span class=\"params\">(ListNode mid)</span> &#123;</span><br><span class=\"line\">        <span class=\"type\">ListNode</span> <span class=\"variable\">pre</span> <span class=\"operator\">=</span> <span class=\"literal\">null</span>;</span><br><span class=\"line\">        <span class=\"type\">ListNode</span> <span class=\"variable\">cur</span> <span class=\"operator\">=</span> mid;</span><br><span class=\"line\">        <span class=\"keyword\">while</span>(cur !=<span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">            <span class=\"type\">ListNode</span> <span class=\"variable\">next</span> <span class=\"operator\">=</span> cur.next;</span><br><span class=\"line\">            cur.next = pre;</span><br><span class=\"line\">            pre = cur;</span><br><span class=\"line\">            cur = next;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> pre;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<h2 id=\"中等难度\"><a class=\"anchor\" href=\"#中等难度\">#</a> 中等难度</h2>\n<h3 id=\"最长回文子串\"><a class=\"anchor\" href=\"#最长回文子串\">#</a> 最长回文子串</h3>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly9sZWV0Y29kZS5jbi9wcm9ibGVtcy9sb25nZXN0LXBhbGluZHJvbWljLXN1YnN0cmluZy8=\">5. 最长回文子串</span></p>\n<blockquote>\n<p>给你一个字符串  <code>s</code> ，找到  <code>s</code>  中最长的回文子串。</p>\n<p>如果字符串的反序与原始字符串相同，则该字符串称为回文字符串。</p>\n</blockquote>\n<p><strong>暴力的话会超时，可以用中心扩散法或动态规划</strong></p>\n<h4 id=\"中心扩散法\"><a class=\"anchor\" href=\"#中心扩散法\">#</a> 中心扩散法</h4>\n<p><strong>思路：</strong></p>\n<ul>\n<li>遍历，选择一个元素 <code>i</code></li>\n<li>两个指针，从元素左 <code>left = i-1</code>  右 <code>right = i+1</code>  开始比较\n<ul>\n<li>如果左指针元素与 <code>i</code>  位置元素相等，左指针左移，否则不变</li>\n<li>右指针同理，右移</li>\n<li>之后比较两指针所指元素</li>\n<li>上述过程的好处是泛化了回文串的字符奇数偶数问题，使得该方法适用</li>\n</ul>\n</li>\n<li>每次选择中间元素 <code>i</code>  记录最大长度和起始位置即可。</li>\n</ul>\n<p><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> String <span class=\"title function_\">longestPalindrome</span><span class=\"params\">(String s)</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (s == <span class=\"literal\">null</span> || s.length() == <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"string\">&quot;&quot;</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"type\">int</span> <span class=\"variable\">strLen</span> <span class=\"operator\">=</span> s.length();</span><br><span class=\"line\">    <span class=\"type\">int</span> <span class=\"variable\">left</span> <span class=\"operator\">=</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">    <span class=\"type\">int</span> right;</span><br><span class=\"line\">    <span class=\"type\">int</span> len;</span><br><span class=\"line\">    <span class=\"type\">int</span> <span class=\"variable\">maxStart</span> <span class=\"operator\">=</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">    <span class=\"type\">int</span> <span class=\"variable\">maxLen</span> <span class=\"operator\">=</span> <span class=\"number\">0</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"type\">int</span> <span class=\"variable\">i</span> <span class=\"operator\">=</span> <span class=\"number\">0</span>; i &lt; strLen; i++) &#123;</span><br><span class=\"line\">        left = i - <span class=\"number\">1</span>;</span><br><span class=\"line\">        right = i + <span class=\"number\">1</span>;</span><br><span class=\"line\">        len = <span class=\"number\">1</span>;</span><br><span class=\"line\">        <span class=\"keyword\">while</span> (left &gt;= <span class=\"number\">0</span> &amp;&amp; s.charAt(left) == s.charAt(i)) &#123;</span><br><span class=\"line\">            len++;</span><br><span class=\"line\">            left--;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">while</span> (right &lt; strLen &amp;&amp; s.charAt(right) == s.charAt(i)) &#123;</span><br><span class=\"line\">            len++;</span><br><span class=\"line\">            right++;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">while</span> (left &gt;= <span class=\"number\">0</span> &amp;&amp; right &lt; strLen &amp;&amp;s.charAt(right) == s.charAt(left)) &#123;</span><br><span class=\"line\">            len = len + <span class=\"number\">2</span>;</span><br><span class=\"line\">            left--;</span><br><span class=\"line\">            right++;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (len &gt; maxLen) &#123;</span><br><span class=\"line\">            maxLen = len;</span><br><span class=\"line\">            maxStart = left;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> s.substring(maxStart + <span class=\"number\">1</span>, maxStart + maxLen + <span class=\"number\">1</span>);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<h4 id=\"动态规划\"><a class=\"anchor\" href=\"#动态规划\">#</a> 动态规划</h4>\n<p>适用动态规划，首先要想<strong>状态转移</strong>，对于回文串，我们可以认为回文串的状态转移是从头尾向中间走。</p>\n<ol>\n<li>\n<p>定义状态，使用 <code>dp[i][j]</code>  记录子串 <code>[i,j]</code>  是否回文</p>\n</li>\n<li>\n<p>状态转移方程：首先要 <code>s[i] == s[j]</code> ，其次是 <code>dp[i-1][j+1] == true</code></p>\n<p>注意 <code> i - 1 != j + 1</code> ，所以要求子串长度大于等于 2</p>\n<p><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">dp[i][j] = (s[i] == s[j]) and dp[i + <span class=\"number\">1</span>][j - <span class=\"number\">1</span>]</span><br></pre></td></tr></table></figure></p>\n</li>\n</ol>\n<p><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> String <span class=\"title function_\">longestPalindrome</span><span class=\"params\">(String s)</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (s == <span class=\"literal\">null</span> || s.length() &lt; <span class=\"number\">2</span>) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> s;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"type\">int</span> <span class=\"variable\">strLen</span> <span class=\"operator\">=</span> s.length();</span><br><span class=\"line\">    <span class=\"type\">int</span> <span class=\"variable\">maxStart</span> <span class=\"operator\">=</span> <span class=\"number\">0</span>;  <span class=\"comment\">//最长回文串的起点</span></span><br><span class=\"line\">    <span class=\"type\">int</span> <span class=\"variable\">maxLen</span> <span class=\"operator\">=</span> <span class=\"number\">1</span>;  <span class=\"comment\">//最长回文串的长度</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"type\">boolean</span>[][] dp = <span class=\"keyword\">new</span> <span class=\"title class_\">boolean</span>[strLen][strLen];</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"type\">int</span> <span class=\"variable\">r</span> <span class=\"operator\">=</span> <span class=\"number\">1</span>; r &lt; strLen; r++) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"type\">int</span> <span class=\"variable\">l</span> <span class=\"operator\">=</span> <span class=\"number\">0</span>; l &lt; r; l++) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (s.charAt(l) == s.charAt(r) &amp;&amp; (r - l &lt;= <span class=\"number\">2</span> || dp[l + <span class=\"number\">1</span>][r - <span class=\"number\">1</span>])) &#123;</span><br><span class=\"line\">                dp[l][r] = <span class=\"literal\">true</span>;</span><br><span class=\"line\">                <span class=\"keyword\">if</span> (r - l + <span class=\"number\">1</span> &gt; maxLen) &#123;</span><br><span class=\"line\">                    maxLen = r - l + <span class=\"number\">1</span>;</span><br><span class=\"line\">                    maxStart = l;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> s.substring(maxStart, maxStart + maxLen);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n",
            "tags": [
                "LeetCode刷题",
                "LeetCode",
                "中心扩散法",
                "回文"
            ]
        },
        {
            "id": "https://windlinxy.top/2023/03/22/82bee2525fb1/",
            "url": "https://windlinxy.top/2023/03/22/82bee2525fb1/",
            "title": "缺失的第一个正数-LeetCode刷题",
            "date_published": "2023-03-22T09:05:51.000Z",
            "content_html": "<h2 id=\"缺失的第一个正数\"><a class=\"anchor\" href=\"#缺失的第一个正数\">#</a> 缺失的第一个正数</h2>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly9sZWV0Y29kZS5jbi9wcm9ibGVtcy9maXJzdC1taXNzaW5nLXBvc2l0aXZlLw==\">41. 缺失的第一个正数</span></p>\n<blockquote>\n<p>给你一个未排序的整数数组  <code>nums</code>  ，请你找出其中没有出现的最小的正整数。</p>\n<p>请你实现时间复杂度为  <code>O(n)</code>  并且只使用常数级别额外空间的解决方案。</p>\n</blockquote>\n<h3 id=\"排序\"><a class=\"anchor\" href=\"#排序\">#</a> 排序</h3>\n<p>如果不考虑时间问题，只考虑空间问题，这题很好做，将数组排序，用一个 <code>count</code>  记一下最小正数就行</p>\n<ul>\n<li>count 初始为 1</li>\n<li>对于排序后的数组，遍历，元素记 <code>item</code></li>\n<li><code>item == count</code> ， <code>count</code>  自增</li>\n<li><code>item &gt; count</code>  返回</li>\n</ul>\n<p><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">class</span> <span class=\"title class_\">Solution</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"type\">int</span> <span class=\"title function_\">firstMissingPositive</span><span class=\"params\">(<span class=\"type\">int</span>[] nums)</span> &#123;</span><br><span class=\"line\">        Arrays.sort(nums);</span><br><span class=\"line\">        <span class=\"type\">int</span> <span class=\"variable\">count</span> <span class=\"operator\">=</span> <span class=\"number\">1</span>;</span><br><span class=\"line\">        <span class=\"keyword\">for</span>(<span class=\"type\">int</span> item : nums)&#123;</span><br><span class=\"line\">            <span class=\"keyword\">if</span>(item == count)&#123;</span><br><span class=\"line\">                count++;</span><br><span class=\"line\">            &#125;<span class=\"keyword\">else</span> <span class=\"keyword\">if</span>(count &lt; item)&#123;</span><br><span class=\"line\">                <span class=\"keyword\">return</span> count;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> count;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<h3 id=\"打表\"><a class=\"anchor\" href=\"#打表\">#</a> 打表</h3>\n<p>如果不考虑空间问题，只考虑时间问题，需要用到桶</p>\n<p><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">class</span> <span class=\"title class_\">Solution</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"type\">int</span> <span class=\"title function_\">firstMissingPositive</span><span class=\"params\">(<span class=\"type\">int</span>[] nums)</span> &#123;</span><br><span class=\"line\">        <span class=\"type\">int</span> <span class=\"variable\">len</span> <span class=\"operator\">=</span> nums.length;</span><br><span class=\"line\">        <span class=\"type\">int</span> res[] = <span class=\"keyword\">new</span> <span class=\"title class_\">int</span>[len+<span class=\"number\">1</span>];</span><br><span class=\"line\">        <span class=\"keyword\">for</span>(<span class=\"type\">int</span> i : nums)&#123;</span><br><span class=\"line\">            <span class=\"keyword\">if</span>(i &gt; <span class=\"number\">0</span> &amp;&amp; i&lt;=len)</span><br><span class=\"line\">                res[i] = <span class=\"number\">1</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">for</span>(<span class=\"type\">int</span> <span class=\"variable\">i</span> <span class=\"operator\">=</span> <span class=\"number\">1</span> ;i&lt;=len;i++)&#123;</span><br><span class=\"line\">            <span class=\"keyword\">if</span>(res[i] == <span class=\"number\">0</span>)&#123;</span><br><span class=\"line\">                <span class=\"keyword\">return</span> i;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"comment\">// 如果循环没返回说明正好数组中的数是1~n</span></span><br><span class=\"line\">        <span class=\"keyword\">return</span> len+<span class=\"number\">1</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<h3 id=\"原地哈希\"><a class=\"anchor\" href=\"#原地哈希\">#</a> 原地哈希</h3>\n<p>时间复杂度为  <code>O(n)</code>  并且只使用常数级别额外空间的解决方案就是操作原数组，原地哈希。</p>\n<p>对于原数组，将其变为一个  <code>nums[i-1] = i</code>  的形式。</p>\n<p>例子：</p>\n<ul>\n<li>长度为 4 的数组 {4,2,1,3}，原地哈希后 {1,2,3,4}，每个元素满足 <code>nums[i-1] = i</code> 。</li>\n<li>数组 {4, -1, 1, 3}，原地哈希后 {1, -1, 3, 4}，此时遍历找到第一个满足 <code>nums[i-1] != i</code>  的元素返回对应缺失的正数即可。</li>\n</ul>\n<p><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"type\">int</span> <span class=\"title function_\">firstMissingPositive</span><span class=\"params\">(<span class=\"type\">int</span>[] nums)</span> &#123;</span><br><span class=\"line\">        <span class=\"type\">int</span> <span class=\"variable\">n</span> <span class=\"operator\">=</span> nums.length;</span><br><span class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"type\">int</span> <span class=\"variable\">i</span> <span class=\"operator\">=</span> <span class=\"number\">0</span>; i &lt; n; i++) &#123;</span><br><span class=\"line\">            <span class=\"comment\">// 符合hash的条件跳过</span></span><br><span class=\"line\">            <span class=\"keyword\">if</span> (i + <span class=\"number\">1</span> == nums[i]) &#123;</span><br><span class=\"line\">                <span class=\"keyword\">continue</span>;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (<span class=\"number\">0</span> &lt; nums[i] &amp;&amp; nums[i] &lt;= n &amp;&amp; nums[i] != nums[nums[i]-<span class=\"number\">1</span>]) &#123;</span><br><span class=\"line\">                swap(nums, i, nums[i] - <span class=\"number\">1</span>);</span><br><span class=\"line\">                <span class=\"comment\">// 交换后需要再次判断nums[nums[i]-1]</span></span><br><span class=\"line\">                i--;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">for</span> (<span class=\"type\">int</span> <span class=\"variable\">i</span> <span class=\"operator\">=</span> <span class=\"number\">0</span>; i &lt; n; i++) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (nums[i] != i + <span class=\"number\">1</span>) &#123;</span><br><span class=\"line\">                <span class=\"keyword\">return</span> i + <span class=\"number\">1</span>;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> n + <span class=\"number\">1</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">swap</span><span class=\"params\">(<span class=\"type\">int</span>[] arr, <span class=\"type\">int</span> i, <span class=\"type\">int</span> j)</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (i != j) &#123;</span><br><span class=\"line\">            arr[i] ^= arr[j];</span><br><span class=\"line\">            arr[j] ^= arr[i];</span><br><span class=\"line\">            arr[i] ^= arr[j];</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br></pre></td></tr></table></figure></p>\n",
            "tags": [
                "LeetCode刷题",
                "LeetCode",
                "原地哈希"
            ]
        },
        {
            "id": "https://windlinxy.top/2023/03/05/cfe6cb0e3385/",
            "url": "https://windlinxy.top/2023/03/05/cfe6cb0e3385/",
            "title": "LeetCode刷题-LRU",
            "date_published": "2023-03-05T09:05:51.000Z",
            "content_html": "<h2 id=\"lru缓存\"><a class=\"anchor\" href=\"#lru缓存\">#</a> LRU 缓存</h2>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly9sZWV0Y29kZS5jbi9wcm9ibGVtcy9scnUtY2FjaGUv\">146.LRU 缓存</span></p>\n<blockquote>\n<p>请你设计并实现一个满足 <span class=\"exturl\" data-url=\"aHR0cHM6Ly9iYWlrZS5iYWlkdS5jb20vaXRlbS9MUlU=\">LRU (最近最少使用) 缓存</span> 约束的数据结构。</p>\n<p>实现  <code>LRUCache</code>  类：</p>\n<ul>\n<li><code>LRUCache(int capacity)</code>  以 <strong>正整数</strong> 作为容量  <code>capacity</code>  初始化 LRU 缓存</li>\n<li><code>int get(int key)</code>  如果关键字  <code>key</code>  存在于缓存中，则返回关键字的值，否则返回  <code>-1</code>  。</li>\n<li><code>void put(int key, int value)</code>  如果关键字  <code>key</code>  已经存在，则变更其数据值  <code>value</code>  ；如果不存在，则向缓存中插入该组  <code>key-value</code>  。如果插入操作导致关键字数量超过  <code>capacity</code>  ，则应该 <strong>逐出</strong> 最久未使用的关键字。</li>\n</ul>\n<p>函数  <code>get</code>  和  <code>put</code>  必须以  <code>O(1)</code>  的平均时间复杂度运行。</p>\n</blockquote>\n<p>一开始想到是使用<strong>双向链表</strong>，但是双向链表的查询是 O (n) 的，O (1) 的查询自然就是<strong>哈希表</strong>了</p>\n<p><code>PUT操作</code> ：</p>\n<p>添加元素时判断 key 是否存在（HashMap 查找）</p>\n<ul>\n<li>\n<p>存在</p>\n<ol>\n<li>重新赋值</li>\n<li>将节点从原有位置抽离</li>\n<li>节点放到链表头部</li>\n</ol>\n</li>\n<li>\n<p>不存在</p>\n<ol>\n<li>\n<p>判断容量已经满了 ？（用 <code>count</code>  变量记录 cache 中元素数量）</p>\n<ul>\n<li>\n<p>没满：新建一个节点 <code>newNode</code>  插入链表头部</p>\n</li>\n<li>\n<p>满了：</p>\n<ol>\n<li>将尾部节点删除</li>\n<li>新建节点 <code>newNode</code>  插入头部</li>\n</ol>\n</li>\n</ul>\n</li>\n<li>\n<p>HashMap 存放 &lt; key,  <code>newNode</code> &gt;</p>\n</li>\n</ol>\n</li>\n</ul>\n<p><code>GET操作</code> ：</p>\n<ol>\n<li>从 HashMap 取节点\n<ul>\n<li>为 <code>null</code>  返回 - 1</li>\n<li>不为 <code>null</code>\n<ol>\n<li>将节点从原有位置抽离</li>\n<li>节点放到链表头部</li>\n</ol>\n</li>\n</ul>\n</li>\n</ol>\n<p>AC 之后考虑并发问题，LRU 本身就是操作系统的内存淘汰机制，需要考虑并发问题：如果 get 的同时</p>\n<p>在多线程的情况下， <code>get()</code>  移动节点操作和 <code>put()</code>  整个方法加锁来保证节点的顺序正常。</p>\n<p><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> java.util.HashMap;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.HashMap;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.concurrent.locks.LockSupport;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">class</span> <span class=\"title class_\">LRUCache</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 容量</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">final</span> <span class=\"type\">int</span> capacity;</span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * head.next 指向的是最近最多使用的节点</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">final</span> Node head;</span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * tail.prev 指向的是最近最少使用的节点</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">final</span> Node tail;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">final</span> HashMap&lt;Integer, Node&gt; hash;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">class</span> <span class=\"title class_\">Node</span> &#123;</span><br><span class=\"line\">        Node next, prev;</span><br><span class=\"line\">        <span class=\"type\">int</span> key, val;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">public</span> <span class=\"title function_\">Node</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">public</span> <span class=\"title function_\">Node</span><span class=\"params\">(<span class=\"type\">int</span> key, <span class=\"type\">int</span> val, Node prev, Node next)</span> &#123;</span><br><span class=\"line\">            <span class=\"built_in\">this</span>.next = next;</span><br><span class=\"line\">            <span class=\"built_in\">this</span>.prev = prev;</span><br><span class=\"line\">            <span class=\"built_in\">this</span>.key = key;</span><br><span class=\"line\">            <span class=\"built_in\">this</span>.val = val;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">public</span> <span class=\"title function_\">Node</span><span class=\"params\">(<span class=\"type\">int</span> key, <span class=\"type\">int</span> val)</span> &#123;</span><br><span class=\"line\">            <span class=\"built_in\">this</span>.key = key;</span><br><span class=\"line\">            <span class=\"built_in\">this</span>.val = val;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"title function_\">LRUCache</span><span class=\"params\">(<span class=\"type\">int</span> capacity)</span> &#123;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.capacity = capacity;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.hash = <span class=\"keyword\">new</span> <span class=\"title class_\">HashMap</span>&lt;&gt;();</span><br><span class=\"line\">        head = <span class=\"keyword\">new</span> <span class=\"title class_\">Node</span>();</span><br><span class=\"line\">        tail = <span class=\"keyword\">new</span> <span class=\"title class_\">Node</span>();</span><br><span class=\"line\">        head.next = tail;</span><br><span class=\"line\">        tail.prev = head;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"type\">int</span> <span class=\"title function_\">get</span><span class=\"params\">(<span class=\"type\">int</span> key)</span> &#123;</span><br><span class=\"line\">        <span class=\"comment\">// 查找节点</span></span><br><span class=\"line\">        <span class=\"type\">Node</span> <span class=\"variable\">nNode</span> <span class=\"operator\">=</span> hash.get(key);</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (nNode != <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">            unLinkedNode(nNode);</span><br><span class=\"line\">            moveToHead(nNode);</span><br><span class=\"line\">            <span class=\"keyword\">return</span> nNode.val;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> -<span class=\"number\">1</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">synchronized</span> <span class=\"keyword\">void</span> <span class=\"title function_\">put</span><span class=\"params\">(<span class=\"type\">int</span> key, <span class=\"type\">int</span> value)</span> &#123;</span><br><span class=\"line\">        <span class=\"type\">Node</span> <span class=\"variable\">nNode</span> <span class=\"operator\">=</span> hash.get(key);</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (nNode == <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (hash.size() == capacity) &#123;</span><br><span class=\"line\">                hash.remove(tail.prev.key);</span><br><span class=\"line\">                removeTail();</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            nNode = <span class=\"keyword\">new</span> <span class=\"title class_\">Node</span>(key, value);</span><br><span class=\"line\">            hash.put(key, nNode);</span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            nNode.val = value;</span><br><span class=\"line\">            unLinkedNode(nNode);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        moveToHead(nNode);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 将节点放到链表头部</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">void</span> <span class=\"title function_\">moveToHead</span><span class=\"params\">(Node cur)</span> &#123;</span><br><span class=\"line\">        head.next.prev = cur;</span><br><span class=\"line\">        cur.next = head.next;</span><br><span class=\"line\">        head.next = cur;</span><br><span class=\"line\">        cur.prev = head;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">   <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">    * 将节点从原有链表拿出来</span></span><br><span class=\"line\"><span class=\"comment\">    */</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">void</span> <span class=\"title function_\">unLinkedNode</span><span class=\"params\">(Node cur)</span> &#123;</span><br><span class=\"line\">        cur.prev.next = cur.next;</span><br><span class=\"line\">        cur.next.prev = cur.prev;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 淘汰最近最少使用的节点（尾节点）</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">void</span> <span class=\"title function_\">removeTail</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        unLinkedNode(tail.prev);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * Your LRUCache object will be instantiated and called as such:</span></span><br><span class=\"line\"><span class=\"comment\"> * LRUCache obj = new LRUCache(capacity);</span></span><br><span class=\"line\"><span class=\"comment\"> * int param_1 = obj.get(key);</span></span><br><span class=\"line\"><span class=\"comment\"> * obj.put(key,value);</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br></pre></td></tr></table></figure></p>\n<h2 id=\"引申\"><a class=\"anchor\" href=\"#引申\">#</a> 引申</h2>\n<p>LRU 全程<em> Least Recently Used</em>，即最近最少使用的页面置换算法，是服务虚拟页式存储管理服务的，实现思想是读取的数据会更新到 LRU 列表最前端， 当容量满的时候会淘汰尾部数据，来达到一个最近最少使用的数据淘汰功能。</p>\n<p>根据<strong>局部性原理</strong>（包括空间局部性和时间局部性，一条指令执行后在将来的一段时间内可能会再次执行（热点代码），一个数据被访问后可能会再次访问，或者这个数据相邻的数据很大概率会再次访问到）。</p>\n<p>CSAPP 关于局部性的论述：</p>\n<ul>\n<li><em>在一个具有良好时间局部性的程序中，被引用过的内存位置很可能在不远的将来再被多次引用。</em></li>\n<li><em>在一个具有良好空间局部性的程序中，一个内存位置被引用了一次，那么程序很可能在不远的将来引用附近的一个内存位置。</em></li>\n</ul>\n<p>个人思考：局部性原理是无处不在的，LRU 就是基于局部性原理的一个体现。</p>\n",
            "tags": [
                "LeetCode刷题",
                "LeetCode",
                "LRU缓存机制"
            ]
        },
        {
            "id": "https://windlinxy.top/2023/03/03/d91775c4b914/",
            "url": "https://windlinxy.top/2023/03/03/d91775c4b914/",
            "title": "3月2日LeetCode刷题",
            "date_published": "2023-03-03T09:05:51.000Z",
            "content_html": "<h2 id=\"跳跃游戏\"><a class=\"anchor\" href=\"#跳跃游戏\">#</a> 跳跃游戏</h2>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly9sZWV0Y29kZS5jbi9wcm9ibGVtcy9qdW1wLWdhbWUvZGVzY3JpcHRpb24v\">55. 跳跃游戏</span></p>\n<blockquote>\n<p>给定一个非负整数数组  <code>nums</code></p>\n<p>数组中的每个元素代表你在该位置可以跳跃的最大长度。</p>\n<p>判断你是否能够到达最后一个下标。</p>\n<p>示例：</p>\n<p>输入：nums = [2,3,1,1,4]<br />\n 输出：true<br />\n 解释：可以先跳 1 步，从下标 0 到达下标 1, 然后再从下标 1 跳 3 步到达最后一个下标。</p>\n<p>输入：nums = [3,2,1,0,4]<br />\n 输出：false<br />\n 解释：无论怎样，总会到达下标为 3 的位置。但该下标的最大跳跃长度是 0 ， 所以永远不可能到达最后一个下标。</p>\n</blockquote>\n<p><mark>贪心</mark>思路：找到一个下标，这个下标刚好可以到达最后下一个下标。</p>\n<ul>\n<li>从下标  <code> i</code>  出发可达区间  <code>(i, i + nums[i] ]</code> ， 当然， <code>i &lt; nums.length</code> 。</li>\n<li>前 <code>n</code>  个下标会有一个最大可达下标 <code>max = max(max, i + nums[i])）</code> 。</li>\n<li>当 <code>max &gt;= nums.length - 1</code>  时，这个数组的最后一个下标是可达的。</li>\n<li>下标 <code>i</code>  不会超过最大可达下标： <code>i &lt;= max</code></li>\n</ul>\n<p><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"type\">boolean</span> <span class=\"title function_\">canJump</span><span class=\"params\">(<span class=\"type\">int</span>[] nums)</span> &#123;</span><br><span class=\"line\">    <span class=\"type\">int</span> <span class=\"variable\">len</span> <span class=\"operator\">=</span> nums.length;</span><br><span class=\"line\">    <span class=\"type\">int</span> <span class=\"variable\">max</span> <span class=\"operator\">=</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">    <span class=\"keyword\">for</span>(<span class=\"type\">int</span> <span class=\"variable\">i</span> <span class=\"operator\">=</span> <span class=\"number\">0</span>; i &lt; len &amp;&amp; i&lt;=max; i++) &#123;</span><br><span class=\"line\">        max = Math.max(nums[i] + i, max);</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(max &gt;= len-<span class=\"number\">1</span>) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"literal\">false</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<h2 id=\"最长有效括号\"><a class=\"anchor\" href=\"#最长有效括号\">#</a> 最长有效括号</h2>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly9sZWV0Y29kZS5jbi9wcm9ibGVtcy9sb25nZXN0LXZhbGlkLXBhcmVudGhlc2VzL2Rlc2NyaXB0aW9uLw==\">32. 最长有效括号</span></p>\n<blockquote>\n<p>给你一个只包含  <code>'('</code>  和  <code>')'</code>  的字符串，找出最长有效（格式正确且连续）括号子串的长度。</p>\n<p>输入：s = &quot;)()())&quot;<br />\n 输出：4<br />\n 解释：最长有效括号子串是 &quot;()()&quot;</p>\n</blockquote>\n<p><strong>动态规划 + 双指针</strong></p>\n<ul>\n<li><code>max</code>  记录最长括号子串括号数。</li>\n<li><code>left</code>  和 <code> right</code>  在遍历时记录左括号和右括号数。</li>\n<li>当 <code>right == left</code>  时说明括号匹配，记录 <code>max = Math.max(right,max)</code> 。</li>\n<li><code>right &gt; left</code>  说明子串中有括号匹配不了， <code>left</code>  和 <code>right</code>  置 0。</li>\n</ul>\n<p>这时候就有一个问题：以上操作只能判断 <code>)</code>  无法匹配的情况，如何解决 <code>(</code> 无法匹配的情况？</p>\n<p>可以反转字符串重复以上步骤</p>\n<p><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"type\">int</span> <span class=\"title function_\">longestValidParentheses</span><span class=\"params\">(String s)</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (s == <span class=\"literal\">null</span> || <span class=\"string\">&quot;&quot;</span>.equals(s)) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"type\">int</span> <span class=\"variable\">left</span> <span class=\"operator\">=</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">    <span class=\"type\">int</span> <span class=\"variable\">right</span> <span class=\"operator\">=</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">    <span class=\"type\">int</span> <span class=\"variable\">max</span> <span class=\"operator\">=</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">    <span class=\"keyword\">for</span>(Character c : s.toCharArray()) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span>( c == <span class=\"string\">&#x27;(&#x27;</span>)&#123;</span><br><span class=\"line\">            left++;</span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            right++;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(left == right) &#123;</span><br><span class=\"line\">            max = Math.max(right,max);</span><br><span class=\"line\">        &#125;<span class=\"keyword\">else</span> <span class=\"keyword\">if</span>(right &gt; left) &#123;</span><br><span class=\"line\">            right = <span class=\"number\">0</span>;</span><br><span class=\"line\">            left = <span class=\"number\">0</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    left = <span class=\"number\">0</span>;</span><br><span class=\"line\">    right = <span class=\"number\">0</span>;</span><br><span class=\"line\">    <span class=\"comment\">// 翻转字符串再次操作</span></span><br><span class=\"line\">    <span class=\"keyword\">for</span>(Character c : <span class=\"keyword\">new</span> <span class=\"title class_\">StringBuilder</span>(s).reverse().toString().toCharArray()) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span>( c == <span class=\"string\">&#x27;(&#x27;</span>)&#123;</span><br><span class=\"line\">            left++;</span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            right++;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(left == right) &#123;</span><br><span class=\"line\">            max = Math.max(left,max);</span><br><span class=\"line\">        <span class=\"comment\">// 反转后需要判断left &gt; right </span></span><br><span class=\"line\">        &#125;<span class=\"keyword\">else</span> <span class=\"keyword\">if</span>(left &gt; right) &#123;</span><br><span class=\"line\">            right = <span class=\"number\">0</span>;</span><br><span class=\"line\">            left = <span class=\"number\">0</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> max &lt;&lt; <span class=\"number\">1</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<h2 id=\"最长公共前缀\"><a class=\"anchor\" href=\"#最长公共前缀\">#</a> 最长公共前缀</h2>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly9sZWV0Y29kZS5jbi9wcm9ibGVtcy9sb25nZXN0LWNvbW1vbi1wcmVmaXgvZGVzY3JpcHRpb24v\">14. 最长公共前缀</span></p>\n<blockquote>\n<p>编写一个函数来查找字符串数组中的最长公共前缀。</p>\n<p>如果不存在公共前缀，返回空字符串  <code>&quot;&quot;</code> 。</p>\n<p>输入：strs = [&quot;flower&quot;,&quot;flow&quot;,&quot;flight&quot;]<br />\n 输出：&quot;fl&quot;</p>\n</blockquote>\n<p>边界条件太多，要判断。</p>\n<p><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> String <span class=\"title function_\">longestCommonPrefix</span><span class=\"params\">(String[] strs)</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">// 长度为0直接返回</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span>(strs.length == <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"string\">&quot;&quot;</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"comment\">// 包含一个“ ”直接返回</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span>(strs.length == <span class=\"number\">1</span> || strs[<span class=\"number\">0</span>].equals(<span class=\"string\">&quot;&quot;</span>))&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> strs[<span class=\"number\">0</span>];</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"type\">String</span> <span class=\"variable\">base</span> <span class=\"operator\">=</span> strs[<span class=\"number\">0</span>];</span><br><span class=\"line\">    <span class=\"type\">int</span> <span class=\"variable\">res</span> <span class=\"operator\">=</span> base.length();</span><br><span class=\"line\">    <span class=\"keyword\">for</span>(String str : strs) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(str.equals(base))&#123;</span><br><span class=\"line\">            <span class=\"keyword\">continue</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"comment\">// 有一个&quot; &quot;字符串或者两字符串第一个字母不相同直接返回</span></span><br><span class=\"line\">        <span class=\"keyword\">if</span>(str.equals(<span class=\"string\">&quot;&quot;</span>) || str.charAt(<span class=\"number\">0</span>) != str.charAt(<span class=\"number\">0</span>))&#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"string\">&quot;&quot;</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"type\">int</span> <span class=\"variable\">index</span> <span class=\"operator\">=</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">        <span class=\"type\">int</span> <span class=\"variable\">count</span> <span class=\"operator\">=</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">        <span class=\"keyword\">while</span>(index &lt; base.length() &amp;&amp; index &lt; str.length()) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">if</span>(str.charAt(index) == base.charAt(index))&#123;</span><br><span class=\"line\">                count++;</span><br><span class=\"line\">                index++;</span><br><span class=\"line\">            &#125;<span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">                <span class=\"keyword\">break</span>;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        res = Math.min(count,res);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> base.substring(<span class=\"number\">0</span>,res);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<h2 id=\"两数组交集\"><a class=\"anchor\" href=\"#两数组交集\">#</a> 两数组交集</h2>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly9sZWV0Y29kZS5jbi9wcm9ibGVtcy9pbnRlcnNlY3Rpb24tb2YtdHdvLWFycmF5cy9kZXNjcmlwdGlvbi8=\">349. 两个数组的交集</span></p>\n<blockquote>\n<p>给定两个数组  <code>nums1</code>  和  <code>nums2</code>  ，返回 <em>它们的交集</em> 。输出结果中的每个元素一定是 <strong>唯一</strong> 的。我们可以 <strong>不考虑输出结果的顺序</strong> 。</p>\n</blockquote>\n<p>直接用 HashSet 解决</p>\n<p><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"type\">int</span>[] intersection(<span class=\"type\">int</span>[] nums1, <span class=\"type\">int</span>[] nums2) &#123;</span><br><span class=\"line\">    HashSet&lt;Integer&gt; set1 = <span class=\"keyword\">new</span> <span class=\"title class_\">HashSet</span>&lt;&gt;();</span><br><span class=\"line\">    HashSet&lt;Integer&gt; set2 = <span class=\"keyword\">new</span> <span class=\"title class_\">HashSet</span>&lt;&gt;();</span><br><span class=\"line\">    <span class=\"keyword\">for</span>(<span class=\"type\">int</span> i : nums1) &#123;</span><br><span class=\"line\">        set1.add(i);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"type\">int</span> i : nums2)&#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(set1.contains(i)) &#123;</span><br><span class=\"line\">            set2.add(i);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"type\">int</span> [] res = <span class=\"keyword\">new</span> <span class=\"title class_\">int</span>[set2.size()];</span><br><span class=\"line\">    <span class=\"type\">int</span> <span class=\"variable\">index</span> <span class=\"operator\">=</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">    <span class=\"keyword\">for</span>(<span class=\"type\">int</span> i : set2) &#123;</span><br><span class=\"line\">        res[index++] = i;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span>  res;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n",
            "tags": [
                "LeetCode刷题",
                "LeetCode",
                "跳跃游戏",
                "贪心",
                "最长有效括号",
                "两数组交集",
                "最长公共前缀"
            ]
        },
        {
            "id": "https://windlinxy.top/2023/03/02/e88df4d29e80/",
            "url": "https://windlinxy.top/2023/03/02/e88df4d29e80/",
            "title": "3月2日LeetCode刷题",
            "date_published": "2023-03-02T02:05:51.000Z",
            "content_html": "<h2 id=\"相交链表\"><a class=\"anchor\" href=\"#相交链表\">#</a> 相交链表</h2>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly9sZWV0Y29kZS5jbi9wcm9ibGVtcy9pbnRlcnNlY3Rpb24tb2YtdHdvLWxpbmtlZC1saXN0cy8=\">LeetCode：160. 相交链表</span></p>\n<blockquote>\n<p>给你两个单链表的头节点  <code>headA</code>  和  <code>headB</code>  ，请你找出并返回两个单链表相交的起始节点。如果两个链表不存在相交节点，返回  <code>null</code>  。</p>\n<p>图示两个链表在节点  <code>c1</code>  开始相交 **：**</p>\n<p><img data-src=\"https://raw.githubusercontent.com/Windlinxy/Typora-img/main/img/202303021100493.png\" alt=\"image-20230302110002342\" /></p>\n<p>题目数据 <strong>保证</strong> 整个链式结构中不存在环。</p>\n<p><strong>注意</strong>，函数返回结果后，链表必须 <strong>保持其原始结构</strong> 。</p>\n</blockquote>\n<p><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/* Definition for singly-linked list.</span></span><br><span class=\"line\"><span class=\"comment\">* 定义数据结构</span></span><br><span class=\"line\"><span class=\"comment\">*/</span></span><br><span class=\"line\"> <span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">ListNode</span> &#123;</span><br><span class=\"line\">     <span class=\"type\">int</span> val;</span><br><span class=\"line\">     ListNode next;</span><br><span class=\"line\">     ListNode(<span class=\"type\">int</span> x) &#123;</span><br><span class=\"line\">         val = x;</span><br><span class=\"line\">         next = <span class=\"literal\">null</span>;</span><br><span class=\"line\">     &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"> </span><br></pre></td></tr></table></figure></p>\n<p>一开始我想到的是判重，可以用哈希表（Map 或者 Set）</p>\n<p><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 使用HashMap 以cur.next节点为key，cur为value来找</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> ListNode <span class=\"title function_\">getIntersectionNode</span><span class=\"params\">(ListNode headA, ListNode headB)</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(headA == headB)&#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> headA;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        Map&lt;ListNode, ListNode&gt; map = <span class=\"keyword\">new</span> <span class=\"title class_\">HashMap</span>&lt;&gt;();</span><br><span class=\"line\">        <span class=\"type\">ListNode</span> <span class=\"variable\">curA</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">ListNode</span>();</span><br><span class=\"line\">        <span class=\"type\">ListNode</span> <span class=\"variable\">curB</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">ListNode</span>();</span><br><span class=\"line\">        curA.next = headA;</span><br><span class=\"line\">        curB.next = headB;</span><br><span class=\"line\">        <span class=\"keyword\">while</span>(curA!=<span class=\"literal\">null</span> || curB!=<span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">if</span>(curA!=<span class=\"literal\">null</span>)&#123;</span><br><span class=\"line\">                <span class=\"keyword\">if</span>(map.containsKey(curA.next))&#123;</span><br><span class=\"line\">                    <span class=\"keyword\">return</span> curA.next;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">                map.put(curA.next, curA);</span><br><span class=\"line\">                curA = curA.next;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            <span class=\"keyword\">if</span>(curB!=<span class=\"literal\">null</span>)&#123;</span><br><span class=\"line\">                <span class=\"keyword\">if</span>(map.containsKey(curB.next))&#123;</span><br><span class=\"line\">                    <span class=\"keyword\">return</span> curB.next;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">                map.put(curB.next, curB);</span><br><span class=\"line\">                curB = curB.next;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">null</span>;</span><br><span class=\"line\">    &#125;</span><br></pre></td></tr></table></figure></p>\n<p><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 用HashSet直接找</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> ListNode <span class=\"title function_\">getIntersectionNode</span><span class=\"params\">(ListNode headA, ListNode headB)</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(headA == headB)&#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> headA;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        HashSet&lt;ListNode&gt; set = <span class=\"keyword\">new</span> <span class=\"title class_\">HashSet</span>&lt;&gt;();</span><br><span class=\"line\">        <span class=\"keyword\">while</span>(headA != <span class=\"literal\">null</span> || headB != <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">if</span>(headA != <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">                <span class=\"keyword\">if</span>(set.contains(headA))</span><br><span class=\"line\">                    <span class=\"keyword\">return</span> headA;</span><br><span class=\"line\">                </span><br><span class=\"line\">                set.add(headA);</span><br><span class=\"line\">                headA = headA.next;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            <span class=\"keyword\">if</span>(headB != <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">                <span class=\"keyword\">if</span>(set.contains(headB))</span><br><span class=\"line\">                    <span class=\"keyword\">return</span> headB;</span><br><span class=\"line\">                set.add(headB);</span><br><span class=\"line\">                headB = headB.next;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">null</span>;</span><br><span class=\"line\">    &#125;</span><br></pre></td></tr></table></figure></p>\n<p>可能条件有些冗余，但是可以在两个链表遍历完前找到相交节点。</p>\n<p>看完题解后，时间复杂度<strong> O (m+n)</strong>，空间 **O (1)** 的解法是：两链表相交后长度是一样的，那么我们不考虑相交后的节点，相交前两链表的节点数是不一样多的，这时候如果指针 headA 遍历完 A 链表去遍历 B 链表，同时 headB 遍历完 B 链表去遍历 A 链表，那么这两个指针在第二次到达相交节点时会相遇，即可得到第一个相交节点。</p>\n<ul>\n<li>pA 指针遍历 A 链表，pB 指针遍历 B 链表</li>\n<li>两指针同时遍历下一个</li>\n<li>当 pA 到达 A 链表尾部，开始从头遍历 B 链表，当 pB 到达 B 链表尾部，开始从头遍历 B 链表</li>\n<li>pA 与 pB 相遇，得到相交节点</li>\n</ul>\n<p><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> ListNode <span class=\"title function_\">getIntersectionNode</span><span class=\"params\">(ListNode headA, ListNode headB)</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(headA == headB)&#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> headA;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"type\">ListNode</span> <span class=\"variable\">pA</span> <span class=\"operator\">=</span> headA;</span><br><span class=\"line\">        <span class=\"type\">ListNode</span> <span class=\"variable\">pB</span> <span class=\"operator\">=</span> headB;</span><br><span class=\"line\">        <span class=\"keyword\">while</span>(pA != pB) &#123;</span><br><span class=\"line\">            pA = pA == <span class=\"literal\">null</span>? headB : pA.next;</span><br><span class=\"line\">            pB = pB == <span class=\"literal\">null</span>? headA : pB.next;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> pA;</span><br><span class=\"line\">    &#125;</span><br></pre></td></tr></table></figure></p>\n<h2 id=\"字符串相加\"><a class=\"anchor\" href=\"#字符串相加\">#</a> 字符串相加</h2>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly9sZWV0Y29kZS5jbi9wcm9ibGVtcy9hZGQtc3RyaW5ncy9kZXNjcmlwdGlvbi8=\">LeetCode 415. 字符串相加</span></p>\n<ul>\n<li>使用 StringBuilder 进行字符串拼接</li>\n<li>双指针从最后一个数开始计算</li>\n<li>count 记录进位</li>\n</ul>\n<p><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> String <span class=\"title function_\">addStrings</span><span class=\"params\">(String num1, String num2)</span> &#123;</span><br><span class=\"line\">        <span class=\"type\">int</span> <span class=\"variable\">len1</span> <span class=\"operator\">=</span> num1.length() - <span class=\"number\">1</span>;</span><br><span class=\"line\">        <span class=\"type\">int</span> <span class=\"variable\">len2</span> <span class=\"operator\">=</span> num2.length() - <span class=\"number\">1</span>;</span><br><span class=\"line\">        <span class=\"type\">int</span> <span class=\"variable\">count</span> <span class=\"operator\">=</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">        <span class=\"type\">StringBuilder</span> <span class=\"variable\">res</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">StringBuilder</span>();</span><br><span class=\"line\">        <span class=\"keyword\">while</span>(len1 &gt;= <span class=\"number\">0</span> || len2 &gt;= <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">            <span class=\"type\">int</span> <span class=\"variable\">a</span> <span class=\"operator\">=</span> len1 &gt;= <span class=\"number\">0</span> ? num1.charAt(len1) - <span class=\"string\">&#x27;0&#x27;</span> : <span class=\"number\">0</span>;</span><br><span class=\"line\">            <span class=\"type\">int</span> <span class=\"variable\">b</span> <span class=\"operator\">=</span> len2 &gt;= <span class=\"number\">0</span> ? num2.charAt(len2) - <span class=\"string\">&#x27;0&#x27;</span> : <span class=\"number\">0</span>;</span><br><span class=\"line\">            <span class=\"type\">int</span> <span class=\"variable\">sum</span> <span class=\"operator\">=</span> a + b + count;</span><br><span class=\"line\">            count = sum/<span class=\"number\">10</span>;</span><br><span class=\"line\">            res.append(sum%<span class=\"number\">10</span>);</span><br><span class=\"line\">            len1--;</span><br><span class=\"line\">            len2--;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(count == <span class=\"number\">1</span>) &#123;</span><br><span class=\"line\">            res.append(<span class=\"number\">1</span>);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> res.reverse().toString();</span><br><span class=\"line\">    &#125;</span><br></pre></td></tr></table></figure></p>\n<h2 id=\"二分查找\"><a class=\"anchor\" href=\"#二分查找\">#</a> 二分查找</h2>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly9sZWV0Y29kZS5jbi9wcm9ibGVtcy9iaW5hcnktc2VhcmNoL2Rlc2NyaXB0aW9uLw==\">704. 二分查找</span></p>\n<p><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"type\">int</span> <span class=\"title function_\">search</span><span class=\"params\">(<span class=\"type\">int</span>[] nums, <span class=\"type\">int</span> target)</span> &#123;</span><br><span class=\"line\">        <span class=\"type\">int</span> <span class=\"variable\">left</span> <span class=\"operator\">=</span> <span class=\"number\">0</span>, right = nums.length - <span class=\"number\">1</span>;</span><br><span class=\"line\">        <span class=\"keyword\">while</span> (left &lt;= right) &#123;</span><br><span class=\"line\">            <span class=\"type\">int</span> <span class=\"variable\">mid</span> <span class=\"operator\">=</span> (right - left) / <span class=\"number\">2</span> + left;</span><br><span class=\"line\">            <span class=\"type\">int</span> <span class=\"variable\">num</span> <span class=\"operator\">=</span> nums[mid];</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (num == target) &#123;</span><br><span class=\"line\">                <span class=\"keyword\">return</span> mid;</span><br><span class=\"line\">            &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (num &gt; target) &#123;</span><br><span class=\"line\">                right = mid - <span class=\"number\">1</span>;</span><br><span class=\"line\">            &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">                left = mid + <span class=\"number\">1</span>;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> -<span class=\"number\">1</span>;</span><br><span class=\"line\">    &#125;</span><br></pre></td></tr></table></figure></p>\n",
            "tags": [
                "LeetCode刷题",
                "LeetCode",
                "链表",
                "二分查找",
                "字符串相加"
            ]
        },
        {
            "id": "https://windlinxy.top/2023/03/01/fa472e2adb8b/",
            "url": "https://windlinxy.top/2023/03/01/fa472e2adb8b/",
            "title": "一些模板代码",
            "date_published": "2023-03-01T02:41:04.000Z",
            "content_html": "<h2 id=\"统一返回响应体封装\"><a class=\"anchor\" href=\"#统一返回响应体封装\">#</a> 统一返回响应体封装</h2>\n<p><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Data</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">JsonResult</span>&lt;T&gt; &#123;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 错误码</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> Integer code;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 提示信息</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> String msg;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 返回的具体内容</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> T data;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"title function_\">JsonResult</span><span class=\"params\">(Integer code, String msg, T data)</span> &#123;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.code = code;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.msg = msg;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.data = data;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"title function_\">JsonResult</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> JsonResult&lt;T&gt; <span class=\"title function_\">fail</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"title class_\">JsonResult</span>&lt;&gt;(<span class=\"number\">1000</span>, <span class=\"string\">&quot;操作失败&quot;</span>, <span class=\"literal\">null</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> JsonResult&lt;T&gt; <span class=\"title function_\">fail</span><span class=\"params\">(String msg)</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"title class_\">JsonResult</span>&lt;&gt;(<span class=\"number\">1001</span>, msg, <span class=\"literal\">null</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> JsonResult&lt;T&gt; <span class=\"title function_\">ok</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"title class_\">JsonResult</span>&lt;&gt;(<span class=\"number\">2000</span>, <span class=\"string\">&quot;操作成功&quot;</span>, <span class=\"literal\">null</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> JsonResult&lt;T&gt; <span class=\"title function_\">ok</span><span class=\"params\">(T data)</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"title class_\">JsonResult</span>&lt;&gt;(<span class=\"number\">2001</span>, <span class=\"string\">&quot;操作成功&quot;</span>, data);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> JsonResult&lt;T&gt; <span class=\"title function_\">jud</span><span class=\"params\">(<span class=\"type\">boolean</span> condition)</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> condition ? ok() : fail();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title function_\">returnMsg</span><span class=\"params\">(HttpServletResponse response, String msg)</span> <span class=\"keyword\">throws</span> IOException &#123;</span><br><span class=\"line\">        response.setCharacterEncoding(<span class=\"string\">&quot;utf-8&quot;</span>);</span><br><span class=\"line\">        PrintWriter out;</span><br><span class=\"line\">        String jsonString;</span><br><span class=\"line\">        out = response.getWriter();</span><br><span class=\"line\">        jsonString = <span class=\"keyword\">new</span> <span class=\"title class_\">ObjectMapper</span>().writeValueAsString(<span class=\"keyword\">new</span> <span class=\"title class_\">JsonResult</span>&lt;&gt;().fail(msg));</span><br><span class=\"line\">        out.println(jsonString);</span><br><span class=\"line\">        out.flush();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<h2 id=\"jwt配置\"><a class=\"anchor\" href=\"#jwt配置\">#</a> JWT 配置</h2>\n<p><figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">&lt;!--jwt依赖--&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>io.jsonwebtoken<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>jjwt<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>0.9.0<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure></p>\n<p><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Slf4j(topic = &quot;jwtConfig&quot;)</span></span><br><span class=\"line\"><span class=\"meta\">@Data</span></span><br><span class=\"line\"><span class=\"meta\">@Component</span></span><br><span class=\"line\"><span class=\"meta\">@ConfigurationProperties(prefix = &quot;jwt&quot;)</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">JwtConfig</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 密钥</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"type\">String</span> <span class=\"variable\">secret</span> <span class=\"operator\">=</span> <span class=\"string\">&quot;XXXXX&quot;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 过期时间（单位：秒）-- 1小时</span></span><br><span class=\"line\"><span class=\"comment\">     **/</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"type\">long</span> <span class=\"variable\">expireTime</span> <span class=\"operator\">=</span> <span class=\"number\">60</span> * <span class=\"number\">60</span> * <span class=\"number\">1000L</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> String <span class=\"title function_\">sign</span><span class=\"params\">(User user)</span> &#123;</span><br><span class=\"line\">        Map&lt;String, Object&gt; claim = <span class=\"keyword\">new</span> <span class=\"title class_\">HashMap</span>&lt;&gt;();</span><br><span class=\"line\">        claim.put(<span class=\"string\">&quot;username&quot;</span>, user.getUsername());</span><br><span class=\"line\">        claim.put(<span class=\"string\">&quot;userId&quot;</span>, user.getUserId());</span><br><span class=\"line\">        <span class=\"type\">Date</span> <span class=\"variable\">date</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">Date</span>();</span><br><span class=\"line\">        <span class=\"keyword\">return</span> Jwts.builder()</span><br><span class=\"line\">                .setClaims(claim)</span><br><span class=\"line\">                .setIssuedAt(date)</span><br><span class=\"line\">                .setExpiration(<span class=\"keyword\">new</span> <span class=\"title class_\">Date</span>(date.getTime() + expireTime))</span><br><span class=\"line\">                .signWith(SignatureAlgorithm.HS512, secret)</span><br><span class=\"line\">                .compact();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 获取token中注册信息</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> Claims <span class=\"title function_\">getTokenClaim</span><span class=\"params\">(String token)</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> Jwts.parser().setSigningKey(secret).parseClaimsJws(token).getBody();</span><br><span class=\"line\">        &#125; <span class=\"keyword\">catch</span> (Exception e) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"literal\">null</span>;</span><br><span class=\"line\">            <span class=\"comment\">/*  catch (ExpiredJwtException e)&#123;</span></span><br><span class=\"line\"><span class=\"comment\">                    return e.getClaims(); //防止jwt过期解析报错</span></span><br><span class=\"line\"><span class=\"comment\">                &#125;</span></span><br><span class=\"line\"><span class=\"comment\">            */</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 验证token是否过期失效</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> token 令牌</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"type\">boolean</span> <span class=\"title function_\">isTokenExpired</span><span class=\"params\">(String token)</span> &#123;</span><br><span class=\"line\">        <span class=\"type\">Date</span> <span class=\"variable\">expiration</span> <span class=\"operator\">=</span> getExpirationDateFromToken(token);</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (expiration != <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> getExpirationDateFromToken(token).before(<span class=\"keyword\">new</span> <span class=\"title class_\">Date</span>());</span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 获取token失效时间</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> token 令牌</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> Date <span class=\"title function_\">getExpirationDateFromToken</span><span class=\"params\">(String token)</span> &#123;</span><br><span class=\"line\">        <span class=\"type\">Claims</span> <span class=\"variable\">claims</span> <span class=\"operator\">=</span> getTokenClaim(token);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> (claims == <span class=\"literal\">null</span>) ? <span class=\"literal\">null</span> : claims.getExpiration();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 获取用户名从token中</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> User <span class=\"title function_\">getUser</span><span class=\"params\">(String token)</span> &#123;</span><br><span class=\"line\">        <span class=\"type\">Claims</span> <span class=\"variable\">map</span> <span class=\"operator\">=</span> getTokenClaim(token);</span><br><span class=\"line\">        <span class=\"type\">String</span> <span class=\"variable\">username</span> <span class=\"operator\">=</span> (String) map.get(<span class=\"string\">&quot;username&quot;</span>);</span><br><span class=\"line\">        <span class=\"type\">Integer</span> <span class=\"variable\">userId</span> <span class=\"operator\">=</span> (Integer) map.get(<span class=\"string\">&quot;userId&quot;</span>);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"title class_\">User</span>(userId, username);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 获取jwt发布时间</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> Date <span class=\"title function_\">getIssuedAtDateFromToken</span><span class=\"params\">(String token)</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> getTokenClaim(token).getIssuedAt();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure></p>\n<p>还有一个版本</p>\n<p><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * JWT工具类</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">JwtUtil</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 有效期为 60 * 60 * 1000  一个小时</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"type\">Long</span> <span class=\"variable\">JWT_TTL</span> <span class=\"operator\">=</span> <span class=\"number\">60</span> * <span class=\"number\">60</span> * <span class=\"number\">1000L</span>;</span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 设置秘钥明文</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"type\">String</span> <span class=\"variable\">JWT_KEY</span> <span class=\"operator\">=</span> <span class=\"string\">&quot;XXXXXX&quot;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> String <span class=\"title function_\">getUUID</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> UUID.randomUUID().toString().replaceAll(<span class=\"string\">&quot;-&quot;</span>, <span class=\"string\">&quot;&quot;</span>).substring(<span class=\"number\">0</span>,<span class=\"number\">8</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 生成jtw</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> subject token中要存放的数据（json格式）</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span></span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> String <span class=\"title function_\">createJWT</span><span class=\"params\">(String subject)</span> &#123;</span><br><span class=\"line\">        <span class=\"comment\">// 设置过期时间</span></span><br><span class=\"line\">        <span class=\"type\">JwtBuilder</span> <span class=\"variable\">builder</span> <span class=\"operator\">=</span> getJwtBuilder(subject, <span class=\"literal\">null</span>, getUUID());</span><br><span class=\"line\">        <span class=\"keyword\">return</span> builder.compact();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 生成jtw</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> subject   token中要存放的数据（json格式）</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> ttlMillis token超时时间</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span></span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> String <span class=\"title function_\">createJWT</span><span class=\"params\">(String subject, Long ttlMillis)</span> &#123;</span><br><span class=\"line\">        <span class=\"comment\">// 设置过期时间</span></span><br><span class=\"line\">        <span class=\"type\">JwtBuilder</span> <span class=\"variable\">builder</span> <span class=\"operator\">=</span> getJwtBuilder(subject, ttlMillis, getUUID());</span><br><span class=\"line\">        <span class=\"keyword\">return</span> builder.compact();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 创建token</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> id</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> subject</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> ttlMillis</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span></span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> String <span class=\"title function_\">createJWT</span><span class=\"params\">(String id, String subject, Long ttlMillis)</span> &#123;</span><br><span class=\"line\">        <span class=\"type\">JwtBuilder</span> <span class=\"variable\">builder</span> <span class=\"operator\">=</span> getJwtBuilder(subject, ttlMillis, id);<span class=\"comment\">// 设置过期时间</span></span><br><span class=\"line\">        <span class=\"keyword\">return</span> builder.compact();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">static</span> JwtBuilder <span class=\"title function_\">getJwtBuilder</span><span class=\"params\">(String subject, Long ttlMillis, String uuid)</span> &#123;</span><br><span class=\"line\">        <span class=\"type\">SecretKey</span> <span class=\"variable\">secretKey</span> <span class=\"operator\">=</span> generalKey();</span><br><span class=\"line\">        <span class=\"type\">long</span> <span class=\"variable\">nowMillis</span> <span class=\"operator\">=</span> System.currentTimeMillis();</span><br><span class=\"line\">        <span class=\"type\">Date</span> <span class=\"variable\">now</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">Date</span>(nowMillis);</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (ttlMillis == <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">            ttlMillis = JwtUtil.JWT_TTL;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"type\">long</span> <span class=\"variable\">expMillis</span> <span class=\"operator\">=</span> nowMillis + ttlMillis;</span><br><span class=\"line\">        <span class=\"type\">Date</span> <span class=\"variable\">expDate</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">Date</span>(expMillis);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> Jwts.builder()</span><br><span class=\"line\">                <span class=\"comment\">// jti:jwt的唯一身份标识，主要用来作为一次性token,从而回避重放攻击。</span></span><br><span class=\"line\">                .setId(uuid)</span><br><span class=\"line\">                <span class=\"comment\">// sub: jwt所面向的用户</span></span><br><span class=\"line\">                .setSubject(subject)</span><br><span class=\"line\">                <span class=\"comment\">// iss: 签发者</span></span><br><span class=\"line\">                .setIssuer(<span class=\"string\">&quot;windlinxy.top&quot;</span>)</span><br><span class=\"line\">                <span class=\"comment\">// iat: jwt的签发时间</span></span><br><span class=\"line\">                .setIssuedAt(now)</span><br><span class=\"line\">                <span class=\"comment\">// exp: jwt的过期时间</span></span><br><span class=\"line\">                .setExpiration(expDate)</span><br><span class=\"line\">                <span class=\"comment\">//使用HS256对称加密算法签名, 第二个参数为秘钥</span></span><br><span class=\"line\">                .signWith(SignatureAlgorithm.HS256, secretKey);</span><br><span class=\"line\"></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title function_\">main</span><span class=\"params\">(String[] args)</span> <span class=\"keyword\">throws</span> Exception &#123;</span><br><span class=\"line\">        <span class=\"type\">long</span> <span class=\"variable\">now</span> <span class=\"operator\">=</span> System.currentTimeMillis();</span><br><span class=\"line\">        System.out.println(<span class=\"keyword\">new</span> <span class=\"title class_\">Date</span>());</span><br><span class=\"line\">        <span class=\"type\">String</span> <span class=\"variable\">token</span> <span class=\"operator\">=</span> createJWT(<span class=\"string\">&quot;nihao&quot;</span>);</span><br><span class=\"line\">        <span class=\"type\">Claims</span> <span class=\"variable\">claims</span> <span class=\"operator\">=</span> parseJWT(<span class=\"string\">&quot;token&quot;</span>);</span><br><span class=\"line\">        System.out.println(System.currentTimeMillis() - now);</span><br><span class=\"line\">        System.out.println(<span class=\"keyword\">new</span> <span class=\"title class_\">Date</span>());</span><br><span class=\"line\">        System.out.println(token);</span><br><span class=\"line\">        System.out.println(claims);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 生成加密后的秘钥 secretKey</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span></span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> SecretKey <span class=\"title function_\">generalKey</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        <span class=\"type\">byte</span>[] encodedKey = Base64.getDecoder().decode(JwtUtil.JWT_KEY);</span><br><span class=\"line\">        <span class=\"type\">SecretKey</span> <span class=\"variable\">key</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">SecretKeySpec</span>(encodedKey, <span class=\"number\">0</span>, encodedKey.length, <span class=\"string\">&quot;AES&quot;</span>);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> key;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 解析</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> jwt</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span></span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@throws</span> Exception</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> Claims <span class=\"title function_\">parseJWT</span><span class=\"params\">(String jwt)</span> <span class=\"keyword\">throws</span> Exception &#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(jwt == <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"literal\">null</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"type\">SecretKey</span> <span class=\"variable\">secretKey</span> <span class=\"operator\">=</span> generalKey();</span><br><span class=\"line\">        <span class=\"keyword\">return</span> Jwts.parser()</span><br><span class=\"line\">                .setSigningKey(secretKey)</span><br><span class=\"line\">                .parseClaimsJws(jwt)</span><br><span class=\"line\">                .getBody();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<h2 id=\"cors跨域解决\"><a class=\"anchor\" href=\"#cors跨域解决\">#</a> CORS 跨域解决</h2>\n<p><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Configuration</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">WebAppConfig</span> <span class=\"keyword\">implements</span> <span class=\"title class_\">WebMvcConfigurer</span> &#123;</span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">addCorsMappings</span><span class=\"params\">(CorsRegistry registry)</span> &#123;</span><br><span class=\"line\">        registry.addMapping(<span class=\"string\">&quot;/**&quot;</span>)</span><br><span class=\"line\">                <span class=\"comment\">//是否发送Cookie</span></span><br><span class=\"line\">                .allowCredentials(<span class=\"literal\">true</span>)</span><br><span class=\"line\">                <span class=\"comment\">//放行哪些原始域</span></span><br><span class=\"line\">                .allowedOriginPatterns(<span class=\"string\">&quot;*&quot;</span>)</span><br><span class=\"line\">                .allowedMethods(<span class=\"string\">&quot;*&quot;</span>)</span><br><span class=\"line\">                .allowedHeaders(<span class=\"string\">&quot;*&quot;</span>)</span><br><span class=\"line\">                .exposedHeaders(<span class=\"string\">&quot;*&quot;</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<h2 id=\"拦截器注解拦截\"><a class=\"anchor\" href=\"#拦截器注解拦截\">#</a> 拦截器（注解拦截）</h2>\n<p><code>@PassToken</code></p>\n<p><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@author</span> Windlinxy</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@description</span>: 权限判断跳过</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@create</span> 2023-01-30 19:11</span></span><br><span class=\"line\"><span class=\"comment\"> **/</span></span><br><span class=\"line\"><span class=\"meta\">@Target(&#123;ElementType.METHOD, ElementType.TYPE&#125;)</span></span><br><span class=\"line\"><span class=\"meta\">@Retention(RetentionPolicy.RUNTIME)</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"meta\">@interface</span> PassToken &#123;</span><br><span class=\"line\">    <span class=\"type\">boolean</span> <span class=\"title function_\">required</span><span class=\"params\">()</span> <span class=\"keyword\">default</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<p>拦截器</p>\n<p><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Slf4j(topic = &quot;AdminInterceptor&quot;)</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">AdminInterceptor</span> <span class=\"keyword\">implements</span> <span class=\"title class_\">HandlerInterceptor</span> &#123;</span><br><span class=\"line\">    <span class=\"meta\">@Resource</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> JwtConfig jwtConfig;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"type\">boolean</span> <span class=\"title function_\">preHandle</span><span class=\"params\">(HttpServletRequest request, HttpServletResponse response, Object handler)</span> <span class=\"keyword\">throws</span> Exception &#123;</span><br><span class=\"line\">       <span class=\"comment\">/*</span></span><br><span class=\"line\"><span class=\"comment\">        * 放行预检请求</span></span><br><span class=\"line\"><span class=\"comment\">        */</span></span><br><span class=\"line\">        <span class=\"type\">String</span> <span class=\"variable\">options</span> <span class=\"operator\">=</span> <span class=\"string\">&quot;OPTIONS&quot;</span>;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (options.equalsIgnoreCase(request.getMethod())) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(judAdminCheck(handler, request))&#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\">        &#125;<span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            JsonResult.returnMsg(response, <span class=\"string\">&quot;需要管理员权限&quot;</span>);</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"literal\">false</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 检查是否有AdminCheck注解，有则验证是否是管理员</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> handler handler</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> 是否有PassToken注释</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"type\">boolean</span> <span class=\"title function_\">judAdminCheck</span><span class=\"params\">(Object handler, HttpServletRequest request)</span> &#123;</span><br><span class=\"line\">        <span class=\"type\">AdminCheck</span> <span class=\"variable\">adminCheck</span> <span class=\"operator\">=</span> ((HandlerMethod) handler).getMethodAnnotation(AdminCheck.class);</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (adminCheck == <span class=\"literal\">null</span>)&#123;</span><br><span class=\"line\">            adminCheck = ((HandlerMethod) handler).getBean().getClass().getAnnotation(AdminCheck.class);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"type\">String</span> <span class=\"variable\">username</span> <span class=\"operator\">=</span> jwtConfig.getUser(request.getHeader(<span class=\"string\">&quot;Authorization&quot;</span>)).getUsername();</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (<span class=\"string\">&quot;admin&quot;</span>.equals(username)) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> adminCheck.required();</span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"literal\">false</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<h2 id=\"redisconfig\"><a class=\"anchor\" href=\"#redisconfig\">#</a> RedisConfig</h2>\n<p>使用原生的 <code>RedisTemplate</code>  时存储数据时键值对会带上编码前缀，解决办法是使用 FastJson 实现一个 redis 序列化器</p>\n<p><figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">&lt;!--redis依赖--&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework.boot<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-boot-starter-data-redis<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">exclusions</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;<span class=\"name\">exclusion</span>&gt;</span></span><br><span class=\"line\">                    <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>io.lettuce<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">                    <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>lettuce-core<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">                <span class=\"tag\">&lt;/<span class=\"name\">exclusion</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;/<span class=\"name\">exclusions</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>redis.clients<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>jedis<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\"><span class=\"comment\">&lt;!--fastjson依赖--&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>com.alibaba<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>fastjson<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>1.2.33<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure></p>\n<p><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">FastJsonRedisSerializer</span>&lt;T&gt; <span class=\"keyword\">implements</span> <span class=\"title class_\">RedisSerializer</span>&lt;T&gt; &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"type\">Charset</span> <span class=\"variable\">DEFAULT_CHARSET</span> <span class=\"operator\">=</span> StandardCharsets.UTF_8;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">final</span> Class&lt;T&gt; clazz;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">static</span> &#123;</span><br><span class=\"line\">        ParserConfig.getGlobalInstance().setAutoTypeSupport(<span class=\"literal\">true</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"title function_\">FastJsonRedisSerializer</span><span class=\"params\">(Class&lt;T&gt; clazz)</span> &#123;</span><br><span class=\"line\">        <span class=\"built_in\">super</span>();</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.clazz = clazz;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"type\">byte</span>[] serialize(T t) <span class=\"keyword\">throws</span> SerializationException &#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (t == <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"title class_\">byte</span>[<span class=\"number\">0</span>];</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> JSON.toJSONString(t, SerializerFeature.WriteClassName).getBytes(DEFAULT_CHARSET);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> T <span class=\"title function_\">deserialize</span><span class=\"params\">(<span class=\"type\">byte</span>[] bytes)</span> <span class=\"keyword\">throws</span> SerializationException &#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (bytes == <span class=\"literal\">null</span> || bytes.length &lt;= <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"literal\">null</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"type\">String</span> <span class=\"variable\">str</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">String</span>(bytes, DEFAULT_CHARSET);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">return</span> JSON.parseObject(str, clazz);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">protected</span> JavaType <span class=\"title function_\">getJavaType</span><span class=\"params\">(Class&lt;?&gt; clazz)</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> TypeFactory.defaultInstance().constructType(clazz);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure></p>\n<p>配置 <code>RedisTemplate</code></p>\n<p><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Configuration</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">RedisConfig</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Bean</span></span><br><span class=\"line\">    <span class=\"meta\">@SuppressWarnings(value = &#123; &quot;unchecked&quot;, &quot;rawtypes&quot; &#125;)</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> RedisTemplate&lt;Object, Object&gt; <span class=\"title function_\">redisTemplate</span><span class=\"params\">(RedisConnectionFactory connectionFactory)</span></span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        RedisTemplate&lt;Object, Object&gt; template = <span class=\"keyword\">new</span> <span class=\"title class_\">RedisTemplate</span>&lt;&gt;();</span><br><span class=\"line\">        template.setConnectionFactory(connectionFactory);</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"type\">FastJsonRedisSerializer</span> <span class=\"variable\">serializer</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">FastJsonRedisSerializer</span>(Object.class);</span><br><span class=\"line\">        <span class=\"comment\">// 使用StringRedisSerializer来序列化和反序列化redis的key值</span></span><br><span class=\"line\">        template.setKeySerializer(<span class=\"keyword\">new</span> <span class=\"title class_\">StringRedisSerializer</span>());</span><br><span class=\"line\"></span><br><span class=\"line\">        template.setValueSerializer(serializer);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// Hash的key也采用StringRedisSerializer的序列化方式</span></span><br><span class=\"line\">        template.setHashKeySerializer(<span class=\"keyword\">new</span> <span class=\"title class_\">StringRedisSerializer</span>());</span><br><span class=\"line\">        template.setHashValueSerializer(serializer);</span><br><span class=\"line\"></span><br><span class=\"line\">        template.afterPropertiesSet();</span><br><span class=\"line\">        <span class=\"keyword\">return</span> template;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<h2 id=\"redis工具类\"><a class=\"anchor\" href=\"#redis工具类\">#</a> redis 工具类</h2>\n<p><em>参考三更草堂 SpringSecurity 课程</em></p>\n<p><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br><span class=\"line\">152</span><br><span class=\"line\">153</span><br><span class=\"line\">154</span><br><span class=\"line\">155</span><br><span class=\"line\">156</span><br><span class=\"line\">157</span><br><span class=\"line\">158</span><br><span class=\"line\">159</span><br><span class=\"line\">160</span><br><span class=\"line\">161</span><br><span class=\"line\">162</span><br><span class=\"line\">163</span><br><span class=\"line\">164</span><br><span class=\"line\">165</span><br><span class=\"line\">166</span><br><span class=\"line\">167</span><br><span class=\"line\">168</span><br><span class=\"line\">169</span><br><span class=\"line\">170</span><br><span class=\"line\">171</span><br><span class=\"line\">172</span><br><span class=\"line\">173</span><br><span class=\"line\">174</span><br><span class=\"line\">175</span><br><span class=\"line\">176</span><br><span class=\"line\">177</span><br><span class=\"line\">178</span><br><span class=\"line\">179</span><br><span class=\"line\">180</span><br><span class=\"line\">181</span><br><span class=\"line\">182</span><br><span class=\"line\">183</span><br><span class=\"line\">184</span><br><span class=\"line\">185</span><br><span class=\"line\">186</span><br><span class=\"line\">187</span><br><span class=\"line\">188</span><br><span class=\"line\">189</span><br><span class=\"line\">190</span><br><span class=\"line\">191</span><br><span class=\"line\">192</span><br><span class=\"line\">193</span><br><span class=\"line\">194</span><br><span class=\"line\">195</span><br><span class=\"line\">196</span><br><span class=\"line\">197</span><br><span class=\"line\">198</span><br><span class=\"line\">199</span><br><span class=\"line\">200</span><br><span class=\"line\">201</span><br><span class=\"line\">202</span><br><span class=\"line\">203</span><br><span class=\"line\">204</span><br><span class=\"line\">205</span><br><span class=\"line\">206</span><br><span class=\"line\">207</span><br><span class=\"line\">208</span><br><span class=\"line\">209</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Component</span></span><br><span class=\"line\"><span class=\"meta\">@SuppressWarnings(value = &#123;&quot;unchecked&quot;, &quot;rawtypes&quot;, &quot;unused&quot;, &quot;all&quot;&#125;)</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">RedisCache</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Resource</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> RedisTemplate redisTemplate;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 缓存基本的对象，Integer、String、实体类等</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> key   缓存的键值</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> value 缓存的值</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> &lt;T&gt; <span class=\"keyword\">void</span> <span class=\"title function_\">setCacheObject</span><span class=\"params\">(<span class=\"keyword\">final</span> String key, <span class=\"keyword\">final</span> T value)</span> &#123;</span><br><span class=\"line\">        redisTemplate.opsForValue().set(key, value);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 缓存基本的对象，Integer、String、实体类等</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> key      缓存的键值</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> value    缓存的值</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> timeout  时间</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> timeUnit 时间颗粒度</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> &lt;T&gt; <span class=\"keyword\">void</span> <span class=\"title function_\">setCacheObject</span><span class=\"params\">(<span class=\"keyword\">final</span> String key, <span class=\"keyword\">final</span> T value, <span class=\"keyword\">final</span> Integer timeout, <span class=\"keyword\">final</span> TimeUnit timeUnit)</span> &#123;</span><br><span class=\"line\">        redisTemplate.opsForValue().set(key, value, timeout, timeUnit);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 设置有效时间</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> key     Redis键</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> timeout 超时时间</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> true=设置成功；false=设置失败</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"type\">boolean</span> <span class=\"title function_\">expire</span><span class=\"params\">(<span class=\"keyword\">final</span> String key, <span class=\"keyword\">final</span> <span class=\"type\">long</span> timeout)</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> expire(key, timeout, TimeUnit.SECONDS);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 设置有效时间</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> key     Redis键</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> timeout 超时时间</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> unit    时间单位</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> true=设置成功；false=设置失败</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"type\">boolean</span> <span class=\"title function_\">expire</span><span class=\"params\">(<span class=\"keyword\">final</span> String key, <span class=\"keyword\">final</span> <span class=\"type\">long</span> timeout, <span class=\"keyword\">final</span> TimeUnit unit)</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> redisTemplate.expire(key, timeout, unit);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 获得缓存的基本对象。</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> key 缓存键值</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> 缓存键值对应的数据</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> &lt;T&gt; T <span class=\"title function_\">getCacheObject</span><span class=\"params\">(<span class=\"keyword\">final</span> String key)</span> &#123;</span><br><span class=\"line\">        ValueOperations&lt;String, T&gt; operation = redisTemplate.opsForValue();</span><br><span class=\"line\">        <span class=\"keyword\">return</span> operation.get(key);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 删除单个对象</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> key</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"type\">boolean</span> <span class=\"title function_\">deleteObject</span><span class=\"params\">(<span class=\"keyword\">final</span> String key)</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> redisTemplate.delete(key);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 删除集合对象</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> collection 多个对象</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span></span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"type\">long</span> <span class=\"title function_\">deleteObject</span><span class=\"params\">(<span class=\"keyword\">final</span> Collection collection)</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> redisTemplate.delete(collection);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 缓存List数据</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> key      缓存的键值</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> dataList 待缓存的List数据</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> 缓存的对象</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> &lt;T&gt; <span class=\"type\">long</span> <span class=\"title function_\">setCacheList</span><span class=\"params\">(<span class=\"keyword\">final</span> String key, <span class=\"keyword\">final</span> List&lt;T&gt; dataList)</span> &#123;</span><br><span class=\"line\">        <span class=\"type\">Long</span> <span class=\"variable\">count</span> <span class=\"operator\">=</span> redisTemplate.opsForList().rightPushAll(key, dataList);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> count == <span class=\"literal\">null</span> ? <span class=\"number\">0</span> : count;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 获得缓存的list对象</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> key 缓存的键值</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> 缓存键值对应的数据</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> &lt;T&gt; List&lt;T&gt; <span class=\"title function_\">getCacheList</span><span class=\"params\">(<span class=\"keyword\">final</span> String key)</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> redisTemplate.opsForList().range(key, <span class=\"number\">0</span>, -<span class=\"number\">1</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 缓存Set</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> key     缓存键值</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> dataSet 缓存的数据</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> 缓存数据的对象</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> &lt;T&gt; BoundSetOperations&lt;String, T&gt; <span class=\"title function_\">setCacheSet</span><span class=\"params\">(<span class=\"keyword\">final</span> String key, <span class=\"keyword\">final</span> Set&lt;T&gt; dataSet)</span> &#123;</span><br><span class=\"line\">        BoundSetOperations&lt;String, T&gt; setOperation = redisTemplate.boundSetOps(key);</span><br><span class=\"line\">        Iterator&lt;T&gt; it = dataSet.iterator();</span><br><span class=\"line\">        <span class=\"keyword\">while</span> (it.hasNext()) &#123;</span><br><span class=\"line\">            setOperation.add(it.next());</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> setOperation;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 获得缓存的set</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> key</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span></span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> &lt;T&gt; Set&lt;T&gt; <span class=\"title function_\">getCacheSet</span><span class=\"params\">(<span class=\"keyword\">final</span> String key)</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> redisTemplate.opsForSet().members(key);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 缓存Map</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> key</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> dataMap</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> &lt;T&gt; <span class=\"keyword\">void</span> <span class=\"title function_\">setCacheMap</span><span class=\"params\">(<span class=\"keyword\">final</span> String key, <span class=\"keyword\">final</span> Map&lt;String, T&gt; dataMap)</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (dataMap != <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">            redisTemplate.opsForHash().putAll(key, dataMap);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 获得缓存的Map</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> key</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span></span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> &lt;T&gt; Map&lt;String, T&gt; <span class=\"title function_\">getCacheMap</span><span class=\"params\">(<span class=\"keyword\">final</span> String key)</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> redisTemplate.opsForHash().entries(key);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 往Hash中存入数据</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> key   Redis键</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> hKey  Hash键</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> value 值</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> &lt;T&gt; <span class=\"keyword\">void</span> <span class=\"title function_\">setCacheMapValue</span><span class=\"params\">(<span class=\"keyword\">final</span> String key, <span class=\"keyword\">final</span> String hKey, <span class=\"keyword\">final</span> T value)</span> &#123;</span><br><span class=\"line\">        redisTemplate.opsForHash().put(key, hKey, value);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 获取Hash中的数据</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> key  Redis键</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> hKey Hash键</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> Hash中的对象</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> &lt;T&gt; T <span class=\"title function_\">getCacheMapValue</span><span class=\"params\">(<span class=\"keyword\">final</span> String key, <span class=\"keyword\">final</span> String hKey)</span> &#123;</span><br><span class=\"line\">        HashOperations&lt;String, String, T&gt; opsForHash = redisTemplate.opsForHash();</span><br><span class=\"line\">        <span class=\"keyword\">return</span> opsForHash.get(key, hKey);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 删除Hash中的数据</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> key</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> hkey</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">delCacheMapValue</span><span class=\"params\">(<span class=\"keyword\">final</span> String key, <span class=\"keyword\">final</span> String hkey)</span> &#123;</span><br><span class=\"line\">        <span class=\"type\">HashOperations</span> <span class=\"variable\">hashOperations</span> <span class=\"operator\">=</span> redisTemplate.opsForHash();</span><br><span class=\"line\">        hashOperations.delete(key, hkey);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 获取多个Hash中的数据</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> key   Redis键</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> hKeys Hash键集合</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> Hash对象集合</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> &lt;T&gt; List&lt;T&gt; <span class=\"title function_\">getMultiCacheMapValue</span><span class=\"params\">(<span class=\"keyword\">final</span> String key, <span class=\"keyword\">final</span> Collection&lt;Object&gt; hKeys)</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> redisTemplate.opsForHash().multiGet(key, hKeys);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 获得缓存的基本对象列表</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> pattern 字符串前缀</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> 对象列表</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> Collection&lt;String&gt; <span class=\"title function_\">keys</span><span class=\"params\">(<span class=\"keyword\">final</span> String pattern)</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> redisTemplate.keys(pattern);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure></p>\n",
            "tags": [
                "学习笔记",
                "后端",
                "Java",
                "Spring Boot"
            ]
        },
        {
            "id": "https://windlinxy.top/2023/02/28/48a59f7d755c/",
            "url": "https://windlinxy.top/2023/02/28/48a59f7d755c/",
            "title": "Springboot自动装配",
            "date_published": "2023-02-28T13:34:47.000Z",
            "content_html": "<h1 id=\"springboot自动装配\"><a class=\"anchor\" href=\"#springboot自动装配\">#</a> Springboot 自动装配</h1>\n<h2 id=\"核心注解springbootapplication\"><a class=\"anchor\" href=\"#核心注解springbootapplication\">#</a> 核心注解 @SpringBootApplication</h2>\n<p><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Target(ElementType.TYPE)</span></span><br><span class=\"line\"><span class=\"meta\">@Retention(RetentionPolicy.RUNTIME)</span></span><br><span class=\"line\"><span class=\"meta\">@Documented</span></span><br><span class=\"line\"><span class=\"meta\">@Inherited</span></span><br><span class=\"line\"><span class=\"meta\">@SpringBootConfiguration</span></span><br><span class=\"line\"><span class=\"meta\">@EnableAutoConfiguration</span></span><br><span class=\"line\"><span class=\"meta\">@ComponentScan(excludeFilters = &#123; @Filter(type = FilterType.CUSTOM, classes = TypeExcludeFilter.class),</span></span><br><span class=\"line\"><span class=\"meta\">\t\t@Filter(type = FilterType.CUSTOM, classes = AutoConfigurationExcludeFilter.class) &#125;)</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"meta\">@interface</span> SpringBootApplication &#123;&#125;</span><br></pre></td></tr></table></figure></p>\n<p><strong>@SpringBootConfiguration</strong></p>\n<p><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">@Target(ElementType.TYPE)</span><br><span class=\"line\">@Retention(RetentionPolicy.RUNTIME)</span><br><span class=\"line\">@Documented</span><br><span class=\"line\">@Configuration</span><br><span class=\"line\">@Indexed</span><br><span class=\"line\">public @interface SpringBootConfiguration &#123;&#125;</span><br></pre></td></tr></table></figure></p>\n<p>@SpringBootApplication 组合了很多注解：</p>\n<ul>\n<li><strong>@EnableAutoConfiguration</strong> ：启用 SpringBoot 的自动配置\n<ul>\n<li>@AutoConfigurationPackage：主配置类（@SpringBootApplication 标注的类）的所在包以及下面所有子包里面的所有组件扫描到 Spring 容器。</li>\n<li><code>@Import(AutoConfigurationImportSelector.class)：自动装配核心功能的实现</code></li>\n</ul>\n</li>\n<li><strong>@ComponentScan</strong>：扫描 @Component（@Controller、@Service、@Repository 都包含此注解）并注入容器</li>\n<li><strong>@SpringConfiguration</strong>\n<ul>\n<li>Configuration：允许在 ApplicationContext 中注册额外的 Bean 或导入其他配置类</li>\n<li>Indexed：  项目编译打包时，会在自动生成 META-INF/spring.components 文件</li>\n</ul>\n</li>\n</ul>\n<h2 id=\"enableautoconfiguration\"><a class=\"anchor\" href=\"#enableautoconfiguration\">#</a> @EnableAutoConfiguration</h2>\n<p>@EnableAutoConfiguration 注解中导入了 <code>AutoConfigurationImportSelector</code>  类。</p>\n<p><code>AutoConfigurationImportSelector</code>  类实现了  <code>ImportSelector</code>  接口，也就实现了这个接口中的  <code>selectImports</code>  方法，该方法主要用于<strong>获取所有符合条件的类的全限定类名，这些类需要被加载到 IOC 容器中</strong>。</p>\n<p><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Override</span></span><br><span class=\"line\">\t<span class=\"keyword\">public</span> String[] selectImports(AnnotationMetadata annotationMetadata) &#123;</span><br><span class=\"line\">        <span class=\"comment\">// 判断自动装配是否启动</span></span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> (!isEnabled(annotationMetadata)) &#123;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">return</span> NO_IMPORTS;</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">        <span class=\"comment\">// 获取所有自动装配的bean</span></span><br><span class=\"line\">\t\t<span class=\"type\">AutoConfigurationEntry</span> <span class=\"variable\">autoConfigurationEntry</span> <span class=\"operator\">=</span> getAutoConfigurationEntry(annotationMetadata);</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> StringUtils.toStringArray(autoConfigurationEntry.getConfigurations());</span><br><span class=\"line\">\t&#125;</span><br></pre></td></tr></table></figure></p>\n<p>其中 <code>getAutoConfigurationEntry(annotationMetadata)</code></p>\n<p><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">protected</span> AutoConfigurationEntry <span class=\"title function_\">getAutoConfigurationEntry</span><span class=\"params\">(AnnotationMetadata annotationMetadata)</span> &#123;</span><br><span class=\"line\">    \t<span class=\"comment\">// 判断是否开启自动装配（spring.boot.enableautoconfiguration默认为true）</span></span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> (!isEnabled(annotationMetadata)) &#123;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">return</span> EMPTY_ENTRY;</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">    \t<span class=\"comment\">// 获取EnableAutoConfiguration注解中的属性exclude和excludeName排除</span></span><br><span class=\"line\">\t\t<span class=\"type\">AnnotationAttributes</span> <span class=\"variable\">attributes</span> <span class=\"operator\">=</span> getAttributes(annotationMetadata);</span><br><span class=\"line\">\t\t<span class=\"comment\">// 拿到starter包中Auto配置模块的\tMETA-INF/spring.factories文件下的自动配置类列表（条件装配）</span></span><br><span class=\"line\">    List&lt;String&gt; configurations = getCandidateConfigurations(annotationMetadata, attributes);</span><br><span class=\"line\">    \t<span class=\"comment\">// 去重</span></span><br><span class=\"line\">\t\tconfigurations = removeDuplicates(configurations);</span><br><span class=\"line\">    \t<span class=\"comment\">// 获取注解的exclude和excludeName属性配置的需要排除的自动配置类全限定名的集合</span></span><br><span class=\"line\">\t\tSet&lt;String&gt; exclusions = getExclusions(annotationMetadata, attributes);</span><br><span class=\"line\">\t\t<span class=\"comment\">// 检查并排除类（如果类不在configurations中报错此类不是自动配置类）</span></span><br><span class=\"line\">    \tcheckExcludedClasses(configurations, exclusions);</span><br><span class=\"line\">    \t<span class=\"comment\">// 移除所有exclude和excludeName属性配置的需要排除的自动配置类</span></span><br><span class=\"line\">\t\tconfigurations.removeAll(exclusions);</span><br><span class=\"line\">    \t<span class=\"comment\">// 对configurations进行过滤，剔除掉条件不成立的配置类，@Conditional有关</span></span><br><span class=\"line\">\t\tconfigurations = getConfigurationClassFilter().filter(configurations);</span><br><span class=\"line\">    \t<span class=\"comment\">// 监听器 import 事件回调</span></span><br><span class=\"line\">\t\tfireAutoConfigurationImportEvents(configurations, exclusions);</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"title class_\">AutoConfigurationEntry</span>(configurations, exclusions);</span><br><span class=\"line\">\t&#125;</span><br></pre></td></tr></table></figure></p>\n<p>最后方法返回了一个 <code>AutoConfigurationEntry</code> ，它是 AutoConfigurationImportSelector 的内部类</p>\n<p><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">protected</span> <span class=\"keyword\">static</span> <span class=\"keyword\">class</span> <span class=\"title class_\">AutoConfigurationEntry</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t<span class=\"keyword\">private</span> <span class=\"keyword\">final</span> List&lt;String&gt; configurations;</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t<span class=\"keyword\">private</span> <span class=\"keyword\">final</span> Set&lt;String&gt; exclusions;</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t<span class=\"keyword\">private</span> <span class=\"title function_\">AutoConfigurationEntry</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">\t\t\t<span class=\"built_in\">this</span>.configurations = Collections.emptyList();</span><br><span class=\"line\">\t\t\t<span class=\"built_in\">this</span>.exclusions = Collections.emptySet();</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t<span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">\t\t * Create an entry with the configurations that were contributed and their</span></span><br><span class=\"line\"><span class=\"comment\">\t\t * exclusions.</span></span><br><span class=\"line\"><span class=\"comment\">\t\t * <span class=\"doctag\">@param</span> configurations the configurations that should be imported</span></span><br><span class=\"line\"><span class=\"comment\">\t\t * <span class=\"doctag\">@param</span> exclusions the exclusions that were applied to the original list</span></span><br><span class=\"line\"><span class=\"comment\">\t\t */</span></span><br><span class=\"line\">\t\tAutoConfigurationEntry(Collection&lt;String&gt; configurations, Collection&lt;String&gt; exclusions) &#123;</span><br><span class=\"line\">\t\t\t<span class=\"built_in\">this</span>.configurations = <span class=\"keyword\">new</span> <span class=\"title class_\">ArrayList</span>&lt;&gt;(configurations);</span><br><span class=\"line\">\t\t\t<span class=\"built_in\">this</span>.exclusions = <span class=\"keyword\">new</span> <span class=\"title class_\">HashSet</span>&lt;&gt;(exclusions);</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t<span class=\"keyword\">public</span> List&lt;String&gt; <span class=\"title function_\">getConfigurations</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">return</span> <span class=\"built_in\">this</span>.configurations;</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t\t<span class=\"keyword\">public</span> Set&lt;String&gt; <span class=\"title function_\">getExclusions</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">return</span> <span class=\"built_in\">this</span>.exclusions;</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t&#125;</span><br></pre></td></tr></table></figure></p>\n<p>最后 <code>selectImports(AnnotationMetadata annotationMetadata)</code>  方法返回一个配置类的全限定名数组。</p>\n<h1 id=\"自定义starter\"><a class=\"anchor\" href=\"#自定义starter\">#</a> 自定义 Starter</h1>\n<p><em>代码参考：尚硅谷 springboot2 课程</em></p>\n<p><img data-src=\"https://raw.githubusercontent.com/Windlinxy/Typora-img/main/img/202302282123708.png\" alt=\"image-20230228212127676\" /></p>\n<ol>\n<li>\n<p>准备一个空工程</p>\n</li>\n<li>\n<p>新建一个 Maven 模块，命名为 <code>XXX-spring-boot-start</code>  充当启动器</p>\n<p><strong>pom 文件：</strong></p>\n<p><figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?xml version=<span class=\"string\">&quot;1.0&quot;</span> encoding=<span class=\"string\">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">project</span> <span class=\"attr\">xmlns</span>=<span class=\"string\">&quot;http://maven.apache.org/POM/4.0.0&quot;</span></span></span><br><span class=\"line\"><span class=\"tag\">         <span class=\"attr\">xmlns:xsi</span>=<span class=\"string\">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class=\"line\"><span class=\"tag\">         <span class=\"attr\">xsi:schemaLocation</span>=<span class=\"string\">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">modelVersion</span>&gt;</span>4.0.0<span class=\"tag\">&lt;/<span class=\"name\">modelVersion</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>per.windlinxy<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>windlinxy-spring-boot-starter<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>1.0-SNAPSHOT<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">dependencies</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>per.windlnxy<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>windlinxy-spring-boot-starter-autoconfigure<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>0.0.1-SNAPSHOT<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">dependencies</span>&gt;</span></span><br><span class=\"line\">    </span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">project</span>&gt;</span></span><br></pre></td></tr></table></figure></p>\n</li>\n<li>\n<p>再使用 Spring Initializr 创建一个模块，命名为 <code>XXX-spring-boot-start-autoconfigure</code></p>\n<p><figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?xml version=<span class=\"string\">&quot;1.0&quot;</span> encoding=<span class=\"string\">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">project</span> <span class=\"attr\">xmlns</span>=<span class=\"string\">&quot;http://maven.apache.org/POM/4.0.0&quot;</span> <span class=\"attr\">xmlns:xsi</span>=<span class=\"string\">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class=\"line\"><span class=\"tag\">         <span class=\"attr\">xsi:schemaLocation</span>=<span class=\"string\">&quot;http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">modelVersion</span>&gt;</span>4.0.0<span class=\"tag\">&lt;/<span class=\"name\">modelVersion</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">parent</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework.boot<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-boot-starter-parent<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>2.7.4<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">relativePath</span>/&gt;</span> <span class=\"comment\">&lt;!-- lookup parent from repository --&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">parent</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>per.windlnxy<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>windlinxy-spring-boot-starter-autoconfigure<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>0.0.1-SNAPSHOT<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">name</span>&gt;</span>windlinxy-spring-boot-starter-autoconfigure<span class=\"tag\">&lt;/<span class=\"name\">name</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">description</span>&gt;</span>windlinxy-spring-boot-starter-autoconfigure<span class=\"tag\">&lt;/<span class=\"name\">description</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">properties</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">java.version</span>&gt;</span>8<span class=\"tag\">&lt;/<span class=\"name\">java.version</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">properties</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">dependencies</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>org.springframework.boot<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>spring-boot-starter<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">dependencies</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">project</span>&gt;</span></span><br></pre></td></tr></table></figure></p>\n</li>\n<li>\n<p>在 <code>XXX-spring-boot-start-autoconfigure</code>  模块编写代码</p>\n</li>\n<li>\n<p>使用 maven 进行 install 将两个模块注入到本地 maven 仓库</p>\n<p><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">per</span><br><span class=\"line\">├─windlinxy</span><br><span class=\"line\">│  └─windlinxy-spring-boot-starter</span><br><span class=\"line\">│      └─1.0-SNAPSHOT</span><br><span class=\"line\">└─windlnxy</span><br><span class=\"line\">    └─windlinxy-spring-boot-starter-autoconfigure</span><br><span class=\"line\">        └─0.0.1-SNAPSHOT</span><br></pre></td></tr></table></figure></p>\n</li>\n<li>\n<p>在另外的项目进行注册</p>\n<p><figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">dependency</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">groupId</span>&gt;</span>per.windlinxy<span class=\"tag\">&lt;/<span class=\"name\">groupId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">artifactId</span>&gt;</span>windlinxy-spring-boot-starter<span class=\"tag\">&lt;/<span class=\"name\">artifactId</span>&gt;</span></span><br><span class=\"line\">            <span class=\"tag\">&lt;<span class=\"name\">version</span>&gt;</span>1.0-SNAPSHOT<span class=\"tag\">&lt;/<span class=\"name\">version</span>&gt;</span></span><br><span class=\"line\">        <span class=\"tag\">&lt;/<span class=\"name\">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure></p>\n</li>\n<li>\n<p>使用</p>\n<p>配置文件：</p>\n<p><figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attr\">hello:</span></span><br><span class=\"line\">  <span class=\"attr\">prefix:</span> <span class=\"number\">11</span></span><br><span class=\"line\">  <span class=\"attr\">suffix:</span> <span class=\"number\">666</span></span><br></pre></td></tr></table></figure></p>\n<p>Controller：</p>\n<p><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@RestController</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">HelloController</span> &#123;</span><br><span class=\"line\">    <span class=\"meta\">@Resource</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> HelloService helloService;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@GetMapping(&quot;/hello&quot;)</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> String <span class=\"title function_\">sayHello</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> helloService.sayHello(<span class=\"string\">&quot;张三&quot;</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n</li>\n</ol>\n<p><code>HelloServiceAutoConfiguration</code>  自动配置类</p>\n<p><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Configuration</span></span><br><span class=\"line\"><span class=\"meta\">@ConditionalOnMissingBean(HelloService.class)</span></span><br><span class=\"line\"><span class=\"comment\">// 会将HelloProperties自动注入容器</span></span><br><span class=\"line\"><span class=\"meta\">@EnableConfigurationProperties(HelloProperties.class)</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">HelloServiceAutoConfiguration</span> &#123;</span><br><span class=\"line\">    <span class=\"meta\">@Bean</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> HelloService <span class=\"title function_\">helloService</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"title class_\">HelloService</span>();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<p><code>HelloProperties</code></p>\n<p><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@ConfigurationProperties(&quot;hello&quot;)</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">HelloProperties</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> String prefix;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> String suffix;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> String <span class=\"title function_\">getPrefix</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> prefix;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">setPrefix</span><span class=\"params\">(String prefix)</span> &#123;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.prefix = prefix;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> String <span class=\"title function_\">getSuffix</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> suffix;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">setSuffix</span><span class=\"params\">(String suffix)</span> &#123;</span><br><span class=\"line\">        <span class=\"built_in\">this</span>.suffix = suffix;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<p><code>HelloService</code></p>\n<p><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 默认不放入容器</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">HelloService</span> &#123;</span><br><span class=\"line\">    <span class=\"meta\">@Autowired</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> HelloProperties helloProperties;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> String <span class=\"title function_\">sayHello</span><span class=\"params\">(String username)</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> helloProperties.getPrefix() + <span class=\"string\">&quot;: &quot;</span> + username + helloProperties.getSuffix();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<p><strong>resources/META-INF/spring.factiories</strong> 文件</p>\n<p><figure class=\"highlight properties\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># Auto Configure</span></span><br><span class=\"line\"><span class=\"attr\">org.springframework.boot.autoconfigure.EnableAutoConfiguration</span>=<span class=\"string\">\\</span></span><br><span class=\"line\"><span class=\"string\">per.windlnxy.auto.HelloServiceAutoConfiguration</span></span><br></pre></td></tr></table></figure></p>\n",
            "tags": [
                "学习笔记",
                "后端",
                "Java",
                "Spring Boot"
            ]
        },
        {
            "id": "https://windlinxy.top/2023/01/21/6c40bdfa1892/",
            "url": "https://windlinxy.top/2023/01/21/6c40bdfa1892/",
            "title": "java注解",
            "date_published": "2023-01-21T14:54:47.000Z",
            "content_html": "<h1 id=\"注解学习\"><a class=\"anchor\" href=\"#注解学习\">#</a> 注解学习</h1>\n<blockquote>\n<p>JDK1.5 开始引入<strong>注解（Annotation）</strong>，Java 中类、方法、变量、参数都可以被标注。</p>\n<p>注解主要作用：</p>\n<ul>\n<li>生成文档，通过代码中标识的注解生成 javadoc 文档。</li>\n<li>编译检查，通过代码中标识的注解让编译器在编译期间进行检查。</li>\n<li>编译时动态处理，编译时通过代码里标识的注解动态处理，例如动态生成代码。</li>\n<li>运行时动态处理，运行时通过代码里标识的注解动态处理，例如使用反射注入实例。</li>\n</ul>\n</blockquote>\n<p><em>关于三个名词：元注解（meta-annotation）、元数据（meta-data）、注解（annotation），我个人认为元注解是注解注解的注解，元数据是注解别称。</em></p>\n<h2 id=\"jdk内置的注解\"><a class=\"anchor\" href=\"#jdk内置的注解\">#</a> JDK 内置的注解</h2>\n<h3 id=\"override\"><a class=\"anchor\" href=\"#override\">#</a> @Override</h3>\n<p>在  <code>java.lang</code>  包下，表示当前的方法定义将覆盖父类中的方法。</p>\n<ul>\n<li>作用于方法</li>\n<li>源码保留级别</li>\n</ul>\n<p><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Target(ElementType.METHOD)</span></span><br><span class=\"line\"><span class=\"meta\">@Retention(RetentionPolicy.SOURCE)</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"meta\">@interface</span> Override &#123;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<h3 id=\"deprecated\"><a class=\"anchor\" href=\"#deprecated\">#</a> @Deprecated</h3>\n<p>在  <code>java.lang</code>  包下，表示代码被弃用，如果使用了被 @Deprecated 注解的代码则编译器将发出警告。</p>\n<ul>\n<li>生成文档</li>\n<li>运行时保留级别</li>\n<li>作用于构造器、属性、局部变量、方法、包、参数、类型</li>\n</ul>\n<p><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Documented</span></span><br><span class=\"line\"><span class=\"meta\">@Retention(RetentionPolicy.RUNTIME)</span></span><br><span class=\"line\"><span class=\"meta\">@Target(value=&#123;CONSTRUCTOR, FIELD, LOCAL_VARIABLE, METHOD, PACKAGE, PARAMETER, TYPE&#125;)</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"meta\">@interface</span> Deprecated &#123;</span><br><span class=\"line\">    </span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<h3 id=\"suppvisewarnings\"><a class=\"anchor\" href=\"#suppvisewarnings\">#</a> @Suppvisewarnings</h3>\n<p>在  <code>java.lang</code>  包下，告诉编译器忽略指定的\t警告信息。</p>\n<ul>\n<li>可修饰包括类型、属性、方法、参数、构造器、局部变量</li>\n<li>源码保留级别</li>\n</ul>\n<p><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Target(&#123;TYPE, FIELD, METHOD, PARAMETER, CONSTRUCTOR, LOCAL_VARIABLE&#125;)</span></span><br><span class=\"line\"><span class=\"meta\">@Retention(RetentionPolicy.SOURCE)</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"meta\">@interface</span> SuppressWarnings &#123;</span><br><span class=\"line\">        String[] value();</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<p>示例：</p>\n<p><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/*</span></span><br><span class=\"line\"><span class=\"comment\">    * 抑制单类型的警告：</span></span><br><span class=\"line\"><span class=\"comment\">    */</span></span><br><span class=\"line\">   <span class=\"meta\">@SuppressWarnings(&quot;unchecked&quot;)</span></span><br><span class=\"line\">   <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">addItems</span><span class=\"params\">(String item)</span> &#123;</span><br><span class=\"line\">       <span class=\"meta\">@SuppressWarnings(&quot;rawtypes&quot;)</span></span><br><span class=\"line\">       <span class=\"type\">List</span> <span class=\"variable\">items</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">ArrayList</span>();</span><br><span class=\"line\">           ……</span><br><span class=\"line\">   &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">   <span class=\"comment\">/*</span></span><br><span class=\"line\"><span class=\"comment\">    * 抑制多类型的警告：</span></span><br><span class=\"line\"><span class=\"comment\">    */</span></span><br><span class=\"line\">   <span class=\"meta\">@SuppressWarnings(value = &#123;&quot;unchecked&quot;, &quot;rawtypes&quot;&#125;)</span></span><br><span class=\"line\">   <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">addItems</span><span class=\"params\">(String item)</span> &#123;</span><br><span class=\"line\">           ……</span><br><span class=\"line\">   &#125;</span><br></pre></td></tr></table></figure></p>\n<p>具体警告类型查表：</p>\n<table>\n<thead>\n<tr>\n<th style=\"text-align:center\">参数</th>\n<th style=\"text-align:center\">作用</th>\n<th style=\"text-align:left\">原描述</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:center\">all</td>\n<td style=\"text-align:center\">抑制所有警告</td>\n<td style=\"text-align:left\">to suppress all warnings</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">boxing</td>\n<td style=\"text-align:center\">抑制装箱、拆箱操作时候的警告</td>\n<td style=\"text-align:left\">to suppress warnings relative to boxing/unboxing operations</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">cast</td>\n<td style=\"text-align:center\">抑制映射相关的警告</td>\n<td style=\"text-align:left\">to suppress warnings relative to cast operations</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">dep-ann</td>\n<td style=\"text-align:center\">抑制启用注释的警告</td>\n<td style=\"text-align:left\">to suppress warnings relative to deprecated annotation</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">deprecation</td>\n<td style=\"text-align:center\">抑制过期方法警告</td>\n<td style=\"text-align:left\">to suppress warnings relative to deprecation</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">fallthrough</td>\n<td style=\"text-align:center\">抑制确在 switch 中缺失 breaks 的警告</td>\n<td style=\"text-align:left\">to suppress warnings relative to missing breaks in switch statements</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">finally</td>\n<td style=\"text-align:center\">抑制 finally 模块没有返回的警告</td>\n<td style=\"text-align:left\">to suppress warnings relative to finally block that don’t return</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">hiding</td>\n<td style=\"text-align:center\">抑制与隐藏变数的区域变数相关的警告</td>\n<td style=\"text-align:left\">to suppress warnings relative to locals that hide variable（）</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">incomplete-switch</td>\n<td style=\"text-align:center\">忽略没有完整的 switch 语句</td>\n<td style=\"text-align:left\">to suppress warnings relative to missing entries in a switch statement (enum case)</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">nls</td>\n<td style=\"text-align:center\">忽略非 nls 格式的字符</td>\n<td style=\"text-align:left\">to suppress warnings relative to non-nls string literals</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">null</td>\n<td style=\"text-align:center\">忽略对 null 的操作</td>\n<td style=\"text-align:left\">to suppress warnings relative to null analysis</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">rawtype</td>\n<td style=\"text-align:center\">使用 generics 时忽略没有指定相应的类型</td>\n<td style=\"text-align:left\">to suppress warnings relative to un-specific types when using</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">restriction</td>\n<td style=\"text-align:center\">抑制与使用不建议或禁止参照相关的警告</td>\n<td style=\"text-align:left\">to suppress warnings relative to usage of discouraged or</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">serial</td>\n<td style=\"text-align:center\">忽略在 serializable 类中没有声明 serialVersionUID 变量</td>\n<td style=\"text-align:left\">to suppress warnings relative to missing serialVersionUID field for a serializable class</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">static-access</td>\n<td style=\"text-align:center\">抑制不正确的静态访问方式警告</td>\n<td style=\"text-align:left\">to suppress warnings relative to incorrect static access</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">synthetic-access</td>\n<td style=\"text-align:center\">抑制子类没有按最优方法访问内部类的警告</td>\n<td style=\"text-align:left\">to suppress warnings relative to unoptimized access from inner classes</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">unchecked</td>\n<td style=\"text-align:center\">抑制没有进行类型检查操作的警告</td>\n<td style=\"text-align:left\">to suppress warnings relative to unchecked operations</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">unqualified-field-access</td>\n<td style=\"text-align:center\">抑制没有权限访问的域的警告</td>\n<td style=\"text-align:left\">to suppress warnings relative to field access unqualified</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">unused</td>\n<td style=\"text-align:center\">抑制没被使用过的代码的警告</td>\n<td style=\"text-align:left\">to suppress warnings relative to unused code</td>\n</tr>\n</tbody>\n</table>\n<h2 id=\"元注解\"><a class=\"anchor\" href=\"#元注解\">#</a> 元注解</h2>\n<blockquote>\n<p>元注解就是注解注解的注解，一般用于修饰注解</p>\n</blockquote>\n<pre><code>\t除了JDK定义好的注解，我们还可以自定义注解，JDK1.5提供了四个标准用来对注解类型进行注解的注解类\n</code></pre>\n<ul>\n<li>\n<p>@Target</p>\n</li>\n<li>\n<p>@Retention</p>\n</li>\n<li>\n<p>@Document</p>\n</li>\n<li>\n<p>@Inherited</p>\n</li>\n</ul>\n<h4 id=\"target注解\"><a class=\"anchor\" href=\"#target注解\">#</a> @Target 注解</h4>\n<blockquote>\n<p>描述注解的使用范围</p>\n</blockquote>\n<p>Target 注解用来说明被注解的注解类可修饰的对象的范围：</p>\n<pre><code>\t注解可以修饰packages types（类、接口、枚举、注解类）、类成员（方法、构造方法、成员变量、枚举值）、方法参数和本地变量\n</code></pre>\n<p>取值范围在 ElementType 枚举中：</p>\n<p><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">enum</span> <span class=\"title class_\">ElementType</span> &#123;</span><br><span class=\"line\"> </span><br><span class=\"line\">    TYPE, <span class=\"comment\">// 类、接口、枚举类</span></span><br><span class=\"line\"> </span><br><span class=\"line\">    FIELD, <span class=\"comment\">// 成员变量（包括：枚举常量）</span></span><br><span class=\"line\"> </span><br><span class=\"line\">    METHOD, <span class=\"comment\">// 成员方法</span></span><br><span class=\"line\"> </span><br><span class=\"line\">    PARAMETER, <span class=\"comment\">// 方法参数</span></span><br><span class=\"line\"> </span><br><span class=\"line\">    CONSTRUCTOR, <span class=\"comment\">// 构造方法</span></span><br><span class=\"line\"> </span><br><span class=\"line\">    LOCAL_VARIABLE, <span class=\"comment\">// 局部变量</span></span><br><span class=\"line\"> </span><br><span class=\"line\">    ANNOTATION_TYPE, <span class=\"comment\">// 注解类</span></span><br><span class=\"line\"> </span><br><span class=\"line\">    PACKAGE, <span class=\"comment\">// 可用于修饰：包</span></span><br><span class=\"line\"> </span><br><span class=\"line\">    TYPE_PARAMETER, <span class=\"comment\">// 类型参数，JDK 1.8 新增</span></span><br><span class=\"line\"> </span><br><span class=\"line\">    TYPE_USE <span class=\"comment\">// 使用类型的任何地方，JDK 1.8 新增</span></span><br><span class=\"line\"> </span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<h4 id=\"retention注解\"><a class=\"anchor\" href=\"#retention注解\">#</a> @Retention 注解</h4>\n<blockquote>\n<p>描述注解保留的时间范围</p>\n</blockquote>\n<pre><code>\t限定所注解的注解类注解到其他类上后，可以被保留到何时，一共三个策略，定义在RetentionPolicy枚举中：\n</code></pre>\n<p><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">enum</span> <span class=\"title class_\">RetentionPolicy</span> &#123;</span><br><span class=\"line\">    SOURCE,    <span class=\"comment\">// 源文件保留</span></span><br><span class=\"line\">    CLASS,       <span class=\"comment\">// 编译期保留，默认值</span></span><br><span class=\"line\">    RUNTIME   <span class=\"comment\">// 运行期保留，可通过反射去获取注解信息</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<h4 id=\"documented注解\"><a class=\"anchor\" href=\"#documented注解\">#</a> @Documented 注解</h4>\n<blockquote>\n<p>描述在使用 javadoc 工具为类生成帮助文档时是否需要保留注解信息</p>\n</blockquote>\n<h4 id=\"inherited注解\"><a class=\"anchor\" href=\"#inherited注解\">#</a> @Inherited 注解</h4>\n<blockquote>\n<p>使被修饰的注解具有继承性</p>\n</blockquote>\n<h2 id=\"注解与反射\"><a class=\"anchor\" href=\"#注解与反射\">#</a> 注解与反射</h2>\n<p>我们知道 spring 中有很多注解很实用，如使用注解驱动 ioc 依赖注入，好的注解可以简化代码提高效率。</p>\n<h3 id=\"annotationelement\"><a class=\"anchor\" href=\"#annotationelement\">#</a> AnnotationElement</h3>\n<p>在 <code>java.lang.reflect</code>  包下有  <code>AnnotationElement</code>  接口，标识一个被注解的 Java 语言元素（Class、Method、Field、Constructor、GenericDeclaration 等对应的实现都实现了该接口），用于获取注解的内容。** 注意：只有注解作用范围定义为 RUNTIME 时，该注解才运行时可见，这样 class 文件被装载时其中的注解才能被虚拟机读取。 **</p>\n<p><img data-src=\"https://raw.githubusercontent.com/Windlinxy/Typora-img/main/img/202301210952871.png\" alt=\"image-20230121095228782\" /></p>\n<p>方法使用：</p>\n<ul>\n<li><code>isAnnotationPresent(Class&lt;? extends Annotation&gt;)</code></li>\n</ul>\n<p>判断元素上是否包含指定类型的注解，包含则返回 true，反之 false</p>\n<ul>\n<li>\n<p><code>getAnnotation(Class&lt;T&gt;)</code></p>\n<p>返回该元素上的注解，不存在返回 null</p>\n</li>\n<li>\n<p><code>getAnnotations()</code></p>\n<p>返回该元素存在的所有注解（数组形式），无注解返回长度 0 的数组</p>\n</li>\n<li>\n<p><code>getAnnotationsByType(Class&lt;T&gt;)</code></p>\n<p>返回指定类型的注解数组</p>\n</li>\n<li>\n<p>另外加 <code>Declared</code>  的方法跟不加的差不多，只不过多了一个<strong>忽略继承的注解</strong></p>\n</li>\n</ul>\n<h2 id=\"自定义注解\"><a class=\"anchor\" href=\"#自定义注解\">#</a> 自定义注解</h2>\n<p>注解 <code>@Extra</code></p>\n<p><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Documented</span></span><br><span class=\"line\"><span class=\"meta\">@Retention(RetentionPolicy.RUNTIME)</span></span><br><span class=\"line\"><span class=\"meta\">@Target(&#123;ElementType.METHOD,ElementType.FIELD&#125;)</span></span><br><span class=\"line\"><span class=\"meta\">@Inherited</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"meta\">@interface</span> Extra &#123;</span><br><span class=\"line\">    <span class=\"keyword\">enum</span> <span class=\"title class_\">Type</span> &#123;</span><br><span class=\"line\">        <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">         * 类</span></span><br><span class=\"line\"><span class=\"comment\">         */</span></span><br><span class=\"line\">        CLASS,</span><br><span class=\"line\">        <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">         * 方法</span></span><br><span class=\"line\"><span class=\"comment\">         */</span></span><br><span class=\"line\">        METHOD</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">//声明枚举</span></span><br><span class=\"line\">    Type <span class=\"title function_\">type</span><span class=\"params\">()</span> <span class=\"keyword\">default</span> Type.CLASS;</span><br><span class=\"line\">    String <span class=\"title function_\">value</span><span class=\"params\">()</span> <span class=\"keyword\">default</span> <span class=\"string\">&quot;默认&quot;</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<p>使用注解的类 <code>TestAnnotation</code></p>\n<p><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">TestAnnotation</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Extra(&quot;覆盖默认A&quot;)</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">hasAnnoA</span><span class=\"params\">()</span>&#123;</span><br><span class=\"line\">        System.out.println(<span class=\"string\">&quot;方法&quot;</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"meta\">@Extra(&quot;覆盖默认B&quot;)</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">hasAnnoB</span><span class=\"params\">()</span>&#123;</span><br><span class=\"line\">        System.out.println(<span class=\"string\">&quot;方法&quot;</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">noAnno</span><span class=\"params\">()</span>&#123;</span><br><span class=\"line\">        System.out.println(<span class=\"string\">&quot;方法&quot;</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<p>主类 <code>Main</code></p>\n<p><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">Main</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title function_\">main</span><span class=\"params\">(String[] args)</span> &#123;</span><br><span class=\"line\">        <span class=\"comment\">// 获取TestAnnotation所有方法</span></span><br><span class=\"line\">        Method[] methods = TestAnnotation.class.getMethods();</span><br><span class=\"line\">        <span class=\"comment\">//Lambda取methods中注解了@Extra的方法的注解值</span></span><br><span class=\"line\">        Stream.of(methods).filter(method -&gt; method.isAnnotationPresent(Extra.class))</span><br><span class=\"line\">                .forEach(method -&gt; System.out.println(method.getAnnotation(Extra.class).value()));</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"comment\">// 上面Lambda等同于下面foreach</span></span><br><span class=\"line\">    <span class=\"keyword\">for</span>(Method method: methods)&#123;</span><br><span class=\"line\">            <span class=\"keyword\">if</span>(method.isAnnotationPresent(Extra.class))&#123;</span><br><span class=\"line\">                System.out.println(method.getDeclaredAnnotation(Extra.class).value());</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<p>显示：</p>\n<p><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">覆盖默认A</span><br><span class=\"line\">覆盖默认B</span><br></pre></td></tr></table></figure></p>\n",
            "tags": [
                "学习笔记",
                "后端",
                "Java"
            ]
        },
        {
            "id": "https://windlinxy.top/2022/12/22/d771f6aaedde/",
            "url": "https://windlinxy.top/2022/12/22/d771f6aaedde/",
            "title": "数据库复习",
            "date_published": "2022-12-22T13:22:52.000Z",
            "content_html": "<h1 id=\"数据库\"><a class=\"anchor\" href=\"#数据库\">#</a> 数据库</h1>\n<h2 id=\"dbms\"><a class=\"anchor\" href=\"#dbms\">#</a> DBMS</h2>\n<p>DataBase Management System</p>\n<ul>\n<li>数据是数据库存储的基本对象</li>\n<li>数据库是存放数据的仓库</li>\n<li>数据库管理系统是位于用户与操作系统之间的一层数据管理软件。数据库管理系统与操作系统一样，是计算机的基础软件。</li>\n</ul>\n<p>主要功能：</p>\n<ul>\n<li>DDl 数据定义语言</li>\n<li>DML 数据操纵 (Manipulation) 语言</li>\n</ul>\n<p>DBS：数据库系统是由数据库，数据库管理系统、应用程序和数据库管理员组成的存储、管理、处理和维护数据的系统。</p>\n<p>数据库系统与文件系统的本质区别：数据库系统实现整体数据的结构化</p>\n<blockquote>\n<p>模式：也称逻辑模式，是数据库中全体数据的逻辑结构和特征的描述，是所有用户的公共数据视图。</p>\n<p>外模式：数据库的全局逻辑结构，所有用户公共的数据视图</p>\n<p>内模式：也称存储模式，是数据物理结构和存储方式的描述，是数据在数据库内部的组织方式。</p>\n</blockquote>\n<p>数据库设计的步骤：</p>\n<ol>\n<li>需求分析</li>\n<li>概念结构设计</li>\n<li>逻辑结构设计</li>\n<li>物理结构设计</li>\n<li>数据库实施</li>\n<li>数据库的运行和维护</li>\n</ol>\n<p><strong>需求分析</strong>：进行数据库设计首先必须准确了解与分析用户需求。需求分析是整个设计过程的基础</p>\n<p><strong>概念结构设计：<strong>通过对用户需求进行</strong>综合、归纳与抽象</strong>形成一个独立于具体 DBMS 的概念模型。</p>\n<p><strong>逻辑结构设计</strong>：将概念结构转化为某个数据库管理系统所支持的数据模型，并对其进行优化</p>\n<p><strong>物理结构设计阶段</strong>：为逻辑数据模型选取一个最适合应用环境的物理结构（包括存储结构和存取方法</p>\n<h2 id=\"事务\"><a class=\"anchor\" href=\"#事务\">#</a> 事务</h2>\n<p>事务是用户定义的一个数据库操作序列</p>\n<p><strong>事务与程序是两个概念</strong></p>\n<ul>\n<li>一个事务可以是一条 SQL 语句，一组 SQl 语句或整个程序</li>\n<li>一个应用程序包含多个事务</li>\n</ul>\n<p><strong>事务是并发控制和恢复的基本单位</strong>、</p>\n<p>定义事务：</p>\n<p><figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">begin</span> transaction</span><br><span class=\"line\">if() <span class=\"keyword\">rollback</span></span><br><span class=\"line\"><span class=\"keyword\">commit</span></span><br></pre></td></tr></table></figure></p>\n<p>若用户未显式定义事务，DBMS 按默认设置划分</p>\n<p>事务特性</p>\n<ul>\n<li>原子性 Atomic：事务是数据库操作的逻辑单位</li>\n<li>一致性 Consistency：事务的执行结果是数据库从一个一致性状态到另一个一致性状态</li>\n<li>隔离性 Isolation：并发执行的事务之间不能互相干扰</li>\n<li>持久性 Durability：一个事务一旦提交对数据库中数据的改变是永久的</li>\n</ul>\n<h3 id=\"锁\"><a class=\"anchor\" href=\"#锁\">#</a> 锁</h3>\n<p>基本锁类型：</p>\n<ul>\n<li>排它锁或写锁</li>\n<li>共享锁或读锁</li>\n</ul>\n<p><strong>并发事务调度正确性的唯一准则：可串行化</strong></p>\n<p>几个事务并行执行时正确的当且仅当其结果与某一次序串行执行的结果相同</p>\n<p>保证并发调度正确性的方法：两段锁协议：</p>\n<ol>\n<li>事务对任何数据进行读写操作之前，首先要获得对改数据的封锁</li>\n<li>事务一旦开始释放锁，不允许其再获得其他锁</li>\n</ol>\n<p>事务执行分为了两个阶段</p>\n<ol>\n<li>加锁，扩展阶段</li>\n<li>解锁，收缩阶段</li>\n</ol>\n<p>对一个数据库节点加意向锁表示最它下一个节点加 X/S 锁</p>\n<p><img data-src=\"https://raw.githubusercontent.com/Windlinxy/Typora-img/main/img/202212220930210.png\" alt=\"image-20221222093028992\" /></p>\n<p>锁的强度：X 》SIX 》S/IX 》IS</p>\n<p>申请封锁：自上而下</p>\n<p>释放封锁：自下而上</p>\n<h2 id=\"数据库恢复技术\"><a class=\"anchor\" href=\"#数据库恢复技术\">#</a> 数据库恢复技术</h2>\n<p><strong>故障是不可避免的：</strong></p>\n<ul>\n<li>计算机硬件故障</li>\n<li>系统软件和硬件故障</li>\n<li>操作员的失误</li>\n<li>程序 BUG</li>\n<li>恶意的破坏、病毒</li>\n</ul>\n<p><strong>故障种类：</strong></p>\n<ul>\n<li>\n<p><strong>事务故障</strong></p>\n<p>常见原因：</p>\n<ul>\n<li>输入数据有误</li>\n<li>运算溢出</li>\n<li>违反了某些完整性限制</li>\n<li>应用程序出错</li>\n<li>并行事务发生死锁</li>\n</ul>\n<p>恢复：</p>\n<ul>\n<li>强行回滚</li>\n</ul>\n</li>\n<li>\n<p><strong>系统故障</strong>：</p>\n<ul>\n<li>整个系统正常运行突然被破坏</li>\n<li>所有正在运行的事务都非正常停止</li>\n<li>内存中数据库缓冲区的信息全部丢失</li>\n<li>外存上的数据未受影响</li>\n</ul>\n<p>常见原因：</p>\n<ul>\n<li>操作系统或 DBMS 代码错误</li>\n<li>操作员失误</li>\n<li>特定的硬件错误</li>\n<li>突然停电</li>\n</ul>\n<p>恢复：</p>\n<ul>\n<li>\n<p>Rollback 回滚所有未完成事务（UNDO</p>\n</li>\n<li>\n<p>Commited 已提交的事务可能有未来得及写入磁盘的内容 REDO</p>\n</li>\n</ul>\n</li>\n<li>\n<p><strong>介质故障</strong></p>\n<ul>\n<li>存储在外存中的数据部分或全部丢失\n<ul>\n<li>磁盘损坏</li>\n<li>磁头碰撞</li>\n<li>瞬时强电磁场</li>\n<li>操作系统某种潜在错误\n<ul>\n<li>装入 数据库发生介质故障前某个时刻的数据副本</li>\n<li>重做滋此时所有成功事务，讲这些事务已提交的结果重新计入数据</li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"恢复的实现技术\"><a class=\"anchor\" href=\"#恢复的实现技术\">#</a> 恢复的实现技术</h3>\n<ul>\n<li>数据转储：静态转储 / 动态转储 海量转储 / 增量转储</li>\n<li>登记日志文件</li>\n</ul>\n<p><strong>静态转储：</strong></p>\n<ul>\n<li>在系统中无运行事务时进行转储</li>\n<li>转储开始时数据库处于一致性状态</li>\n<li>转储期间不允许对数据库的任何存取、修改</li>\n</ul>\n<p>优点：实现简单</p>\n<p>缺点：降低了数据库的可用性</p>\n<p>转储必须等待事务结束，新的事务必须等待转储结束</p>\n<p><strong>动态转储</strong></p>\n<p>转储操作与事务并发进行，转储时允许对数据库进行存取、修改</p>\n<p>优点：不用等待正在运行的事务结束，不会影响事务的运行</p>\n<p>缺点：不能保证副本中的数据全部正确有效</p>\n<p>海量转储：每次转储全部数据库</p>\n<p>增量转储：只转储上次转储后更新过的数据</p>\n<p>比较：</p>\n<ul>\n<li>从恢复的角度看，海量转储得到的后备副本往往更方便恢复</li>\n<li>如果数据库很大，事务十分频繁，增量转储的方式更实用有效</li>\n</ul>\n<h3 id=\"日志文件\"><a class=\"anchor\" href=\"#日志文件\">#</a> 日志文件</h3>\n<p>日志：记录事务对数据库更新操作的文件</p>\n<p>日志文件的格式：</p>\n<ul>\n<li>以记录为单位的日志文件</li>\n<li>以数据块为单位的日志文件</li>\n</ul>\n<p>日志文件内容：每个事务开始 / 结束，每个事务的更新操作</p>\n<ul>\n<li>事务开始 start / 事务结束 commit</li>\n<li>记录每一个更新操作：\n<ul>\n<li>事务标识</li>\n<li>操作类型</li>\n<li>数据对象</li>\n<li>更新前的旧值</li>\n<li>更新后的值</li>\n</ul>\n</li>\n</ul>\n<p><strong>登记日志文件必须遵守两条原则：</strong></p>\n<ul>\n<li>登记的次序严格按照事务的执行<strong>时间次序</strong></li>\n<li>必须先写日志文件，后写数据库</li>\n</ul>\n<h3 id=\"恢复策略\"><a class=\"anchor\" href=\"#恢复策略\">#</a> 恢复策略</h3>\n<ul>\n<li>\n<p>事务故障的恢复：事务在运行在正常终止点前被终止</p>\n<p>由恢复子系统应利用日志文件撤销此事务已对数据库进行的修改</p>\n</li>\n<li>\n<p>系统故障的恢复：系统重启时自动完成</p>\n<p>UNDO 故障发生时未提交的事务</p>\n<p>REDO 故障发生时已提交的事务</p>\n</li>\n<li>\n<p>介质故障的恢复</p>\n<p>重装数据库备份，使数据库恢复到一致性状态</p>\n<p>REDO 已完成的事务</p>\n</li>\n</ul>\n<p>无日志、使用静态转储副本进行恢复：</p>\n<p>正常运行：Ta = 静态转储 =&gt; Tb = 运行事务 =&gt; Tf</p>\n<p>恢复：重装后备副本 ==》重新运行事务</p>\n<h2 id=\"程序设计\"><a class=\"anchor\" href=\"#程序设计\">#</a> 程序设计</h2>\n<p><strong>增：</strong>  <code>insert into 表名 values();</code>  或者 <code>insert into 表名(列名...) values();</code></p>\n<p><strong>删：</strong> <code>delete from 表名 where……;</code></p>\n<p><strong>改：</strong> <code>update 表名 set 列名 = …… where ……;</code></p>\n<p><strong>查：</strong> <code>select */列名 from 表名 / where; </code></p>\n<p><strong>视图</strong>： <code>create view name as select……;</code></p>\n<h3 id=\"触发器\"><a class=\"anchor\" href=\"#触发器\">#</a> 触发器</h3>\n<p><code>create</code>    <code>after</code>   <code>referencing</code>   <code>for</code>   <code>begin</code> ……</p>\n<p><figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">DROP</span> <span class=\"keyword\">TRIGGER</span> if <span class=\"keyword\">EXISTS</span> testi; <span class=\"comment\">-- 如果存在testi触发器则删除</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">CREATE</span> <span class=\"keyword\">TRIGGER</span> testi </span><br><span class=\"line\">AFTER <span class=\"keyword\">INSERT</span> <span class=\"keyword\">ON</span> <span class=\"keyword\">table</span></span><br><span class=\"line\"><span class=\"keyword\">FOR</span> <span class=\"keyword\">EACH</span> <span class=\"type\">ROW</span></span><br><span class=\"line\"><span class=\"keyword\">BEGIN</span></span><br><span class=\"line\">\t<span class=\"keyword\">INSERT</span> <span class=\"keyword\">INTO</span> bysj_dt <span class=\"keyword\">VALUES</span> (new.id,new.et_name);</span><br><span class=\"line\"><span class=\"keyword\">END</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">create</span> <span class=\"keyword\">trigger</span> test</span><br><span class=\"line\">after <span class=\"keyword\">delete</span> <span class=\"keyword\">on</span> Student</span><br><span class=\"line\"><span class=\"keyword\">referencing</span> <span class=\"keyword\">old</span> <span class=\"type\">row</span> <span class=\"keyword\">as</span> orow</span><br><span class=\"line\"><span class=\"keyword\">FOR</span> <span class=\"keyword\">EACH</span> <span class=\"type\">ROW</span></span><br><span class=\"line\"><span class=\"keyword\">begin</span></span><br><span class=\"line\">\t<span class=\"keyword\">DELETE</span> <span class=\"keyword\">FROM</span> SC <span class=\"keyword\">WHERE</span> SC.Sno <span class=\"operator\">=</span> orow.Sno;</span><br><span class=\"line\"><span class=\"keyword\">end</span></span><br></pre></td></tr></table></figure></p>\n<h3 id=\"存储过程\"><a class=\"anchor\" href=\"#存储过程\">#</a> 存储过程</h3>\n<p><figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">create</span> <span class=\"keyword\">procedure</span> countByDept(<span class=\"keyword\">in</span> deptName <span class=\"type\">varchar</span>(<span class=\"number\">20</span>), <span class=\"keyword\">out</span> cnt <span class=\"type\">integer</span>)</span><br><span class=\"line\"><span class=\"keyword\">begin</span></span><br><span class=\"line\">\t<span class=\"keyword\">select</span> <span class=\"built_in\">count</span>(<span class=\"operator\">*</span>) <span class=\"keyword\">into</span> cnt</span><br><span class=\"line\">\t<span class=\"keyword\">from</span> student</span><br><span class=\"line\">\t<span class=\"keyword\">where</span> student.Sdept <span class=\"operator\">=</span> deptName;</span><br><span class=\"line\"><span class=\"keyword\">end</span></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"># 调用存储过程</span><br><span class=\"line\"><span class=\"keyword\">call</span> countByDept(<span class=\"string\">&#x27;CS&#x27;</span>,<span class=\"variable\">@cnt</span>)</span><br><span class=\"line\"><span class=\"keyword\">select</span> <span class=\"variable\">@cnt</span>\t\t</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure></p>\n<h3 id=\"函数\"><a class=\"anchor\" href=\"#函数\">#</a> 函数</h3>\n<p><figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">create</span> <span class=\"keyword\">function</span> countByDept(deptName <span class=\"type\">varchar</span>(<span class=\"number\">20</span>))</span><br><span class=\"line\"><span class=\"keyword\">returns</span> <span class=\"type\">integer</span></span><br><span class=\"line\"><span class=\"keyword\">begin</span></span><br><span class=\"line\">\t<span class=\"keyword\">declare</span> cnt <span class=\"type\">integer</span>;</span><br><span class=\"line\">\t<span class=\"keyword\">select</span> <span class=\"built_in\">count</span>(<span class=\"operator\">*</span>) <span class=\"keyword\">into</span> cnt</span><br><span class=\"line\">\t<span class=\"keyword\">from</span> student</span><br><span class=\"line\">\t<span class=\"keyword\">where</span> student.Stept <span class=\"operator\">=</span> deptName;</span><br><span class=\"line\">\t<span class=\"keyword\">return</span> cnt;</span><br><span class=\"line\"><span class=\"keyword\">end</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"># 调用函数</span><br><span class=\"line\"><span class=\"keyword\">select</span> countByDept(&quot;CS&quot;)</span><br></pre></td></tr></table></figure></p>\n<h3 id=\"jdbc\"><a class=\"anchor\" href=\"#jdbc\">#</a> JDBC</h3>\n<p><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> java.sql.*;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">testjdbc</span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title function_\">main</span><span class=\"params\">(String[] args)</span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">try</span>&#123;</span><br><span class=\"line\">            Class.forName(<span class=\"string\">&quot;org.mariadb.jdbc.Driver&quot;</span>).newInstance();</span><br><span class=\"line\">            System.out.println(<span class=\"string\">&quot;pass forName&quot;</span>);</span><br><span class=\"line\">            <span class=\"type\">Connection</span> <span class=\"variable\">conn</span> <span class=\"operator\">=</span> DriverManager.getConnection(<span class=\"string\">&quot;jdbc:mysql://localhost:3306/StuCou&quot;</span>,<span class=\"string\">&quot;root&quot;</span>,<span class=\"string\">&quot;&quot;</span>);</span><br><span class=\"line\">            <span class=\"type\">Statement</span> <span class=\"variable\">stmt</span> <span class=\"operator\">=</span> conn.createStatement();</span><br><span class=\"line\">            <span class=\"type\">String</span> <span class=\"variable\">query</span> <span class=\"operator\">=</span> <span class=\"string\">&quot;select * from Student&quot;</span>;</span><br><span class=\"line\">            <span class=\"type\">ResultSet</span> <span class=\"variable\">rs</span> <span class=\"operator\">=</span> stmt.excuteQuery(query);</span><br><span class=\"line\">            <span class=\"keyword\">while</span>(rs.next())&#123;</span><br><span class=\"line\">                sout……</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            conn.close();</span><br><span class=\"line\">        &#125;<span class=\"keyword\">catch</span>(SQLException e)&#123;</span><br><span class=\"line\">            sout(e.getSQLState());</span><br><span class=\"line\">            sout(e.getErrorCode());</span><br><span class=\"line\">        &#125;<span class=\"keyword\">catch</span>(Exception e)&#123;</span><br><span class=\"line\">            e.printStackTrace();</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n",
            "tags": [
                "数据库考试"
            ]
        },
        {
            "id": "https://windlinxy.top/2022/11/19/317a105d7096/",
            "url": "https://windlinxy.top/2022/11/19/317a105d7096/",
            "title": "项目部署云服务器流程",
            "date_published": "2022-11-19T06:05:04.000Z",
            "content_html": "<h1 id=\"安全相关\"><a class=\"anchor\" href=\"#安全相关\">#</a> 安全相关</h1>\n<h2 id=\"防火墙开放端口\"><a class=\"anchor\" href=\"#防火墙开放端口\">#</a> 防火墙开放端口</h2>\n<table>\n<thead>\n<tr>\n<th style=\"text-align:center\">名称</th>\n<th style=\"text-align:center\">端口</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:center\">Tomcat 外部访问</td>\n<td style=\"text-align:center\">8080-9000</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">Mysql 远程连接</td>\n<td style=\"text-align:center\">3306</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">Redis 远程连接</td>\n<td style=\"text-align:center\">6379</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">RabbitMQ：Web 界面</td>\n<td style=\"text-align:center\">15672</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">Rabbit： AMQP</td>\n<td style=\"text-align:center\">5672</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">Rabbit：Stomp</td>\n<td style=\"text-align:center\">61613</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">Rabbit：MQTT</td>\n<td style=\"text-align:center\">1883</td>\n</tr>\n</tbody>\n</table>\n<h1 id=\"openjdk安装\"><a class=\"anchor\" href=\"#openjdk安装\">#</a> openjdk 安装</h1>\n<p><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">su -c &quot;yum install java-1.8.0-openjdk&quot;</span><br></pre></td></tr></table></figure></p>\n<h1 id=\"yum仓库管理\"><a class=\"anchor\" href=\"#yum仓库管理\">#</a> yum 仓库管理</h1>\n<p><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">yum-config-manager --add-repo http://mirrors.aliyun.com/dockerce/linux/centos/docker-ce.repo</span><br><span class=\"line\">yum-config-manager \\</span><br><span class=\"line\">--add-repo \\</span><br><span class=\"line\">https://download.docker.com/linux/centos/docker-ce.repo</span><br></pre></td></tr></table></figure></p>\n<h1 id=\"mysql安装\"><a class=\"anchor\" href=\"#mysql安装\">#</a> mysql 安装</h1>\n<p><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">移除自带mariab数据库</span></span><br><span class=\"line\">yum remove -y `rpm -aq mariadb*`</span><br><span class=\"line\"><span class=\"meta prompt_\"></span></span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">查询本机是否有mysql</span></span><br><span class=\"line\">rpm -qa | grep mysql</span><br><span class=\"line\"><span class=\"meta prompt_\"></span></span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">获取mysql安装包</span></span><br><span class=\"line\">wget -i -c http://dev.mysql.com/get/mysql57-community-release-el7-10.noarch.rpm</span><br><span class=\"line\"><span class=\"meta prompt_\"></span></span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">安装</span></span><br><span class=\"line\">yum -y install mysql57-community-release-el7-10.noarch.rpm</span><br><span class=\"line\"><span class=\"meta prompt_\"></span></span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">关闭gpg签名</span></span><br><span class=\"line\">yum -y install mysql-community-server --nogpgcheck</span><br></pre></td></tr></table></figure></p>\n<p><strong>mysql 初始化</strong></p>\n<p><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">systemctl start  mysqld.service</span><br></pre></td></tr></table></figure></p>\n<p><strong>修改密码</strong></p>\n<p><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta prompt_\">#</span><span class=\"language-bash\">获取初始密码</span></span><br><span class=\"line\">grep &#x27;password&#x27; /var/log/mysqld.log</span><br><span class=\"line\">ALTER USER USER() IDENTIFIED BY &#x27;root&#x27;;</span><br></pre></td></tr></table></figure></p>\n<p><strong>设置远程连接权限</strong></p>\n<p><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">grant all privileges on *.* to root@&#x27;%&#x27; identified by &quot;password&quot;;</span><br></pre></td></tr></table></figure></p>\n<h1 id=\"redis安装\"><a class=\"anchor\" href=\"#redis安装\">#</a> redis 安装</h1>\n<p><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">执行以下命令升级gcc</span></span><br><span class=\"line\">yum install gcc-c++ </span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">安装软件集scl</span></span><br><span class=\"line\">yum -y install centos-release-scl</span><br><span class=\"line\">yum -y install devtoolset-9-gcc devtoolset-9-gcc-c++ devtoolset-9-binutils</span><br><span class=\"line\">scl enable devtoolset-9 bash</span><br><span class=\"line\">echo “source /opt/rh/devtoolset-9/enable” &gt;&gt; /etc/profile</span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">获取安装包</span></span><br><span class=\"line\">wget https://download.redis.io/redis-stable.tar.gz </span><br><span class=\"line\">tar -zxvf redis-stable.tar.gz </span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">进入redis目录</span></span><br><span class=\"line\"><span class=\"meta prompt_\">#</span><span class=\"language-bash\">编译</span></span><br><span class=\"line\">make</span><br><span class=\"line\"><span class=\"meta prompt_\">#</span><span class=\"language-bash\">安装</span></span><br><span class=\"line\">make install</span><br><span class=\"line\"><span class=\"meta prompt_\">#</span><span class=\"language-bash\"><span class=\"comment\">#### 安装完成</span></span></span><br><span class=\"line\"></span><br><span class=\"line\">后台启动</span><br><span class=\"line\">cd /usr/local/redis-stable</span><br><span class=\"line\">cp redis.conf redis.conf.bak</span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">编辑配置文件</span></span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">将<span class=\"built_in\">bind</span>注释（远程连接）</span> </span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">protected-mode no 无密码登录</span></span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">daemonize <span class=\"built_in\">yes</span> 后台启动</span></span><br><span class=\"line\">vim redis.conf</span><br></pre></td></tr></table></figure></p>\n<h1 id=\"nginx\"><a class=\"anchor\" href=\"#nginx\">#</a> Nginx</h1>\n<p><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">nginx需要gcc环境，没有就安装</span></span><br><span class=\"line\">yum install gcc-c++</span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">Nginx的http模块需要使用pcre来解析正则表达式，需要安装pcre</span></span><br><span class=\"line\">yum install -y pcre pcre-devel</span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">安装依赖的解压包</span></span><br><span class=\"line\">yum install -y zlib zlib-devel</span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">ssl 功能需要 openssl 库，安装 openssl</span></span><br><span class=\"line\">yum install -y openssl openssl-devel</span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">下载nginx</span></span><br><span class=\"line\">wget https://nginx.org/download/nginx-1.22.1.tar.gz</span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">解压</span></span><br><span class=\"line\">tar -zxvf nginx-1.22.1.tar.gz</span><br><span class=\"line\">cd /usr/local/nginx</span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">配置安装路径，否则默认/usr/bin</span></span><br><span class=\"line\">./configure --prefix=/usr/local/nginx</span><br><span class=\"line\">mkdir logs</span><br><span class=\"line\"><span class=\"meta prompt_\">#</span><span class=\"language-bash\">编译</span></span><br><span class=\"line\">make</span><br><span class=\"line\"><span class=\"meta prompt_\">#</span><span class=\"language-bash\">安装，可能会报错，但是会安装成功</span></span><br><span class=\"line\">make install</span><br></pre></td></tr></table></figure></p>\n<h1 id=\"docker\"><a class=\"anchor\" href=\"#docker\">#</a> Docker</h1>\n<blockquote>\n<p>使用 docker 可以轻松布置环境</p>\n</blockquote>\n<h2 id=\"安装步骤\"><a class=\"anchor\" href=\"#安装步骤\">#</a> 安装步骤</h2>\n<ol>\n<li>\n<p>官网安装手册：<span class=\"exturl\" data-url=\"aHR0cHM6Ly9kb2NzLmRvY2tlci5jb20vZW5naW5lL2luc3RhbGwvY2VudG9zLw==\">https://docs.docker.com/engine/install/centos/</span></p>\n</li>\n<li>\n<p>确定是 CentOS7 以上版本</p>\n</li>\n<li>\n<p>yum 安装 gcc 相关环境：</p>\n<p><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">yum -y install gcc</span><br><span class=\"line\">yum -y install gcc-c++</span><br></pre></td></tr></table></figure></p>\n</li>\n<li>\n<p>卸载旧版本</p>\n<p><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">yum remove docker \\</span><br><span class=\"line\">docker-client \\</span><br><span class=\"line\">docker-client-latest \\</span><br><span class=\"line\">docker-common \\</span><br><span class=\"line\">docker-lastest \\</span><br><span class=\"line\">docker-latest-logrotate \\</span><br><span class=\"line\">docker-logrotate \\</span><br><span class=\"line\">docker-engine</span><br></pre></td></tr></table></figure></p>\n</li>\n<li>\n<p>安装需要软件包</p>\n<p><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">yum install -y yum-utils</span><br></pre></td></tr></table></figure></p>\n</li>\n<li>\n<p>设置镜像仓库</p>\n<p><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">yum-config-manager \\</span><br><span class=\"line\">--add-repo \\ https://download.docker.com/linux/centos/docker-ce.repo</span><br><span class=\"line\"></span><br><span class=\"line\">yum-config-manager --add-repo http://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure></p>\n</li>\n<li>\n<p>更新 yum 软件包索引</p>\n<p><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">yum makecache fast</span><br></pre></td></tr></table></figure></p>\n</li>\n<li>\n<p>安装 Docker CE</p>\n<p><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">yum install docker-ce-cli containerd.io</span><br><span class=\"line\">yum install -y docker-ce</span><br></pre></td></tr></table></figure></p>\n</li>\n<li>\n<p>启动 Docker</p>\n<p><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">systemctl start docker</span><br></pre></td></tr></table></figure></p>\n</li>\n<li>\n<p>测试命令</p>\n<p><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker version</span><br><span class=\"line\">docker run hello-world</span><br><span class=\"line\">docker images</span><br></pre></td></tr></table></figure></p>\n</li>\n<li>\n<p>卸载</p>\n<p><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">systemctl stop docker</span><br><span class=\"line\"></span><br><span class=\"line\">yum -y remove docker-ce docker-ce-cli containerd.io</span><br><span class=\"line\"></span><br><span class=\"line\">rm -rf /var/lib/docker</span><br></pre></td></tr></table></figure></p>\n</li>\n</ol>\n<h2 id=\"阿里云镜像加速\"><a class=\"anchor\" href=\"#阿里云镜像加速\">#</a> 阿里云镜像加速</h2>\n<p><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sudo mkdir -p /etc/docker</span><br><span class=\"line\">sudo tee /etc/docker/daemon.json &lt;&lt;-&#x27;EOF&#x27;</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">&quot;registry-mirrors&quot;: [&quot;https://qiyb9988.mirror.aliyuncs.com&quot;]</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">EOF</span><br><span class=\"line\">sudo systemctl daemon-reload</span><br><span class=\"line\">sudo systemctl restart docker</span><br></pre></td></tr></table></figure></p>\n<h2 id=\"实用\"><a class=\"anchor\" href=\"#实用\">#</a> 实用</h2>\n<blockquote>\n<p>&lt;span style=&quot;color:red&quot;&gt; 注意！在 Docker 运行的容器是访问不到宿主机其他端口的，localhost 是用不了的，需要用 <code>ip addr show docker0</code>  命令找到 docker 容器能够识别的本机 ip，然后将项目中的连接 ip 修改成获得的 ip&lt;/span&gt;</p>\n</blockquote>\n<h3 id=\"可视化面板\"><a class=\"anchor\" href=\"#可视化面板\">#</a> 可视化面板</h3>\n<p><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker run -d -p 8088:9000 \\</span><br><span class=\"line\">--restart=always -v /var/run/docker.sock:/var/run/docker.sock --privileged=true portainer/portainer</span><br></pre></td></tr></table></figure></p>\n<h3 id=\"tomcat\"><a class=\"anchor\" href=\"#tomcat\">#</a> Tomcat</h3>\n<p><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">tomcat 部署</span></span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">端口映射：-p 8080:8080</span></span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">后台运行：-d</span></span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">容器名：--name</span></span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">webapps挂载 -v /data/docker/tomcat/webapps:/usr/local/tomcat/webapps</span></span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">logs挂载：-v /data/docker/tomcat/logs:/usr/local/tomcat/logs</span> </span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">privileged启动的容器，可以看到很多host上的设备，并且可以执行mount</span></span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">--privileged=<span class=\"literal\">true</span></span></span><br><span class=\"line\">docker run -it -d -p 8080:8080 -v /data/docker/tomcat/logs:/usr/local/tomcat/logs  -v /data/docker/tomcat/webapps:/usr/local/tomcat/webapps --name tomcat --privileged=true tomcat:8.5.59</span><br></pre></td></tr></table></figure></p>\n<h3 id=\"nginx-2\"><a class=\"anchor\" href=\"#nginx-2\">#</a> Nginx</h3>\n<p><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">端口映射：-p 80:80</span></span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">后台运行：-d</span></span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">容器名：--name</span></span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">配置文件挂载：-v /data/docker/nginx/nginx.conf:/etc/nginx/nginx.conf \\</span></span><br><span class=\"line\"><span class=\"language-bash\"><span class=\"comment\"># 虚拟主机配置挂载：-v /data/docker/nginx/conf.d:/etc/nginx/conf.d \\</span></span></span><br><span class=\"line\"><span class=\"language-bash\"><span class=\"comment\"># 证书文件挂载：-v /data/docker/nginx/cert:/etc/nginx/cert \\</span></span></span><br><span class=\"line\"><span class=\"language-bash\"><span class=\"comment\"># 静态资源：-v /data/docker/nginx/html:/usr/share/nginx/html \\</span></span></span><br><span class=\"line\"><span class=\"language-bash\"><span class=\"comment\"># 中文乱码：-e LANG=C.UTF-8 -e LC_ALL=C.UTF-8 \\</span></span></span><br><span class=\"line\"><span class=\"language-bash\"><span class=\"comment\"># privileged启动的容器，可以看到很多host上的设备，并且可以执行mount</span></span></span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">--privileged=<span class=\"literal\">true</span></span></span><br><span class=\"line\">docker run -d -p 80:80 --name nginx \\</span><br><span class=\"line\"> -v /data/docker/nginx/cert:/etc/nginx/cert \\</span><br><span class=\"line\"> -v /data/docker/nginx/html:/usr/share/nginx/html \\</span><br><span class=\"line\"> -v /data/docker/nginx/log:/var/log/nginx \\</span><br><span class=\"line\"> -e LANG=C.UTF-8 -e LC_ALL=C.UTF-8 \\</span><br><span class=\"line\"> -v /data/docker/nginx/conf.d:/etc/nginx/conf.d \\</span><br><span class=\"line\"> --privileged=true nginx</span><br><span class=\"line\"><span class=\"meta prompt_\"></span></span><br><span class=\"line\"><span class=\"meta prompt_\">#</span><span class=\"language-bash\">运行容器</span></span><br><span class=\"line\">docker run -d -p 80:80 --name nginx nginx</span><br><span class=\"line\"><span class=\"meta prompt_\">#</span><span class=\"language-bash\">进入容器查看需要挂载的文件</span></span><br><span class=\"line\">docker exec -it nginx /bin/bash             </span><br><span class=\"line\"></span><br></pre></td></tr></table></figure></p>\n",
            "tags": [
                "经验总结",
                "后端"
            ]
        },
        {
            "id": "https://windlinxy.top/2022/11/17/b73eedab4ef3/",
            "url": "https://windlinxy.top/2022/11/17/b73eedab4ef3/",
            "title": "NIO的一些问题",
            "date_published": "2022-11-17T09:51:34.000Z",
            "content_html": "<h1 id=\"nio存在的问题\"><a class=\"anchor\" href=\"#nio存在的问题\">#</a> NIO 存在的问题</h1>\n<p>在 NIO 中，若<strong> Selecto</strong>r 的轮询结果为空，也没有 <code>wakeup()</code>  或新消息处理，会发生空轮询导致 CPU 占用 100%。</p>\n<p><strong>前置知识：</strong></p>\n<p>JDK1.5 引入 <code>epoll</code>  机制。 <code>epoll</code>  是 linux2.6 内核的系统调用，设计目的就是替代 select、poll 线性复杂度的模型， <code>epoll</code>  的时间复杂度是 O (1)。 <code>epoll</code>  在高并发场景表现优秀。</p>\n<p><strong>文件描述符 (File Descriptor——fd)</strong>：linux 内核利用文件描述符来访问文件，打开显存文件或新建文件时，内核会返回一个文件描述符。读写文件也需要使用文件描述符来指定待读写的文件。</p>\n<p><strong>文件句柄</strong>：Windows 下的概念，句柄是各种对象的标识符，它是一个非负整数，也用于定位文件数据在内存中的位置。</p>\n<p>linux 下的文件描述符其实就相当于 windows 下的句柄。文件句柄只是 windows 众多句柄中的一种类型而已。</p>\n<p><strong>对于操作系统会有这样一个需求：如何在一个进程（线程）中处理多个文件，或者监听多个文件的 IO 事件。</strong></p>\n<p><code>select</code> 、 <code>poll</code>  和 <code>epoll</code>  都是操作系统中实现 IO 多路复用的方法。</p>\n<h2 id=\"select\"><a class=\"anchor\" href=\"#select\">#</a> select</h2>\n<p><code>select</code>  方法本质就是维护了一个文件描述符数组（32 位系统 MAX=1024,64 位 MAX=2048），依次实现 IO 多路复用，select 会监视文件描述符的变化。</p>\n<p><code>select()</code>  机制中提供了 <code>fd_set</code>  数据结构，实际上是一个 long 类型的数组，每个数组元素都能与以打开的文件描述符建立联系。</p>\n<p><code>/proc/sys/fs/file-max</code>  中<strong>指定了系统范围内所有进程可打开的文件的数量限制</strong></p>\n<p>当 <code>select</code>  方法被调用，首先需要将 <code>fd_set</code>  从用户空间拷贝到内核空间，然后内核用 <code>poll</code>  机制（非多路复用的 poll）返回一个 fd 准备就绪个数。方法返回后需要轮询 <code>fd_set</code> ，检查发生 IO 事件的 fd。</p>\n<p>缺陷：</p>\n<ul>\n<li>使用轮询，效率低。</li>\n<li>会导致用户空间和内核空间频繁拷贝数据。</li>\n</ul>\n<h2 id=\"poll\"><a class=\"anchor\" href=\"#poll\">#</a> poll</h2>\n<p><code>poll</code>  和 <code>select</code>  很类似，只不过 <code>poll</code>  维护的是一个链表，单个进程监听的 fd 不再有数量限制，但是和 <code>select</code>  相同的轮询和复制问题依然存在。</p>\n<h2 id=\"epoll\"><a class=\"anchor\" href=\"#epoll\">#</a> epoll</h2>\n<blockquote>\n<p>epoll 全称 EventPoll，是 linux 内核实现 IO 多路复用的模型。</p>\n</blockquote>\n<p>在 Linux 中， <code>selector</code>  和 <code>poll</code>  监听文件描述符 list，进行线性的查找，复杂度 O (n)。</p>\n<p><code>epoll</code>  使用了内核文件级别的回调机制，复杂度 O (1)。</p>\n<p>epoll 基于事件驱动，给每个 fd 注册一个回调函数，当对应的 fd 有 IO 事件发生时就调用这个回调函数，将这个 fd 放入一个链表中，这样客户端可以直接从链表中获得发生 IO 事件的 fd，从而达到 O (1) 级别的监听。</p>\n<p>epoll 有的三个系统调用：<em>epoll_create</em>, <em>epoll_ctl</em>, <em>epoll_wait</em></p>\n<h2 id=\"jdk中epoll的实现\"><a class=\"anchor\" href=\"#jdk中epoll的实现\">#</a> JDK 中 epoll 的实现</h2>\n<p>理论上无客户端连接时 <code>Selector.select()</code>  方法会阻塞，<strong>但空轮询 bug 导致：即使无客户端连接，NIO 照样不断的从 select 本应该阻塞的 <code>Selector.select()</code>  中 wake up 出来，导致 CPU100% 问题。</strong></p>\n",
            "tags": [
                "学习笔记",
                "Java"
            ]
        },
        {
            "id": "https://windlinxy.top/2022/11/16/32e7bb3553da/",
            "url": "https://windlinxy.top/2022/11/16/32e7bb3553da/",
            "title": "IO模型",
            "date_published": "2022-11-16T07:53:18.000Z",
            "content_html": "<h1 id=\"java-io模型\"><a class=\"anchor\" href=\"#java-io模型\">#</a> JAVA IO 模型</h1>\n<h2 id=\"bio\"><a class=\"anchor\" href=\"#bio\">#</a> BIO</h2>\n<p>Blocking IO，同步并阻塞方式，应用程序向 OS 请求网络 IO 操作，然后会等待 IO 操作完成。客户端与服务器端连接，一个连接创建一个线程。</p>\n<p><strong>适用于</strong>连接数目比较小且固定的架构，对服务器要求比较高</p>\n<p><strong>简单流程：</strong></p>\n<ol>\n<li>服务端启动一个 ServerSocket。</li>\n<li>客户端启动 Socket 对服务端通讯，默认情况下服务端对每个客户建立一个线程。</li>\n<li>客户端发送请求后，先检测服务端是否有线程响应，没有则等待或被拒绝。</li>\n<li>有响应，客户端线程等待请求结束返回响应，再继续执行。</li>\n</ol>\n<h2 id=\"nio\"><a class=\"anchor\" href=\"#nio\">#</a> NIO</h2>\n<p>Non-Blocking IO，同步非阻塞，一个线程处理多个请求，客户端发送的连接请求会注册到多路复用器上，多路复用器轮询到 IO 请求会处理</p>\n<p><strong>适用于</strong>连接数目多且连接比较短的架构，比如聊天服务器，弹幕系统，服务器间通讯。</p>\n<h3 id=\"selector-channel和buffer的关系\"><a class=\"anchor\" href=\"#selector-channel和buffer的关系\">#</a> Selector、Channel 和 Buffer 的关系</h3>\n<ul>\n<li>每个 Channel 都会对应一个 Buffer</li>\n<li>Selector 对应一个线程，一个线程对应多个 Channel</li>\n<li>程序切换到哪个 channel 是由事件决定的。</li>\n<li>Selector 会根据不同的事件在各个通道切换</li>\n<li>Buffer 就是一个内存块，底层有个数组</li>\n<li>数据的读取写入是通过 Buffer，可以双向读写，需要 filp 方法切换</li>\n<li>channel 是双向的，可以返回底层操作系统的情况，比如 Linux，底层操作系统的通道就是双向的</li>\n</ul>\n<p><img data-src=\"https://raw.githubusercontent.com/Windlinxy/Typora-img/main/img/202211142010790.png\" alt=\"image-20221114201053624\" /></p>\n<h3 id=\"buffer\"><a class=\"anchor\" href=\"#buffer\">#</a> Buffer</h3>\n<p>Buffer 是一个抽象类，子类有：</p>\n<ul>\n<li>ByteBuffer</li>\n<li>CharBuffer</li>\n<li>ShortBuffer</li>\n<li>IntBuffer</li>\n<li>LongBuffer</li>\n<li>FloatBuffer</li>\n<li>DoubleBuffer</li>\n</ul>\n<p>在子类中有一个数组 hb 用于缓冲的实现。</p>\n<p><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// Invariants: mark &lt;= position &lt;= limit &lt;= capacity</span></span><br><span class=\"line\">\t<span class=\"comment\">// 标记，调用mark()可以将position的值赋给mark，reset()恢复position</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"type\">int</span> <span class=\"variable\">mark</span> <span class=\"operator\">=</span> -<span class=\"number\">1</span>;</span><br><span class=\"line\">\t<span class=\"comment\">// 位置，下一个要读或写的偏移量</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"type\">int</span> <span class=\"variable\">position</span> <span class=\"operator\">=</span> <span class=\"number\">0</span>;</span><br><span class=\"line\">\t<span class=\"comment\">// 缓冲区当前的终点，不能对大于limit的位置修改，limit位置可以修改</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"type\">int</span> limit;</span><br><span class=\"line\">\t<span class=\"comment\">// 容量，可容纳最大数据量，不可修改</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"type\">int</span> capacity;</span><br></pre></td></tr></table></figure></p>\n<h3 id=\"channel\"><a class=\"anchor\" href=\"#channel\">#</a> Channel</h3>\n<ul>\n<li>通道可以同时进行读写</li>\n<li>通道可以实现异步读写数据</li>\n<li>通道可以从缓冲读，可以写到缓冲</li>\n</ul>\n<p>Channel 是一个接口</p>\n<p><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">interface</span> <span class=\"title class_\">Channel</span> <span class=\"keyword\">extends</span> <span class=\"title class_\">Closeable</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"type\">boolean</span> <span class=\"title function_\">isOpen</span><span class=\"params\">()</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">close</span><span class=\"params\">()</span> <span class=\"keyword\">throws</span> IOException;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<p>常用的 Channel 类有 FileChannel（文件读写）、DatagramChannel（UDP 数据读写）、ServerSocketChannel 和 SocketChannel（这俩 TCP 数据读写）</p>\n<p><strong>在各种 channel 所依托的流如果关闭其 <code>read()</code>  方法会返回 - 1，其余返回 0</strong></p>\n<h3 id=\"selector\"><a class=\"anchor\" href=\"#selector\">#</a> Selector</h3>\n<p>用一个线程处理多个客户端连接，就会用到选择器，Selector 可以检测多个注册的通道上是否有事件发生（多个 Channel 以事件的方式可以注册到同一个 Selector）</p>\n<p>只有在 连接 / 通道 真正有读写事件发生时，才会进行读写，大大减少了系统开销，避免了多线程上下文切换导致的开销。</p>\n<blockquote>\n<p>Selector 是一个抽象类，常用方法有</p>\n<ul>\n<li><code>open( )</code> ：得到一个选择器对象</li>\n<li><code>selectedKeys( )</code> ：获得内部集合所有等待 IO 操作的 selectionKey</li>\n<li><code>select(long timeout)</code> ：监控所有注册通道，当有 IO 操作发生时将对应的 SelectionKey 加入到内部集合并且返回，参数超时时间，超时返回有事件发生的 SelectionKey</li>\n<li><code>select()</code> ：阻塞直到注册的通道有事件到达，返回有事件发生的 SelectionKey</li>\n<li><code>selcetNow()</code> ：不阻塞，立马返回</li>\n<li><code>wakeuo()</code> ：唤醒 selector</li>\n<li><code>keys()</code> ：返回当前所有注册在 selector 中 channel 的 selectionKey</li>\n</ul>\n</blockquote>\n<p>一个 SelectionKey 表示了一个特定的 channel 通道对象和一个特定的 selector 选择器对象之间的注册关系。</p>\n<p>🛑<strong>SelectionKey 在被轮询后需要 remove ()，selector 不会自己删除 selectedKeys () 集合中的 selectionKey，如果不人工 remove ()，将导致下次 select () 的时候 selectedKeys () 中仍有上次轮询留下来的信息，这样必然会出现错误。</strong></p>\n<p>🛑<strong>注册过的 channel 信息会以 SelectionKey 的形式存储在 selector.keys () 中。keys () 中的成员是不需要被删除的 (以此来记录 channel 信息)。</strong></p>\n<h4 id=\"selectionkey\"><a class=\"anchor\" href=\"#selectionkey\">#</a> SelectionKey</h4>\n<p>SelectionKey 表示 Selector 与网络通道是注册关系</p>\n<h3 id=\"nio非阻塞网络编程\"><a class=\"anchor\" href=\"#nio非阻塞网络编程\">#</a> NIO 非阻塞网络编程</h3>\n<p>实现：</p>\n<ol>\n<li>\n<p>客户端连接时，会通过 ServerSocketChannel 得到 SocketChannel。</p>\n</li>\n<li>\n<p>将 SocketChannel 注册到 Selector 上， <code>register(Selector sel, int ops)</code> ，一个 Selector 可以注册多个 SocketChannel。</p>\n</li>\n<li>\n<p>注册后返回一个 SelectionKey。</p>\n<p><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 读事件</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"type\">int</span> <span class=\"variable\">OP_READ</span> <span class=\"operator\">=</span> <span class=\"number\">1</span> &lt;&lt; <span class=\"number\">0</span>;</span><br><span class=\"line\"><span class=\"comment\">// 写事件</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"type\">int</span> <span class=\"variable\">OP_WRITE</span> <span class=\"operator\">=</span> <span class=\"number\">1</span> &lt;&lt; <span class=\"number\">2</span>;</span><br><span class=\"line\"><span class=\"comment\">// 连接事件</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"type\">int</span> <span class=\"variable\">OP_CONNECT</span> <span class=\"operator\">=</span> <span class=\"number\">1</span> &lt;&lt; <span class=\"number\">3</span>;</span><br><span class=\"line\"><span class=\"comment\">// 接受连接事件</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"type\">int</span> <span class=\"variable\">OP_ACCEPT</span> <span class=\"operator\">=</span> <span class=\"number\">1</span> &lt;&lt; <span class=\"number\">4</span>;</span><br></pre></td></tr></table></figure></p>\n</li>\n<li>\n<p>Selector 进行监听， <code>select( )</code>  返回有事件发生的通道个数。</p>\n</li>\n<li>\n<p>进一步得到各个 SelectionKey。</p>\n</li>\n<li>\n<p>在通过 SelectionKey 反向获取 SocketChannel。</p>\n</li>\n<li>\n<p>通过得到的 Channel 完成处理。</p>\n</li>\n</ol>\n<p><strong>服务端实现</strong></p>\n<p><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Slf4j(topic = &quot;Server&quot;)</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">NIOServer</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title function_\">main</span><span class=\"params\">(String[] args)</span> <span class=\"keyword\">throws</span> IOException &#123;</span><br><span class=\"line\">        <span class=\"comment\">//创建选择器(open是一个工厂方法)</span></span><br><span class=\"line\">        <span class=\"type\">Selector</span> <span class=\"variable\">selector</span> <span class=\"operator\">=</span> Selector.open();</span><br><span class=\"line\">        <span class=\"comment\">// 创建ServerSocketChannel绑定套接字</span></span><br><span class=\"line\">        <span class=\"type\">ServerSocketChannel</span> <span class=\"variable\">ssChannel</span> <span class=\"operator\">=</span> ServerSocketChannel.open();</span><br><span class=\"line\">        ssChannel.socket().bind(<span class=\"keyword\">new</span> <span class=\"title class_\">InetSocketAddress</span>(<span class=\"string\">&quot;127.0.0.1&quot;</span>, <span class=\"number\">8888</span>));</span><br><span class=\"line\">        <span class=\"comment\">// 设置非阻塞</span></span><br><span class=\"line\">        ssChannel.configureBlocking(<span class=\"literal\">false</span>);</span><br><span class=\"line\">        <span class=\"comment\">// 将通道注册到选择器上，接受连接事件操作</span></span><br><span class=\"line\">        ssChannel.register(selector, SelectionKey.OP_ACCEPT);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// 循环监听</span></span><br><span class=\"line\">        <span class=\"keyword\">while</span> (<span class=\"literal\">true</span>) &#123;</span><br><span class=\"line\">            <span class=\"comment\">//监听事件，会阻塞直到有至少一个事件到达</span></span><br><span class=\"line\">            selector.select();</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"comment\">//获取到达的事件</span></span><br><span class=\"line\">            Set&lt;SelectionKey&gt; keys = selector.selectedKeys();</span><br><span class=\"line\">            <span class=\"comment\">//使用迭代器遍历</span></span><br><span class=\"line\">            Iterator&lt;SelectionKey&gt; keyIterator = keys.iterator();</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"keyword\">while</span> (keyIterator.hasNext()) &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">                <span class=\"type\">SelectionKey</span> <span class=\"variable\">key</span> <span class=\"operator\">=</span> keyIterator.next();</span><br><span class=\"line\"></span><br><span class=\"line\">                <span class=\"comment\">//对应OP_ACCEPT通道事件,客户端连接先执行这个代码</span></span><br><span class=\"line\">                <span class=\"keyword\">if</span> (key.isAcceptable()) &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">                    <span class=\"type\">ServerSocketChannel</span> <span class=\"variable\">ssChannel1</span> <span class=\"operator\">=</span> (ServerSocketChannel) key.channel();</span><br><span class=\"line\"></span><br><span class=\"line\">                    <span class=\"comment\">// 服务器会为每个新连接创建一个 SocketChannel</span></span><br><span class=\"line\">                    <span class=\"type\">SocketChannel</span> <span class=\"variable\">sChannel</span> <span class=\"operator\">=</span> ssChannel1.accept();</span><br><span class=\"line\">                    sChannel.configureBlocking(<span class=\"literal\">false</span>);</span><br><span class=\"line\">                    log.info(<span class=\"string\">&quot;socketChannel HashCode: &#123;&#125;&quot;</span>, sChannel.hashCode());</span><br><span class=\"line\"></span><br><span class=\"line\">                    <span class=\"comment\">// 这个新连接主要用于从客户端读取数据</span></span><br><span class=\"line\">                    sChannel.register(selector, SelectionKey.OP_READ, ByteBuffer.allocate(<span class=\"number\">1024</span>));</span><br><span class=\"line\"></span><br><span class=\"line\">                &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (key.isReadable()) &#123;</span><br><span class=\"line\">                    <span class=\"comment\">// key反向获取对应Channel</span></span><br><span class=\"line\">                    <span class=\"type\">SocketChannel</span> <span class=\"variable\">sChannel</span> <span class=\"operator\">=</span> (SocketChannel) key.channel();</span><br><span class=\"line\">                    <span class=\"comment\">// 拿到之前放进去的ByteBuffer</span></span><br><span class=\"line\">                    <span class=\"type\">ByteBuffer</span> <span class=\"variable\">buffer</span> <span class=\"operator\">=</span> (ByteBuffer) key.attachment();</span><br><span class=\"line\">                    sChannel.read(buffer);</span><br><span class=\"line\">                    <span class=\"comment\">// 读写反转limit=position，position = 0</span></span><br><span class=\"line\">                    buffer.flip();</span><br><span class=\"line\">                    log.info(<span class=\"keyword\">new</span> <span class=\"title class_\">String</span>(buffer.array(), buffer.position(), buffer.limit()));</span><br><span class=\"line\">                    sChannel.close();</span><br><span class=\"line\">                    </span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">                <span class=\"comment\">// 从SectionKeys集合中移除当前已处理的SelectionKey，重复操作</span></span><br><span class=\"line\">                keyIterator.remove();</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br></pre></td></tr></table></figure></p>\n<p><strong>客户端实现</strong></p>\n<p><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Slf4j(topic = &quot;Client&quot;)</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">NiOClient</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title function_\">main</span><span class=\"params\">(String[] args)</span> <span class=\"keyword\">throws</span> IOException, IOException &#123;</span><br><span class=\"line\"><span class=\"comment\">//        Socket socket = new Socket(&quot;127.0.0.1&quot;, 8888);</span></span><br><span class=\"line\"><span class=\"comment\">//        OutputStream out = socket.getOutputStream();</span></span><br><span class=\"line\"><span class=\"comment\">//        String s = &quot;hello world&quot;;</span></span><br><span class=\"line\"><span class=\"comment\">//        out.write(s.getBytes());</span></span><br><span class=\"line\"><span class=\"comment\">//        out.close();</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"type\">SocketChannel</span> <span class=\"variable\">socketChannel</span> <span class=\"operator\">=</span> SocketChannel.open();</span><br><span class=\"line\">        socketChannel.configureBlocking(<span class=\"literal\">false</span>);</span><br><span class=\"line\">        <span class=\"type\">InetSocketAddress</span> <span class=\"variable\">inetSocketAddress</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">InetSocketAddress</span>(<span class=\"string\">&quot;127.0.0.1&quot;</span>,<span class=\"number\">8888</span>);</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(!socketChannel.connect(inetSocketAddress)) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">while</span> (!socketChannel.finishConnect())&#123;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"type\">String</span> <span class=\"variable\">str</span> <span class=\"operator\">=</span> <span class=\"string\">&quot;你好，啊&quot;</span>;</span><br><span class=\"line\">        <span class=\"comment\">// 无需指定大小，直接就是你传进的byte数组大小</span></span><br><span class=\"line\">        <span class=\"type\">ByteBuffer</span> <span class=\"variable\">buffer</span> <span class=\"operator\">=</span> ByteBuffer.wrap(str.getBytes(StandardCharsets.UTF_8));</span><br><span class=\"line\">        socketChannel.write(buffer);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<h2 id=\"nio与零拷贝\"><a class=\"anchor\" href=\"#nio与零拷贝\">#</a> NIO 与零拷贝</h2>\n<h3 id=\"零拷贝\"><a class=\"anchor\" href=\"#零拷贝\">#</a> 零拷贝</h3>\n<p>这要从 Linux 说起：Linux 系统中一切皆文件，很多活动本质上都是读写操作。</p>\n<p>一般的数据拷贝过程：</p>\n<ol>\n<li>当应用程序读取磁盘数据时，调用 read ( ) 从用户态到内核态，该过程由 cpu 完成</li>\n<li>之后 CPU 发送 I/O 请求，磁盘收到请求后开始准备数据</li>\n<li>磁盘将数据传送到磁盘的缓冲区中，然后发送 I/O 中断</li>\n<li>CPU 收到中断后开始拷贝数据，然后由 read () 返回，再从内核态转换成用户态</li>\n</ol>\n<p>直接内存访问（Direct Memory Access）方式是一种硬件直接访问内存的一种方式：</p>\n<ul>\n<li>\n<p>读数据；</p>\n<ol>\n<li>调用 read () 函数，用户态切换内核态，状态切换一次；</li>\n<li>DMA 控制器将数据从磁盘拷贝到内核缓冲区，1 次 DMA 拷贝；</li>\n<li>CPU 将数据从内核缓冲区复制到用户缓冲区，1 次 CPU 拷贝；</li>\n<li>read () 函数返回，用户态切换回用户态，2 次状态切换；</li>\n</ol>\n</li>\n<li>\n<p>写数据；</p>\n<ol>\n<li>调用 write () 函数，用户态切换内核态，1 次切换；</li>\n<li>CPU 将用户缓冲区数据拷贝到内核缓冲区，1 次 CPU 拷贝；</li>\n<li>DMA 将数据从内核缓冲区复制到套接字的缓冲区，1 次 DMA 拷贝；</li>\n<li>write () 函数返回，内核态切换回用户态，2 次切换；</li>\n</ol>\n</li>\n</ul>\n<blockquote>\n<p>零拷贝是网络编程的关键，很多性能优化都离不开零拷贝</p>\n</blockquote>\n<p><strong>在 java 程序中，常用的零拷贝有 mmap（内存映射）和 sendFile</strong></p>\n<h3 id=\"mmap内存映射\"><a class=\"anchor\" href=\"#mmap内存映射\">#</a> mmap 内存映射</h3>\n<p>内存映射文件是 一种读写数据的方法，比常规的流或者通道读写要快，但是会有一些安全问题。</p>\n<p>内存映射文件是一个文件到一块内存的映射。使用内存映射文件处理存储于磁盘的文件时，不比对文件执行 IO 操作。在 Linux 中，mmap 实现了内核中读缓冲区域用户空间缓冲区的映射，从而实现二者的缓冲区共享。这样就减少了一次 cpu 拷贝。</p>\n<ol>\n<li>用户进程通过 <code>mmap()</code>  向操作系统内核发起 IO 调用，<strong>用户态切换为内核态</strong>。</li>\n<li>CPU 利用 DMA 控制器，把数据从硬盘中拷贝到内核缓冲区。</li>\n<li><strong>内核态切换回用户态</strong>， <code>write()</code>  返回。</li>\n<li>用户进程通过 <code>write()</code>  向操作系统内核发起 IO 调用，<strong>用户态切换为内核态</strong>。</li>\n<li>CPU 将内核缓冲区的数据拷贝到的 socket 缓冲区。</li>\n<li>CPU 利用 DMA 控制器，把数据从 socket 缓冲区拷贝到网卡，<strong>内核态切换回用户态</strong>，write 调用返回。</li>\n</ol>\n<p><strong>一次读 + 写 4 次上下文切换，3 次数据拷贝</strong></p>\n<p>MappedByteBuffer 类继承自 ByteBuffer，子类 DirectByteBuffer 内部维护了一个缓存数组偏移量 arrayBaseOffset</p>\n<p>FileChannel 提供了 <code>map()</code>  方法把文件映射到虚拟内存，可以整个文件映射，也可以分段映射</p>\n<p><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Test</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">mappedByteBufferTest</span><span class=\"params\">()</span> <span class=\"keyword\">throws</span> IOException &#123;</span><br><span class=\"line\">        <span class=\"comment\">/*</span></span><br><span class=\"line\"><span class=\"comment\">         * MappedByteBuffer 可让文件直接在内存（堆外内存）修改，操作系统不需要拷贝一次</span></span><br><span class=\"line\"><span class=\"comment\">         */</span></span><br><span class=\"line\">        <span class=\"type\">RandomAccessFile</span> <span class=\"variable\">randomAccessFile</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">RandomAccessFile</span>(<span class=\"string\">&quot;h1.txt&quot;</span>, <span class=\"string\">&quot;rw&quot;</span>);</span><br><span class=\"line\">        <span class=\"type\">FileChannel</span> <span class=\"variable\">fileChannel</span> <span class=\"operator\">=</span> randomAccessFile.getChannel();</span><br><span class=\"line\">        <span class=\"comment\">// FileChannel.MapMode.READ_WRITE 读写模式</span></span><br><span class=\"line\">        <span class=\"comment\">// 0 可以修改的起始位置</span></span><br><span class=\"line\">        <span class=\"comment\">// 映射到内存的大小，即将文件多少个字节映射到内存</span></span><br><span class=\"line\">        <span class=\"comment\">// 可直接修改的范围是0-5</span></span><br><span class=\"line\">        <span class=\"type\">MappedByteBuffer</span> <span class=\"variable\">mappedByteBuffer</span> <span class=\"operator\">=</span> fileChannel.map(FileChannel.MapMode.READ_WRITE, <span class=\"number\">0</span>, <span class=\"number\">5</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">        mappedByteBuffer.put(<span class=\"number\">0</span>, (<span class=\"type\">byte</span>) <span class=\"string\">&#x27;H&#x27;</span>);</span><br><span class=\"line\">        mappedByteBuffer.put(<span class=\"number\">1</span>, (<span class=\"type\">byte</span>) <span class=\"string\">&#x27;H&#x27;</span>);</span><br><span class=\"line\">        mappedByteBuffer.put(<span class=\"number\">2</span>, (<span class=\"type\">byte</span>) <span class=\"string\">&#x27;H&#x27;</span>);</span><br><span class=\"line\">        mappedByteBuffer.put(<span class=\"number\">3</span>, (<span class=\"type\">byte</span>) <span class=\"string\">&#x27;H&#x27;</span>);</span><br><span class=\"line\">        mappedByteBuffer.put(<span class=\"number\">4</span>, (<span class=\"type\">byte</span>) <span class=\"string\">&#x27;H&#x27;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">        randomAccessFile.close();</span><br><span class=\"line\">    &#125;</span><br></pre></td></tr></table></figure></p>\n<h3 id=\"sendfile系统调用\"><a class=\"anchor\" href=\"#sendfile系统调用\">#</a> sendFile 系统调用</h3>\n<p>建立两个文件之间的传输通道</p>\n<ol>\n<li>用户进程发起 <code>sendfile系统调用</code> ，<strong>用户态到内核态</strong></li>\n<li>DMA 控制器，把数据从硬盘中拷贝到内核缓冲区。</li>\n<li>CPU 将读缓冲区中数据拷贝到 socket 缓冲区</li>\n<li>DMA 控制器，异步把数据从 socket 缓冲区拷贝到网卡，</li>\n<li><strong>内核态到回用户态</strong>， <code>sendfile调用</code> 返回。</li>\n</ol>\n<p><strong>2 次上下文切换，最少 3 次数据拷贝</strong></p>\n<h2 id=\"aio\"><a class=\"anchor\" href=\"#aio\">#</a> AIO</h2>\n<p>Asynchronous I/O，异步非阻塞，无论是客户端的连接请求还是读写请求都会异步执行， 由操作系统完成后回调通知服务端程序启动线程去处理</p>\n<p><strong>适用于</strong>连接数目多且连接比较长的架构，相册服务器</p>\n<table>\n<thead>\n<tr>\n<th></th>\n<th style=\"text-align:center\"><strong>BIO</strong></th>\n<th style=\"text-align:center\"><strong>NIO</strong></th>\n<th style=\"text-align:center\"><strong>AIO</strong></th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><strong>IO 模型</strong></td>\n<td style=\"text-align:center\">同步阻塞</td>\n<td style=\"text-align:center\">同步非阻塞（多路复用）</td>\n<td style=\"text-align:center\">异步非阻塞</td>\n</tr>\n<tr>\n<td><strong>编程难度</strong></td>\n<td style=\"text-align:center\">简单</td>\n<td style=\"text-align:center\">复杂</td>\n<td style=\"text-align:center\">复杂</td>\n</tr>\n<tr>\n<td><strong>可靠性</strong></td>\n<td style=\"text-align:center\">差</td>\n<td style=\"text-align:center\">好</td>\n<td style=\"text-align:center\">好</td>\n</tr>\n<tr>\n<td><strong>吞吐量</strong></td>\n<td style=\"text-align:center\">低</td>\n<td style=\"text-align:center\">高</td>\n<td style=\"text-align:center\">高</td>\n</tr>\n</tbody>\n</table>\n",
            "tags": [
                "学习笔记",
                "后端",
                "Java"
            ]
        },
        {
            "id": "https://windlinxy.top/2022/10/04/8787e59dc4ea/",
            "url": "https://windlinxy.top/2022/10/04/8787e59dc4ea/",
            "title": "JUC:线程与进程",
            "date_published": "2022-10-04T13:39:19.000Z",
            "content_html": "<h1 id=\"进程与线程\"><a class=\"anchor\" href=\"#进程与线程\">#</a> 进程与线程</h1>\n<h2 id=\"进程\"><a class=\"anchor\" href=\"#进程\">#</a> 进程</h2>\n<ul>\n<li>程序由指令和数据组成，但这些指令要运行，数据要读写，就必须将指令加载到内存。在指令运行过程中还需要用到磁盘，网络设备。进程就是用来加载指令、管理内存、管理 io 的</li>\n<li>当一个程序被运行，从磁盘加载这个程序的代码至内存，这是就开启了一个进程。</li>\n<li>进程就可以视为程序的一个实例。大部分程序可以同时运行多个实例进程</li>\n</ul>\n<h2 id=\"线程\"><a class=\"anchor\" href=\"#线程\">#</a> 线程</h2>\n<ul>\n<li>一个进程之内可以分为一到多个线程。</li>\n<li>一个线程就是一个指令流，将指令流中的一条条指令以一定的顺序交给 cpu 执行。</li>\n<li>Java 中，线程作为最小调度单位，进程作为资源分配的最小单位。在 windows 中进程是不活动的，只是作为线程的容器。</li>\n</ul>\n<p><strong>二者对比</strong></p>\n<ul>\n<li>\n<p>进程基本上相互独立，而线程存在于进程内，是进程的一个子集。</p>\n</li>\n<li>\n<p>进程拥有共享的资源，如内存空间</p>\n</li>\n<li>\n<p>进程间通信较为复杂</p>\n<ul>\n<li>同一台计算机 的进程通信称为 IPC（Inter-process Communication）</li>\n<li>不同计算机之间的进程通信，需要通过网络，并遵守共同的协议，例如 HTTP</li>\n</ul>\n</li>\n<li>\n<p>线程通信相对简单，因为它们共享进程内的内存，一个例子是多个线程可以访问同一个共享变量</p>\n</li>\n<li>\n<p>线程更加轻量，线程上下文切换成本一般要比进程上下文切换低</p>\n</li>\n</ul>\n<h2 id=\"应用\"><a class=\"anchor\" href=\"#应用\">#</a> 应用</h2>\n<h3 id=\"异步调用\"><a class=\"anchor\" href=\"#异步调用\">#</a> 异步调用</h3>\n<ul>\n<li>需要等待结果返回才能继续运行就是同步</li>\n<li>不需要等待结果返回，就能继续运行就是异步</li>\n</ul>\n<p><strong>注意：同步在多线程还有一层意思，即让多个线程步调一致</strong></p>\n<p>多线程可以让方法的执行变为异步，例如读取磁盘文件，可以单独创建一个线程进行，不至于等待其完成再顺序执行</p>\n<p>tomcat 的异步也是类似的目的，让用户线程处理耗时较长的操作，避免阻塞 tomcat 的工作线程</p>\n<h2 id=\"线程-2\"><a class=\"anchor\" href=\"#线程-2\">#</a> 线程</h2>\n<h3 id=\"创建\"><a class=\"anchor\" href=\"#创建\">#</a> 创建</h3>\n<p>方法 1：直接使用 Thread</p>\n<p><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 创建线程对象</span></span><br><span class=\"line\"><span class=\"type\">Thread</span> <span class=\"variable\">t</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">Thread</span>() &#123;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">run</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        <span class=\"comment\">// 要执行的任务</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\">// \t启动线程</span></span><br><span class=\"line\">t.start();</span><br></pre></td></tr></table></figure></p>\n<p>例如：</p>\n<p><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 构造方法的参数是给线程指定名字，推荐</span></span><br><span class=\"line\"><span class=\"type\">Thread</span> <span class=\"variable\">t1</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">Thread</span>(<span class=\"string\">&quot;t1&quot;</span>) &#123;</span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"comment\">// run 方法内实现了要执行的任务</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">run</span><span class=\"params\">()</span>&#123;</span><br><span class=\"line\">        log.debug(<span class=\"string\">&quot;hello&quot;</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\">t1.strat();</span><br></pre></td></tr></table></figure></p>\n<p>方法 2：使用 Runnable 配合 Thread</p>\n<p><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">class</span> <span class=\"title class_\">B</span> <span class=\"keyword\">implements</span> <span class=\"title class_\">Runable</span> &#123;</span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">run</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        <span class=\"type\">int</span> <span class=\"variable\">i</span> <span class=\"operator\">=</span> <span class=\"number\">80</span>;</span><br><span class=\"line\">        <span class=\"keyword\">while</span>(i&gt;<span class=\"number\">0</span>)&#123;</span><br><span class=\"line\">            System.out.println(<span class=\"string\">&quot;miaomiao--&quot;</span>+i);</span><br><span class=\"line\">            <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">                Thread.sleep(<span class=\"number\">100</span>);</span><br><span class=\"line\">            &#125; <span class=\"keyword\">catch</span> (InterruptedException e) &#123;</span><br><span class=\"line\">                e.printStackTrace();</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            i--;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title function_\">main</span><span class=\"params\">(String[] args)</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">new</span> <span class=\"title class_\">Thread</span>(<span class=\"keyword\">new</span> <span class=\"title class_\">B</span>()).start();</span><br><span class=\"line\">    &#125;</span><br></pre></td></tr></table></figure></p>\n<p>方法 3：FutureTask 配合 Thread</p>\n<p>FutureTask 能够接收 Callable 类型的参数，用来处理有返回结果的情况</p>\n<p><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 创建任务对象</span></span><br><span class=\"line\">FutureTask&lt;Integer&gt; task = <span class=\"keyword\">new</span> <span class=\"title class_\">FutureTask</span>&lt;&gt;(()-&gt;&#123;</span><br><span class=\"line\">    log.debug(<span class=\"string\">&quot;hello&quot;</span>);</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"number\">100</span>;</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//参数1任务对象，参数2 线程名字</span></span><br><span class=\"line\"><span class=\"keyword\">new</span> <span class=\"title class_\">Thread</span>(task, <span class=\"string\">&quot;t&quot;</span>).start();</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 主线程阻塞，同步等待task执行完毕的结果</span></span><br><span class=\"line\"><span class=\"type\">Integer</span> <span class=\"variable\">result</span> <span class=\"operator\">=</span> task.get();</span><br><span class=\"line\">log.debug(<span class=\"string\">&quot;结果是:&#123;&#125;&quot;</span>, result);</span><br></pre></td></tr></table></figure></p>\n<h3 id=\"thread与runnable的关系\"><a class=\"anchor\" href=\"#thread与runnable的关系\">#</a> Thread 与 Runnable 的关系</h3>\n<ul>\n<li>方法 1 是把线程和任务合并在一起，方法 2 是把线程和任务分开</li>\n<li>用 Runnable 更容易与线程池高级 API 配合</li>\n<li>用 Runnable 让任务类脱离了 Thread 继承体系，更灵活</li>\n</ul>\n<h3 id=\"查看进程线程的方法\"><a class=\"anchor\" href=\"#查看进程线程的方法\">#</a> 查看进程线程的方法</h3>\n<p><strong>windows</strong></p>\n<ul>\n<li><code>tasklist</code></li>\n<li><code>taskkill</code></li>\n</ul>\n<p>Linux</p>\n<p><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">- ps -fe</span><br><span class=\"line\">- ps -fT -p &lt;PID&gt;</span><br><span class=\"line\">kill</span><br><span class=\"line\">top</span><br><span class=\"line\">top -H -p &lt;PID&gt;</span><br></pre></td></tr></table></figure></p>\n<p>JAVA</p>\n<ul>\n<li>jps 命令查看所有 java 进程</li>\n<li>jstack &lt;PID&gt; 查看某个 Java 进程 (PID)  的所有状态</li>\n<li>Jconsole 查看 java 进程运行情况</li>\n</ul>\n<h3 id=\"jconsole连接远程监控\"><a class=\"anchor\" href=\"#jconsole连接远程监控\">#</a> Jconsole 连接远程监控</h3>\n<p>需要以如下方式运行你的 java 类</p>\n<p><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">java -Djava.rmi.server.hostname=&#x27;ip地址&#x27; -Dcom.sun.management.jmxremote.ssl=是否安全连接 -Dcom.sun.management.jmxremote.authenticate=是否认证 java类</span><br></pre></td></tr></table></figure></p>\n<ul>\n<li>修改 /etc/hosts 文件将 127.0.0.1 映射至主机名</li>\n</ul>\n<p>如果要认证访问，还需要做如下步骤</p>\n<ul>\n<li>复制 jmxremote.password 文件</li>\n<li>修改 jmxremote.password 和 jmxremote.access 文件的权限为 600 即文件所有者可以读写</li>\n</ul>\n<h2 id=\"原理与线程运行\"><a class=\"anchor\" href=\"#原理与线程运行\">#</a> 原理与线程运行</h2>\n<h3 id=\"栈与栈帧\"><a class=\"anchor\" href=\"#栈与栈帧\">#</a> 栈与栈帧</h3>\n<p>JVM 由堆、栈、方法区所组成，栈内存给线程使用，每个线程启动后，虚拟机就会为其分配一块栈内存。</p>\n<ul>\n<li>每个栈由多个栈帧组成，对应着每次方法调用时所占用的内存</li>\n<li>每个线程只能有一个活动栈帧，对应着当前正在执行的那个方法</li>\n</ul>\n<h3 id=\"线程上下文切换thread-context-switch\"><a class=\"anchor\" href=\"#线程上下文切换thread-context-switch\">#</a> 线程上下文切换（Thread Context Switch）</h3>\n<p>因为以下一些原因导致 cpu 不再执行当前的进程，转而执行另一个线程的代码</p>\n<ul>\n<li>线程的 cpu 时间片用完</li>\n<li>垃圾回收</li>\n<li>有更高优先级的线程需要执行</li>\n<li>线程自己调用 sleep、yield、wait、join、park、synchronized、lock 等方法 chengxu</li>\n</ul>\n<p>当 Context Switch 发生时，需要操作系统来保存当前线程的状态，并恢复另一个线程的状态，Java 中对应的概念就是程序计数器，它的作用就是记住下一条 jvm 指令的执行地址，是线程私有的</p>\n<h3 id=\"常用方法\"><a class=\"anchor\" href=\"#常用方法\">#</a> 常用方法</h3>\n<p><img data-src=\"https://raw.githubusercontent.com/Windlinxy/Typora-img/main/img/202210040949939.png\" alt=\"image-20221004094936815\" /></p>\n<p><img data-src=\"https://raw.githubusercontent.com/Windlinxy/Typora-img/main/img/202210040957520.png\" alt=\"image-20221004095700430\" /></p>\n<h4 id=\"sleep\"><a class=\"anchor\" href=\"#sleep\">#</a> sleep</h4>\n<ol>\n<li>调用 sleep 会让当前线程从 running 进入 Timed Waiting 状态</li>\n<li>其他线程可以使用 interrupt 方法打断正在睡眠的线程，这时线程会抛出 InterruptedException 异常</li>\n<li>睡眠结束后的线程未必会立刻得到执行</li>\n<li>建议使用 TimeUnit 的 sleep 代替 Tread 的 sleep 来获得更好的可读性</li>\n</ol>\n<h4 id=\"yield\"><a class=\"anchor\" href=\"#yield\">#</a> yield</h4>\n<ol>\n<li>调用 yield 方法会让当前线程从 running 转到 runnable 状态，然后调度执行其他同优先级的线程。如果当前没有同优先级的线程，不能保证让当前线程暂停的效果。</li>\n<li>具体操作依赖于操作系统任务调度器</li>\n</ol>\n<h4 id=\"线程优先级\"><a class=\"anchor\" href=\"#线程优先级\">#</a> 线程优先级</h4>\n<ul>\n<li>线程优先级会提示调度器优先调度该线程，但它仅仅是一个提示，调度器可以忽略它</li>\n<li>如果 cpu 很忙，那么优先级高的线程会获得更多的时间片，但 cpu 闲时，优先级几乎没作用。</li>\n</ul>\n<p><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title function_\">printInfo</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">    log.dubug(<span class=\"string\">&quot;priority is &#123;&#125;&quot;</span>, Thread。currentThread().getProiority());</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<h4 id=\"案例防止cpu占用100\"><a class=\"anchor\" href=\"#案例防止cpu占用100\">#</a> 案例：防止 cpu 占用 100%</h4>\n<h5 id=\"sleep实现\"><a class=\"anchor\" href=\"#sleep实现\">#</a> sleep 实现</h5>\n<p>在没有利用 cpu 计算时，while (true) 空转会浪费 cpu，这时可以使用 yield 或 sleep 来让 cpu 的使用权给其他程序</p>\n<p><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">while</span>(<span class=\"literal\">true</span>)&#123;</span><br><span class=\"line\">    <span class=\"keyword\">try</span>&#123;</span><br><span class=\"line\">        Thread.sleep(<span class=\"number\">50</span>);</span><br><span class=\"line\">    &#125;<span class=\"keyword\">catch</span>(InterrupterdException e)&#123;</span><br><span class=\"line\">        e.printStackTrace();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<ul>\n<li>可以用 wait  或条件变量达到类似效果</li>\n<li>不同的是，后者需要加锁，并且需要相应的唤醒操作，一般适用于要进行同步的场景</li>\n<li>sleep 适用于无需同步的场景</li>\n</ul>\n<h4 id=\"join\"><a class=\"anchor\" href=\"#join\">#</a> join</h4>\n<p><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">static</span> <span class=\"type\">int</span> <span class=\"variable\">r</span> <span class=\"operator\">=</span> <span class=\"number\">0</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title function_\">main</span><span class=\"params\">(String[] args)</span> &#123;</span><br><span class=\"line\">        <span class=\"type\">Thread</span> <span class=\"variable\">t1</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">Thread</span>(() -&gt; &#123;</span><br><span class=\"line\">            <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">                TimeUnit.SECONDS.sleep(<span class=\"number\">2</span>);</span><br><span class=\"line\">                r = <span class=\"number\">1</span>;</span><br><span class=\"line\">            &#125; <span class=\"keyword\">catch</span> (InterruptedException e) &#123;</span><br><span class=\"line\">                log.debug(<span class=\"string\">&quot;wake up&quot;</span>);</span><br><span class=\"line\">                e.printStackTrace();</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;, <span class=\"string\">&quot;t1&quot;</span>);</span><br><span class=\"line\">        t1.start();</span><br><span class=\"line\">        log.debug(<span class=\"string\">&quot;&#123;&#125;&quot;</span>, r);</span><br><span class=\"line\"></span><br><span class=\"line\">    &#125;</span><br></pre></td></tr></table></figure></p>\n<p>打印结果为 r=0</p>\n<p>这是因为主线程在 r 复制之前就执行了日志打印，等待 t1 执行完需要调用 <code>t1.join()</code> （启动 t1 之后）</p>\n<h4 id=\"应用同步\"><a class=\"anchor\" href=\"#应用同步\">#</a> 应用同步</h4>\n<p>从调用方的角度讲：</p>\n<ul>\n<li>需要等待结果返回，才能继续执行的是同步</li>\n<li>不需要等待结果返回，就能继续执行的是异步</li>\n</ul>\n<p>sleep、join、wait 被打断后会清除打断标记，也就是打断标记不会为真值</p>\n<h2 id=\"模式之两阶段终止模式\"><a class=\"anchor\" href=\"#模式之两阶段终止模式\">#</a> 模式之两阶段终止模式 *</h2>\n<p>在一个线程 T1 中如何优雅终止线程 T2</p>\n<p><strong>错误思路</strong>：</p>\n<ul>\n<li>使用 stop（）方法停止线程\n<ul>\n<li>stop 方法会真正杀死线程，如果这时线程锁住了共享资源，那么它被杀死后就再也没有机会释放锁，其他线程将永远无法获取锁。</li>\n</ul>\n</li>\n<li>使用 System.exit (ini) 方法停止线程\n<ul>\n<li>目的仅仅是停止一个线程，但会让整个程序停止运行。</li>\n</ul>\n</li>\n</ul>\n<p><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">graph TD</span><br><span class=\"line\">    w(&quot;while(true)&quot;) --&gt; a</span><br><span class=\"line\">    a(&quot;有没有被打断&quot;)-- 是 --&gt; b(&quot;料理后事&quot;)</span><br><span class=\"line\">    b --&gt; c((&quot;结束循环&quot;))</span><br><span class=\"line\">    a --否--&gt; d(&quot;睡眠2s&quot;)</span><br><span class=\"line\">    d --有异常--&gt;i(设置打断标记)</span><br><span class=\"line\">    d --无异常--&gt;e(执行监控记录)</span><br><span class=\"line\">    i --&gt; w</span><br><span class=\"line\">    e --&gt; w</span><br></pre></td></tr></table></figure></p>\n<p><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Slf4j(topic = &quot;TwoPhaseTermination&quot;)</span></span><br><span class=\"line\"><span class=\"keyword\">class</span> <span class=\"title class_\">TwoPhaseTermination</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> Thread monitor;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">//启动监控线程</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">start</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">        monitor = <span class=\"keyword\">new</span> <span class=\"title class_\">Thread</span>(() -&gt; &#123;</span><br><span class=\"line\">            <span class=\"keyword\">while</span>(<span class=\"literal\">true</span>)&#123;</span><br><span class=\"line\">                <span class=\"type\">Thread</span> <span class=\"variable\">current</span> <span class=\"operator\">=</span> Thread.currentThread();</span><br><span class=\"line\">                <span class=\"keyword\">if</span>(current.isInterrupted())&#123;</span><br><span class=\"line\">                    log.debug(<span class=\"string\">&quot;得，料理后事&quot;</span>);</span><br><span class=\"line\">                    <span class=\"keyword\">break</span>;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">                <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">                    TimeUnit.SECONDS.sleep(<span class=\"number\">1</span>);</span><br><span class=\"line\">                    log.debug(<span class=\"string\">&quot;执行监控记录&quot;</span>);</span><br><span class=\"line\">                &#125;<span class=\"keyword\">catch</span> (InterruptedException e)&#123;</span><br><span class=\"line\">                    e.printStackTrace();</span><br><span class=\"line\">                    log.debug(<span class=\"string\">&quot;睡眠时打断&quot;</span>);</span><br><span class=\"line\">                    <span class=\"comment\">//设置打断标记</span></span><br><span class=\"line\"><span class=\"comment\">//                    current.interrupt();</span></span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;);</span><br><span class=\"line\">        monitor.start();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">stop</span><span class=\"params\">()</span>&#123;</span><br><span class=\"line\">        monitor.interrupt();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//执行</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title function_\">main</span><span class=\"params\">(String[] args)</span> <span class=\"keyword\">throws</span> InterruptedException &#123;</span><br><span class=\"line\">        <span class=\"type\">TwoPhaseTermination</span> <span class=\"variable\">tpt</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">TwoPhaseTermination</span>();</span><br><span class=\"line\"></span><br><span class=\"line\">        tpt.start();</span><br><span class=\"line\">        TimeUnit.SECONDS.sleep(<span class=\"number\">4</span>);</span><br><span class=\"line\">        tpt.stop();</span><br><span class=\"line\">    &#125;</span><br></pre></td></tr></table></figure></p>\n<h3 id=\"关于park和interrupted方法\"><a class=\"anchor\" href=\"#关于park和interrupted方法\">#</a> 关于 park () 和 interrupted () 方法</h3>\n<p>park () 方法会使的未被打断的线程（或打断标记为 false）阻塞，当线程再次被打断时（打断标记为 true）继续运行。</p>\n<p>interrupted () 方法会打断线程并且清除打断标记（置 false）</p>\n<h3 id=\"不推荐方法\"><a class=\"anchor\" href=\"#不推荐方法\">#</a> 不推荐方法：</h3>\n<p><strong>理由：方法过时，容易破坏同步代码块，造成线程死锁</strong></p>\n<ul>\n<li>stop ( ) 停止线程</li>\n<li>suspend ( ) 挂起线程</li>\n<li>resume ( ) 恢复线程运行</li>\n</ul>\n<h2 id=\"主线程与守护线程\"><a class=\"anchor\" href=\"#主线程与守护线程\">#</a> 主线程与守护线程</h2>\n<p>默认情况下，java 进程需要等待所有线程都结束才会结束。有一种特殊的线程叫做守护线程，只要其它非守护线程运行结束，即使守护线程的代码没执行完，也会强制结束。</p>\n<p><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title function_\">main</span><span class=\"params\">(String[] args)</span> <span class=\"keyword\">throws</span> InterruptedException &#123;</span><br><span class=\"line\">        <span class=\"type\">Thread</span> <span class=\"variable\">t1</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">Thread</span>(()-&gt;&#123;</span><br><span class=\"line\">            <span class=\"keyword\">while</span>(<span class=\"literal\">true</span>)&#123;</span><br><span class=\"line\">                <span class=\"keyword\">if</span>(Thread.currentThread().isInterrupted())&#123;</span><br><span class=\"line\">                    <span class=\"keyword\">break</span>;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            log.debug(<span class=\"string\">&quot;结束&quot;</span>);</span><br><span class=\"line\">        &#125;, <span class=\"string\">&quot;t1&quot;</span>);</span><br><span class=\"line\">        t1.setDaemon(<span class=\"literal\">true</span>);</span><br><span class=\"line\">        t1.start();</span><br><span class=\"line\">        Thread.sleep(<span class=\"number\">1000</span>);</span><br><span class=\"line\">        log.debug(<span class=\"string\">&quot;结束1&quot;</span>);</span><br><span class=\"line\">    &#125;</span><br></pre></td></tr></table></figure></p>\n<ul>\n<li>垃圾回收线程就是一个守护线程</li>\n<li>tomcat 中的 Acceptor 和 Poller 线程都是守护线程，所以 Tomcat 接收到 Shutdown 命令后，不会等待它们处理完请求</li>\n</ul>\n<h2 id=\"线程的六个状态\"><a class=\"anchor\" href=\"#线程的六个状态\">#</a> 线程的六个状态</h2>\n<blockquote>\n<p>在 Thead 的内部枚举类 State 定义了线程的六个状态：</p>\n<blockquote>\n<p>&lt;span style=&quot;color:red&quot;&gt;NEW&lt;/span&gt;（尚未启动的线程处于此状态，创建为调用 <code>start()</code>  方法）</p>\n</blockquote>\n<blockquote>\n<p>&lt;span style=&quot;color:red&quot;&gt;RUNNABLE&lt;/span&gt;（在 Java 虚拟机执行的线程处于此状态 | 操作系统层面的可运行、阻塞、运行都是此状态）</p>\n</blockquote>\n<blockquote>\n<p>&lt;span style=&quot;color:red&quot;&gt;BLOCKED&lt;/span&gt;（被阻塞等待监视器锁定的线程处于此状态）</p>\n</blockquote>\n<blockquote>\n<p>&lt;span style=&quot;color:red&quot;&gt;WAITING&lt;/span&gt;（正在等待另一个线程执行特定动作的线程处于此状态）</p>\n</blockquote>\n<blockquote>\n<p>&lt;span style=&quot;color:red&quot;&gt;TIMED_WAITING&lt;/span&gt;（正在等待另一个线程执行动作达到指定等待时间的线程处于此状态）</p>\n</blockquote>\n<blockquote>\n<p>&lt;span style=&quot;color:red&quot;&gt;TERMINATED&lt;/span&gt;（已退出的线程处于此状态）</p>\n</blockquote>\n</blockquote>\n<p><img data-src=\"https://raw.githubusercontent.com/Windlinxy/Typora-img/main/img/202210042139039.png\" alt=\"img\" /></p>\n<p><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@Slf4j(topic = &quot;ThreadState&quot;)</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">ThreadState</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title function_\">main</span><span class=\"params\">(String[] args)</span> &#123;</span><br><span class=\"line\">        <span class=\"type\">Thread</span> <span class=\"variable\">t1</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">Thread</span>(() -&gt; &#123;</span><br><span class=\"line\">            log.debug(<span class=\"string\">&quot;running&quot;</span>);</span><br><span class=\"line\">        &#125;, <span class=\"string\">&quot;t1&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"type\">Thread</span> <span class=\"variable\">t2</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">Thread</span>(() -&gt; &#123;</span><br><span class=\"line\">            <span class=\"keyword\">while</span> (<span class=\"literal\">true</span>) &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;, <span class=\"string\">&quot;t2&quot;</span>);</span><br><span class=\"line\">        t2.start();</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"type\">Thread</span> <span class=\"variable\">t3</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">Thread</span>(() -&gt; &#123;</span><br><span class=\"line\">            log.debug(<span class=\"string\">&quot;running&quot;</span>);</span><br><span class=\"line\">        &#125;, <span class=\"string\">&quot;t3&quot;</span>);</span><br><span class=\"line\">        t3.start();</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"type\">Thread</span> <span class=\"variable\">t4</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">Thread</span>(() -&gt; &#123;</span><br><span class=\"line\">            <span class=\"keyword\">synchronized</span> (ThreadState.class) &#123;</span><br><span class=\"line\">                <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">                    TimeUnit.SECONDS.sleep(<span class=\"number\">10000</span>);</span><br><span class=\"line\">                &#125; <span class=\"keyword\">catch</span> (InterruptedException e) &#123;</span><br><span class=\"line\">                    e.printStackTrace();</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;, <span class=\"string\">&quot;t4&quot;</span>);</span><br><span class=\"line\">        t4.start();</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"type\">Thread</span> <span class=\"variable\">t5</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">Thread</span>(() -&gt; &#123;</span><br><span class=\"line\">            <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">                t2.join();</span><br><span class=\"line\">            &#125; <span class=\"keyword\">catch</span> (InterruptedException e) &#123;</span><br><span class=\"line\">                e.printStackTrace();</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;, <span class=\"string\">&quot;t5&quot;</span>);</span><br><span class=\"line\">        t5.start();</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"type\">Thread</span> <span class=\"variable\">t6</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">Thread</span>(() -&gt; &#123;</span><br><span class=\"line\">            <span class=\"keyword\">synchronized</span> (ThreadState.class) &#123;</span><br><span class=\"line\">                <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">                    TimeUnit.SECONDS.sleep(<span class=\"number\">10000</span>);</span><br><span class=\"line\">                &#125; <span class=\"keyword\">catch</span> (InterruptedException e) &#123;</span><br><span class=\"line\">                    e.printStackTrace();</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;, <span class=\"string\">&quot;t6&quot;</span>);</span><br><span class=\"line\">        t6.start();</span><br><span class=\"line\"></span><br><span class=\"line\">        log.debug(<span class=\"string\">&quot;t1 state:&#123;&#125;&quot;</span>, t1.getState());</span><br><span class=\"line\">        log.debug(<span class=\"string\">&quot;t2 state:&#123;&#125;&quot;</span>, t2.getState());</span><br><span class=\"line\">        log.debug(<span class=\"string\">&quot;t3 state:&#123;&#125;&quot;</span>, t3.getState());</span><br><span class=\"line\">        log.debug(<span class=\"string\">&quot;t4 state:&#123;&#125;&quot;</span>, t4.getState());</span><br><span class=\"line\">        log.debug(<span class=\"string\">&quot;t5 state:&#123;&#125;&quot;</span>, t5.getState());</span><br><span class=\"line\">        log.debug(<span class=\"string\">&quot;t6 state:&#123;&#125;&quot;</span>, t6.getState());</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<p>结果：</p>\n<p><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">21:25:24 [main] ThreadState - t1 state:NEW</span><br><span class=\"line\">21:25:24 [t3] ThreadState - running</span><br><span class=\"line\">21:25:24 [main] ThreadState - t2 state:RUNNABLE</span><br><span class=\"line\">21:25:24 [main] ThreadState - t3 state:TERMINATED</span><br><span class=\"line\">21:25:24 [main] ThreadState - t4 state:TIMED_WAITING</span><br><span class=\"line\">21:25:24 [main] ThreadState - t5 state:WAITING</span><br><span class=\"line\">21:25:24 [main] ThreadState - t6 state:BLOCKED</span><br></pre></td></tr></table></figure></p>\n<h2 id=\"小结\"><a class=\"anchor\" href=\"#小结\">#</a> 小结</h2>\n<ul>\n<li>线程创建\n<ul>\n<li>线程重要 api， <code>start</code> ， <code>run</code> ， <code>sleep</code> ， <code>join</code> ， <code>interrupt</code>  等</li>\n<li>线程六个状态</li>\n<li>应用方面\n<ul>\n<li>异步调用</li>\n<li>提高效率</li>\n<li>同步等待</li>\n<li>统筹规划</li>\n</ul>\n</li>\n<li>原理方面\n<ul>\n<li>线程运行流程：栈、栈帧、上下文切换、程序计数器</li>\n<li>Thread 两种创建方式的源码</li>\n</ul>\n</li>\n<li>模式方面\n<ul>\n<li>两阶段终止模式</li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n",
            "tags": [
                "学习笔记",
                "后端",
                "多线程框架"
            ]
        },
        {
            "id": "https://windlinxy.top/2022/06/30/712cede46373/",
            "url": "https://windlinxy.top/2022/06/30/712cede46373/",
            "title": "RabbitMQ学习_02",
            "date_published": "2022-06-30T01:15:19.000Z",
            "content_html": "<h1 id=\"安装\"><a class=\"anchor\" href=\"#安装\">#</a> 安装</h1>\n<h2 id=\"rpm包安装\"><a class=\"anchor\" href=\"#rpm包安装\">#</a> rpm 包安装</h2>\n<ol>\n<li>\n<p>官网地址：<span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cucmFiYml0bXEuY29tL2Rvd25sb2FkLmh0bWw=\">https://www.rabbitmq.com/download.html</span></p>\n</li>\n<li>\n<p>下载 rpm 文件：这里有两个需要下载，分别是 rabbitmq-server 和 erlang</p>\n</li>\n<li>\n<p>安装文件：</p>\n<ul>\n<li>\n<p>erlang-23.3.4.11-1.el7.x86_64.rpm</p>\n</li>\n<li>\n<p>rabbitmq-server-3.10.5-1.el8.noarch.rpm</p>\n</li>\n</ul>\n<p><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">需要的环境</span></span><br><span class=\"line\">rpm -ivh erlang-23.3.4.11-1.el7.x86_64.rpm</span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">依赖包，要联网</span></span><br><span class=\"line\">yum install socat -y</span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">本身</span></span><br><span class=\"line\">rpm -ivh rabbitmq-server-3.10.5-1.el8.noarch.rpm </span><br></pre></td></tr></table></figure></p>\n</li>\n<li>\n<p>常用命令</p>\n<p><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">开机启动RabbitMQ服务</span></span><br><span class=\"line\">chkconfig rabbitmq-server on</span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">启动服务</span></span><br><span class=\"line\">/sbin/service rabbitmq-server start </span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">查看服务状态</span></span><br><span class=\"line\">/sbin/service rabbitmq-server status</span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">停止服务状态</span></span><br><span class=\"line\">/sbin/service rabbitmq-server stop</span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">开启web管理插件</span></span><br><span class=\"line\">rabbitmq-plugins enable rabbitmq_management</span><br><span class=\"line\"><span class=\"meta prompt_\"></span></span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">开启</span></span><br></pre></td></tr></table></figure></p>\n<p><img data-src=\"https://raw.githubusercontent.com/Windlinxy/Typora-img/main/img/image-20220627173744214.png\" alt=\"image-20220627173744214\" /></p>\n</li>\n<li>\n<p>添加新用户</p>\n<p><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">创建账号</span></span><br><span class=\"line\">rabbitmqctl add_user admin 123</span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">设置用户角色</span></span><br><span class=\"line\">rabbitmqctl set_user_tags admin administrator</span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">设置用户权限 set_permissions [-p &lt;vhostpath&gt;] &lt;user&gt; &lt;conf&gt; &lt;write&gt; &lt;<span class=\"built_in\">read</span>&gt;</span></span><br><span class=\"line\">rabbitmqctl set_permissions -p &quot;/&quot; admin &quot;.*&quot; &quot;.*&quot; &quot;.*&quot;</span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">用户 user_admin 具有/vhost1 这个 virtual host 中所有资源的配置、写、读权限</span></span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">当前用户和角色</span></span><br><span class=\"line\">rabbitmqctl list_users</span><br></pre></td></tr></table></figure></p>\n</li>\n<li>\n<p>用户登录</p>\n</li>\n<li>\n<p>重置命令</p>\n<p><figure class=\"highlight shell\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">关闭应用命令</span></span><br><span class=\"line\">rabbitmqctl stop_app</span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">清除命令</span></span><br><span class=\"line\">rabbitmqctl reset</span><br><span class=\"line\"><span class=\"meta prompt_\"># </span><span class=\"language-bash\">重新启动</span></span><br><span class=\"line\">rabbitmqctl start_app</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure></p>\n</li>\n</ol>\n<h2 id=\"docker安装\"><a class=\"anchor\" href=\"#docker安装\">#</a> Docker 安装</h2>\n<h3 id=\"获取rabbit镜像\"><a class=\"anchor\" href=\"#获取rabbit镜像\">#</a> 获取 rabbit 镜像</h3>\n<p><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker pull rabbitmq:management</span><br></pre></td></tr></table></figure></p>\n<h3 id=\"创建并运行容器\"><a class=\"anchor\" href=\"#创建并运行容器\">#</a> 创建并运行容器</h3>\n<p><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker run -di --name=myrabbit -p 15672:15672 rabbitmq:management</span><br></pre></td></tr></table></figure></p>\n<p>—hostname：指定容器主机名称<br />\n —name：指定容器名称<br />\n - p：将 mq 端口号映射到本地<br />\n或者运行时设置用户和密码</p>\n<p><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker run -di --name myrabbit -e RABBITMQ_DEFAULT_USER=admin -e RABBITMQ_DEFAULT_PASS=admin -p 15672:15672 -p 5672:5672 -p 25672:25672 -p 61613:61613 -p 1883:1883 rabbitmq:management</span><br></pre></td></tr></table></figure></p>\n<h3 id=\"查看日志\"><a class=\"anchor\" href=\"#查看日志\">#</a> 查看日志</h3>\n<p><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">docker logs -f myrabbit</span><br></pre></td></tr></table></figure></p>\n<h3 id=\"容器运行正常\"><a class=\"anchor\" href=\"#容器运行正常\">#</a> 容器运行正常</h3>\n<p>使用 <span class=\"exturl\" data-url=\"aHR0cDovL3huLS1pcC0wcDNjazAxYWtjdTQxdjoxNTY3Mi8=\">http:// 你的 IP 地址：15672</span> 访问 rabbit 控制台</p>\n<h3 id=\"额外linux相关排查命令\"><a class=\"anchor\" href=\"#额外linux相关排查命令\">#</a> 额外 Linux 相关排查命令</h3>\n<p><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&gt; more xxx.log  查看日记信息&gt; netstat -naop | grep 5672 查看端口是否被占用&gt; ps -ef | grep 5672  查看进程&gt; systemctl stop 服务</span><br></pre></td></tr></table></figure></p>\n<h1 id=\"简单实践\"><a class=\"anchor\" href=\"#简单实践\">#</a> 简单实践</h1>\n<p>采用简单模式进行代码实践</p>\n<p><img data-src=\"https://raw.githubusercontent.com/Windlinxy/Typora-img/main/img/202206300906262.png\" alt=\"image-20220630083249319\" /></p>\n<p>生产者 Producer</p>\n<p><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> com.windlinxy.pqc;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> com.rabbitmq.client.Channel;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.rabbitmq.client.Connection;</span><br><span class=\"line\"><span class=\"keyword\">import</span> com.rabbitmq.client.ConnectionFactory;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> java.io.IOException;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.nio.charset.StandardCharsets;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.concurrent.TimeoutException;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@author</span> Windlinxy</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@description</span> 生产者</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@date</span> 2022-06-28 15:45</span></span><br><span class=\"line\"><span class=\"comment\"> **/</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">Producer</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">// 队列名称</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">final</span> <span class=\"type\">String</span> <span class=\"variable\">QUEUE_NAME</span> <span class=\"operator\">=</span> <span class=\"string\">&quot;hello&quot;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * 发消息</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> args 参数</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title function_\">main</span><span class=\"params\">(String[] args)</span> <span class=\"keyword\">throws</span> IOException, TimeoutException &#123;</span><br><span class=\"line\">        <span class=\"comment\">// 创建工厂</span></span><br><span class=\"line\">        <span class=\"type\">ConnectionFactory</span> <span class=\"variable\">factory</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">ConnectionFactory</span>();</span><br><span class=\"line\">        <span class=\"comment\">// 工厂ip连接RabbitMQ的队列</span></span><br><span class=\"line\">        factory.setHost(<span class=\"string\">&quot;服务器ip&quot;</span>);</span><br><span class=\"line\">        factory.setUsername(<span class=\"string\">&quot;admin&quot;</span>);</span><br><span class=\"line\">        factory.setPassword(<span class=\"string\">&quot;123&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// 创建连接</span></span><br><span class=\"line\">        <span class=\"type\">Connection</span> <span class=\"variable\">connection</span> <span class=\"operator\">=</span> factory.newConnection();</span><br><span class=\"line\">        <span class=\"comment\">// 连接中创建信道（具体看原理图）</span></span><br><span class=\"line\">        <span class=\"type\">Channel</span> <span class=\"variable\">channel</span> <span class=\"operator\">=</span> connection.createChannel();</span><br><span class=\"line\">        <span class=\"comment\">// 简单连接，忽略交换机，连接队列</span></span><br><span class=\"line\">        <span class=\"comment\">/*</span></span><br><span class=\"line\"><span class=\"comment\">         * 生成一个队列</span></span><br><span class=\"line\"><span class=\"comment\">         * 1. 队列名称</span></span><br><span class=\"line\"><span class=\"comment\">         * 2. 队列里的消息是否持久化（磁盘） 默认情况是存到内存（false）、</span></span><br><span class=\"line\"><span class=\"comment\">         * 3. 该队列是否只供一个消费者进行消费，是否消息共享，默认是false</span></span><br><span class=\"line\"><span class=\"comment\">         * 4. 最后一个消费者断开了连接之后，是否自动删除</span></span><br><span class=\"line\"><span class=\"comment\">         * */</span></span><br><span class=\"line\">        channel.queueDeclare(QUEUE_NAME, <span class=\"literal\">false</span>, <span class=\"literal\">false</span>, <span class=\"literal\">false</span>, <span class=\"literal\">null</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">// 准备发消息</span></span><br><span class=\"line\">        <span class=\"type\">String</span> <span class=\"variable\">message</span> <span class=\"operator\">=</span> <span class=\"string\">&quot;hello world!&quot;</span>;</span><br><span class=\"line\"><span class=\"comment\">/*       * 发送</span></span><br><span class=\"line\"><span class=\"comment\">         * 1. 发送到哪个交换机</span></span><br><span class=\"line\"><span class=\"comment\">         * 2. 路由的Key值是哪个，本次是队列的名称</span></span><br><span class=\"line\"><span class=\"comment\">         * 3. 其他参数信息</span></span><br><span class=\"line\"><span class=\"comment\">         * 4。 发送消息体 */</span></span><br><span class=\"line\">        channel.basicPublish(<span class=\"string\">&quot;&quot;</span>, QUEUE_NAME, <span class=\"literal\">null</span>, message.getBytes(StandardCharsets.UTF_8));</span><br><span class=\"line\"></span><br><span class=\"line\">        System.out.println(<span class=\"string\">&quot;Success!&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">        channel.close();</span><br><span class=\"line\">        connection.close();</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure></p>\n<p>消费者 Consumer</p>\n<p><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">package</span> com.windlinxy.pqc;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> com.rabbitmq.client.*;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">import</span> java.io.IOException;</span><br><span class=\"line\"><span class=\"keyword\">import</span> java.util.Arrays;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@author</span> Windlinxy</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@description</span> 消费者</span></span><br><span class=\"line\"><span class=\"comment\"> * <span class=\"doctag\">@date</span> 2022-06-28 15:45</span></span><br><span class=\"line\"><span class=\"comment\"> **/</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">Consumer</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"keyword\">final</span> <span class=\"keyword\">static</span> <span class=\"type\">String</span> <span class=\"variable\">QUEUE_NAME</span> <span class=\"operator\">=</span> <span class=\"string\">&quot;hello&quot;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title function_\">main</span><span class=\"params\">(String[] args)</span> <span class=\"keyword\">throws</span> Exception &#123;</span><br><span class=\"line\">        <span class=\"type\">ConnectionFactory</span> <span class=\"variable\">factory</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">ConnectionFactory</span>();</span><br><span class=\"line\">        factory.setHost(<span class=\"string\">&quot;服务器ip&quot;</span>);</span><br><span class=\"line\">        factory.setUsername(<span class=\"string\">&quot;admin&quot;</span>);</span><br><span class=\"line\">        factory.setPassword(<span class=\"string\">&quot;123&quot;</span>);</span><br><span class=\"line\">        <span class=\"type\">Connection</span> <span class=\"variable\">connection</span> <span class=\"operator\">=</span> factory.newConnection();</span><br><span class=\"line\">        <span class=\"type\">Channel</span> <span class=\"variable\">channel</span> <span class=\"operator\">=</span> connection.createChannel();</span><br><span class=\"line\">        System.out.println(<span class=\"string\">&quot;等待接收消息.........&quot;</span>);</span><br><span class=\"line\">        <span class=\"comment\">//推送的消息如何进行消费的接口回调</span></span><br><span class=\"line\">        com.rabbitmq.client.<span class=\"type\">Consumer</span> <span class=\"variable\">consumer</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">DefaultConsumer</span>(channel) &#123;</span><br><span class=\"line\">            <span class=\"comment\">/*</span></span><br><span class=\"line\"><span class=\"comment\">            回调方法</span></span><br><span class=\"line\"><span class=\"comment\">            1. consumerTag 标识</span></span><br><span class=\"line\"><span class=\"comment\">            2. envelope 获取一些信息，交换机，路由key</span></span><br><span class=\"line\"><span class=\"comment\">            3. properties 配置信息</span></span><br><span class=\"line\"><span class=\"comment\">            4. body 数据</span></span><br><span class=\"line\"><span class=\"comment\">             */</span></span><br><span class=\"line\">            <span class=\"meta\">@Override</span></span><br><span class=\"line\">            <span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">handleDelivery</span><span class=\"params\">(String consumerTag, Envelope envelope, AMQP.BasicProperties properties, <span class=\"type\">byte</span>[] body)</span> <span class=\"keyword\">throws</span> IOException &#123;</span><br><span class=\"line\">                System.out.println(<span class=\"string\">&quot;consumerTag ：&quot;</span> + consumerTag);</span><br><span class=\"line\">                System.out.println(<span class=\"string\">&quot;Exchange ： &quot;</span>+envelope.getExchange());</span><br><span class=\"line\">                System.out.println(<span class=\"string\">&quot;RoutingKey ： &quot;</span>+envelope.getRoutingKey());</span><br><span class=\"line\"><span class=\"comment\">//                System.out.println(&quot;properties ： &quot; + properties);</span></span><br><span class=\"line\">                System.out.println(<span class=\"string\">&quot;body ： &quot;</span> + <span class=\"keyword\">new</span> <span class=\"title class_\">String</span>(body));</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">/*</span></span><br><span class=\"line\"><span class=\"comment\">        高级用法</span></span><br><span class=\"line\"><span class=\"comment\">        DeliverCallback deliverCallback = (consumerTag, delivery) -&gt; &#123;</span></span><br><span class=\"line\"><span class=\"comment\">            String message = new String(delivery.getBody());</span></span><br><span class=\"line\"><span class=\"comment\">            System.out.println(message);</span></span><br><span class=\"line\"><span class=\"comment\">        &#125;;</span></span><br><span class=\"line\"><span class=\"comment\">        //取消消费的一个回调接口 如在消费的时候队列被删除掉了</span></span><br><span class=\"line\"><span class=\"comment\">        CancelCallback cancelCallback = (consumerTag) -&gt; &#123;</span></span><br><span class=\"line\"><span class=\"comment\">            System.out.println(&quot;消息消费被中断&quot;);</span></span><br><span class=\"line\"><span class=\"comment\">        &#125;;</span></span><br><span class=\"line\"><span class=\"comment\">        */</span></span><br><span class=\"line\">        </span><br><span class=\"line\">        <span class=\"comment\">/*</span></span><br><span class=\"line\"><span class=\"comment\">         * 消费者消费消息</span></span><br><span class=\"line\"><span class=\"comment\">         * 1.消费哪个队列</span></span><br><span class=\"line\"><span class=\"comment\">         * 2.消费成功之后是否要自动应答 true 代表自动应答 false 手动应答</span></span><br><span class=\"line\"><span class=\"comment\">         * 3.消费者未成功消费的回调</span></span><br><span class=\"line\"><span class=\"comment\">         */</span></span><br><span class=\"line\">        channel.basicConsume(QUEUE_NAME, <span class=\"literal\">true</span>, consumer);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"comment\">//消费者是监听消息，不要去关闭资源</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<p>结果：</p>\n<p><img data-src=\"https://raw.githubusercontent.com/Windlinxy/Typora-img/main/img/image-20220630091648283.png\" alt=\"image-20220630091648283\" /></p>\n<p><img data-src=\"https://raw.githubusercontent.com/Windlinxy/Typora-img/main/img/image-20220630091704270.png\" alt=\"image-20220630091704270\" /></p>\n",
            "tags": [
                "学习笔记",
                "后端",
                "消息队列"
            ]
        },
        {
            "id": "https://windlinxy.top/2022/06/27/4318463f9256/",
            "url": "https://windlinxy.top/2022/06/27/4318463f9256/",
            "title": "RabbitMQ学习_01",
            "date_published": "2022-06-27T09:19:23.000Z",
            "content_html": "<h1 id=\"相关概念\"><a class=\"anchor\" href=\"#相关概念\">#</a> 相关概念</h1>\n<h2 id=\"什么是mq\"><a class=\"anchor\" href=\"#什么是mq\">#</a> 什么是 MQ</h2>\n<p>message queue 消息的队列，本质上是队列，FIFO 先进先出，队列存放的内容是消息，还是一种跨进程的通信机制，用于上下游传递消息（比喻：QQ 上 A 发消息给 B，A 是上游，B 是下游），逻辑解耦和物理解耦，使用了 MQ 之后，消息发送上游只依赖 MQ，不需要依赖其他服务。</p>\n<h2 id=\"为什么要用mqmq三大特点\"><a class=\"anchor\" href=\"#为什么要用mqmq三大特点\">#</a> 为什么要用 MQ？MQ 三大特点</h2>\n<h3 id=\"流量消峰\"><a class=\"anchor\" href=\"#流量消峰\">#</a> 流量消峰</h3>\n<p>举例子：订单系统最多能处理一万次订单，这个处理能力应付正常时段的下单绰绰有余，正常我们下单一秒就能返回结果，但是在高峰期，如果两万次下单操作系统是处理不了的，只能限制订单超出一万次后不允许用户下单。而使用功能消息队列做缓冲，我们可以取消这个限制，把一秒内下的订单分散成一段时间来处理，这是有些用户可能在下单十几秒后才收到下单成功的操作，但是比不能下单的体验要好。</p>\n<h3 id=\"应用解耦\"><a class=\"anchor\" href=\"#应用解耦\">#</a> 应用解耦</h3>\n<p>举例子：以电商应用为例，应用中有订单系统、库存系统、物流系统、支付系统、用户创建订单后，如果耦合调用库存系统，物流系统，支付系统，任何一个子系统出了故障，都会造成下单操作异常。当转变成基于消息队列的方式后，系统间调用的问题会少很多，比如物流系统发生了故障，需要几分钟来修复，在这几分钟的时间里，物流系统要处理的内存被缓存在消息队列里，用户下单操作可以正常完成。当物流系统恢复后，急需处理订单即可，用户感受不到物流系统的故障，提升系统的可用性。</p>\n<p><img data-src=\"https://raw.githubusercontent.com/Windlinxy/Typora-img/main/img/image-20220627152327281.png\" alt=\"image-20220627152327281\" /></p>\n<h3 id=\"异步处理\"><a class=\"anchor\" href=\"#异步处理\">#</a> 异步处理</h3>\n<p>A 要调用 B，并且要时不时发消息询问 B 是否处理完毕。使用消息队列，A 调用 B 之后 A 干自己的事情，B 处理完成后发送处理完毕消息给消息队列，消息队列将消息发送给 A</p>\n<h2 id=\"mq的分类\"><a class=\"anchor\" href=\"#mq的分类\">#</a> MQ 的分类</h2>\n<h3 id=\"activemq\"><a class=\"anchor\" href=\"#activemq\">#</a> ActiveMQ</h3>\n<ul>\n<li>优点：单机吞吐量万级，时效性 ms 级，可用性高，基于主从架构实现高可用性，消息可靠性：较低概率丢失数据</li>\n<li>缺点：官方社区维护越来越少，高吞吐量使用场景少</li>\n</ul>\n<h3 id=\"kafka\"><a class=\"anchor\" href=\"#kafka\">#</a> Kafka</h3>\n<p>大数据杀手锏，谈到大数据领域内的消息传输，绕不开 Kafka，为大数据而生的消息中间件，百万级 TPS（服务器每秒处理事物数）吞吐量，在数据采集、传输、存储过程中发挥举足轻重的作用，目前已被 LinkedIn，Uber，Twitter，Netflix 等大公司所采纳</p>\n<ul>\n<li>优点：性能卓越，单机写入 TPS 约百万条 / 秒，吞吐量高，时效性 ms 级可用性非常高，kafka 是分布式的，一个数据多个副本，少数机器宕机不会丢失数据，不会导致不可用，消费者采用 pull 方式获取消息，消息有序，通过控制能够保证所有的消息被消费且仅被消费一次；有优秀的第三方 kafkaWeb 的管理界面 Kafka-Manager；在日志领域比较成熟，被多家公司和多个开源项目使用，功能支持较为简单，主要支持简单的 MQ 功能，在大数据领域的实时计算以及日志采集被大规模使用。</li>\n<li>缺点：Kafka 单机超过 64 个队列 / 分区，Load 会发生明显的飙高现象，队列越多，load 越高，发送消息响应时间变长，使用短轮询方式，实时性取决于轮询间隔时间，消费失败不支持重试；支持消息顺序，但是有一台代理宕机后，会产生消息乱序，社区更新较慢</li>\n</ul>\n<h3 id=\"rocketmq\"><a class=\"anchor\" href=\"#rocketmq\">#</a> RocketMQ</h3>\n<p>出自阿里巴巴开源产品，用 Java 语言实现，在设计时参考了 kafka，并做出了一些改进，被阿里巴巴广泛应用在订单、交易、充值、流计算、消息推送、日志流氏处理、binglog 分发等场景</p>\n<ul>\n<li>优点： 单机吞吐量十万级，可用性非常高，分布式架构，消息可以做到 0 丢失，MQ 功能较为完善，还是分布式的，扩展性好，支持 10 亿级别的消息堆积，不会因为堆积导致性能下降，源码是 Java 我们可以自己阅读源码，定制自己公司的 MQ</li>\n<li>缺点：支持的客户端语言不多，目前是 java 以及 C++，C++ 不成熟，社区活跃度一般，没有在 MQ 核心中区实现 JMS 等接口，有些系统要迁移需要修改大量代码</li>\n</ul>\n<h3 id=\"rabbitmq\"><a class=\"anchor\" href=\"#rabbitmq\">#</a> RabbitMQ</h3>\n<p>2007 年发布，是一个在 AMQP（高级消息队列协议）基础上完成的，可复用的企业消息系统，是当前最主流的中间件之一。</p>\n<ul>\n<li>优点：由于 erlang 语言的高并发特点，性能较好；吞吐量到万级，MQ 功能比较完备，健壮、稳定、易用、跨平台，支持多种语言：Python、Ruby、.NET、Java、JMS、C、PHP 等，支持 AJAX，文档齐全；开源提供的管理界面非常棒，用起来很好用，社区活跃度高，更新频率相当高</li>\n<li>缺点：商业版收费，学习成本高。</li>\n</ul>\n<h2 id=\"mq的选择\"><a class=\"anchor\" href=\"#mq的选择\">#</a> MQ 的选择</h2>\n<h3 id=\"kafka-2\"><a class=\"anchor\" href=\"#kafka-2\">#</a> Kafka</h3>\n<p>Kafka 适合产生大量数据的互联网服务的数据收集业务，大型公司，如果有日志采集，首选 Kafka</p>\n<h3 id=\"rocketmq-2\"><a class=\"anchor\" href=\"#rocketmq-2\">#</a> RocketMQ</h3>\n<p>适合金融互联网领域，对于可靠性要求很高的场景，业务上有并发的场景，建议可以选择</p>\n<h3 id=\"rabbitmq-2\"><a class=\"anchor\" href=\"#rabbitmq-2\">#</a> RabbitMQ</h3>\n<p>结合 erlang 语言本身的开发优势， 性能好时效性微妙级，社区活跃度，管理界面方便，数据量没那么大，中小型公司</p>\n<h1 id=\"rabbitmq-3\"><a class=\"anchor\" href=\"#rabbitmq-3\">#</a> RabbitMQ</h1>\n<h2 id=\"rabbit概念\"><a class=\"anchor\" href=\"#rabbit概念\">#</a> Rabbit 概念</h2>\n<p>RabbitMQ 是一个消息中间件；它接受并转发消息，接受、存储和转发消息</p>\n<h2 id=\"rabbit核心概念\"><a class=\"anchor\" href=\"#rabbit核心概念\">#</a> Rabbit 核心概念</h2>\n<p><img data-src=\"https://raw.githubusercontent.com/Windlinxy/Typora-img/main/img/image-20220627161810815.png\" alt=\"image-20220627161810815\" /></p>\n<h3 id=\"1-生产者\"><a class=\"anchor\" href=\"#1-生产者\">#</a> 1. 生产者</h3>\n<blockquote>\n<p>产生数据发送消息的生产者</p>\n</blockquote>\n<h3 id=\"2-交换机\"><a class=\"anchor\" href=\"#2-交换机\">#</a> 2. 交换机</h3>\n<blockquote>\n<p>交换机是 RabbitMQ 非常重要的一个部件，一方面它接受来自生产者的消息，另一方面它将消息推送到队列中，交换机必须确切知道如何处理它接受到的消息，是将这些消息推送到特定的队列还是推送到多个队列，亦或者是把消息丢弃，这个得有交换机类型决定</p>\n</blockquote>\n<h3 id=\"3-队列\"><a class=\"anchor\" href=\"#3-队列\">#</a> 3. 队列</h3>\n<blockquote>\n<p>队列是 RabbitMQ 内部使用的一个数据结构，尽管消息流经 RabbitMQ 和应用程序，但它们只能存储在队列中。队列仅受主机的内存和磁盘限制的约束，本质上是一个大的消息缓冲区，许多生产者可以将消息发送到一个队列，许多消费者可以尝试从一个队列接收数据，这就是我们使用队列的方式</p>\n<p>交换机和队列可以一对多绑定</p>\n</blockquote>\n<h3 id=\"4-消费者\"><a class=\"anchor\" href=\"#4-消费者\">#</a> 4. 消费者</h3>\n<blockquote>\n<p>消费与接收具有相似的含义。消费者大多时候是一个等待接受消息的程序。请注意生产者，消费者和消息中间件很多时候并不在同意机器上。同一个应用程序既可以是生产者又可以是消费者</p>\n</blockquote>\n<h2 id=\"rabbit核心部分模式\"><a class=\"anchor\" href=\"#rabbit核心部分模式\">#</a> Rabbit 核心部分（模式）</h2>\n<ul>\n<li>\n<p>&quot;Holle World&quot; 简单模式</p>\n</li>\n<li>\n<p>Work queues 工作模式</p>\n</li>\n<li>\n<p>Publish/Subscribe 发布 / 订阅模式</p>\n</li>\n<li>\n<p>Routing 路由模式</p>\n</li>\n<li>\n<p>Topics 主题模式</p>\n</li>\n<li>\n<p>Publisher Confirms 发布确认模式</p>\n</li>\n</ul>\n<h2 id=\"各个名词解释\"><a class=\"anchor\" href=\"#各个名词解释\">#</a> 各个名词解释</h2>\n<h3 id=\"rabbit工作原理\"><a class=\"anchor\" href=\"#rabbit工作原理\">#</a> Rabbit 工作原理</h3>\n<p><img data-src=\"https://raw.githubusercontent.com/Windlinxy/Typora-img/main/img/image-20220627162630662.png\" alt=\"image-20220627162630662\" /></p>\n<p><mark>Broke</mark>: 接收和分发消息的应用，RabbitMQ Server 就是 Message Broker，实质</p>\n<p><mark>Virtual host</mark>：出于多租户和安全因素设计的，把 AMQP 的基本组件划分到一个虚拟的分组中，类似于网络中的 namespace 概念。当多个不同的用户使用同一个 RabbitMQ server 提供的服务时，可以划分出 多个 vhost，每个用户在自己的 vhost 创建 exchange／queue 等</p>\n<p><strong><mark>Connection</mark></strong>：publisher／consumer 和 broker 之间的 TCP 连接</p>\n<p><strong><mark>Channel</mark></strong>：如果每一次访问 RabbitMQ 都建立一个 Connection，在消息量大的时候建立 TCP Connection 的开销将是巨大的，效率也较低。Channel 是在 connection 内部建立的逻辑连接，如果应用程 序支持多线程，通常每个 thread 创建单独的 channel 进行通讯，AMQP method 包含了 channel id 帮助客 户端和 message broker 识别 channel，所以 channel 之间是完全隔离的。Channel 作为轻量级的 Connection 极大减少了操作系统建立 TCP connection 的开销</p>\n<p><mark>Exchange</mark>：message 到达 broker 的第一站，根据分发规则，匹配查询表中的 routing key，分发 消息到 queue 中去。常用的类型有：direct (point-to-point), topic (publish-subscribe) and fanout (multicast)</p>\n<p><mark>Queue</mark>：消息最终被送到这里等待 consumer 取走</p>\n<p><mark>Binding</mark>：exchange 和 queue 之间的虚拟连接，binding 中可以包含 routing key，Binding 信息被保 存到 exchange 中的查询表中，用于 message 的分发依据</p>\n",
            "tags": [
                "学习笔记",
                "后端",
                "消息队列"
            ]
        },
        {
            "id": "https://windlinxy.top/2022/04/23/f0d92c452e76/",
            "url": "https://windlinxy.top/2022/04/23/f0d92c452e76/",
            "title": "开启音乐创作之旅",
            "date_published": "2022-04-23T02:46:33.000Z",
            "content_html": "<h1 id=\"开启音乐创作之旅\"><a class=\"anchor\" href=\"#开启音乐创作之旅\">#</a> 开启音乐创作之旅</h1>\n<p>这是一个零基础的电子音乐教学网，你可以学习到基本的乐理知识，并且网站提供在线编曲，你可以通过点击按钮来获得自己想要的韵律。</p>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly9sZWFybmluZ211c2ljLmFibGV0b24uY29tL3poLUhhbnMvaW5kZXguaHRtbA==\">Learning Music</span></p>\n<p><img data-src=\"https://raw.githubusercontent.com/Windlinxy/Typora-img/main/img/image-20220423104902495.png\" alt=\"image-20220423104902495\" /></p>\n<p><img data-src=\"https://raw.githubusercontent.com/Windlinxy/Typora-img/main/img/image-20220423105408450.png\" alt=\"image-20220423105408450\" /></p>\n<p><strong>节奏</strong></p>\n<p><img data-src=\"https://raw.githubusercontent.com/Windlinxy/Typora-img/main/img/image-20220423105451762.png\" alt=\"image-20220423105451762\" /></p>\n<p><strong>贝斯</strong></p>\n<p><img data-src=\"https://raw.githubusercontent.com/Windlinxy/Typora-img/main/img/image-20220423105514105.png\" alt=\"image-20220423105514105\" /></p>\n<p>还有<strong>和弦</strong>和旋律</p>\n<p><img data-src=\"https://raw.githubusercontent.com/Windlinxy/Typora-img/main/img/image-20220423105602469.png\" alt=\"image-20220423105602469\" /></p>\n<p><img data-src=\"https://raw.githubusercontent.com/Windlinxy/Typora-img/main/img/image-20220423105612442.png\" alt=\"image-20220423105612442\" /></p>\n<p><strong>使用此网站随便作的曲子：</strong><span class=\"exturl\" data-url=\"aHR0cHM6Ly9tdXNpYy4xNjMuY29tLyMvc29uZz9pZD0xODYxNjUyMTQ1\">AnxiousLeisure</span></p>\n",
            "tags": [
                "杂谈",
                "兴趣",
                "网站推荐"
            ]
        },
        {
            "id": "https://windlinxy.top/2022/04/20/be5fe109faf5/",
            "url": "https://windlinxy.top/2022/04/20/be5fe109faf5/",
            "title": "函数式接口与方法引用",
            "date_published": "2022-04-20T00:48:07.000Z",
            "content_html": "<h1 id=\"函数式接口\"><a class=\"anchor\" href=\"#函数式接口\">#</a> 函数式接口</h1>\n<h2 id=\"概述\"><a class=\"anchor\" href=\"#概述\">#</a> 概述</h2>\n<ul>\n<li>\n<p><strong>只有一个抽象方法</strong>的接口称之为函数式接口（<strong>SAM</strong> Single Abstract Method 单一抽象方法模型）</p>\n</li>\n<li>\n<p>JDK 的函数式接口都加上了 @FunctionalInterface 注解进行标识。</p>\n</li>\n<li>\n<p>但是无论是否加上该注解，只要接口中只有一个抽象方法，都是函数式接口</p>\n</li>\n<li>\n<p>函数式接口可以通过 Lambda 表达式进行转换</p>\n</li>\n</ul>\n<p>例子：</p>\n<p><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@FunctionalInterface</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">interface</span> <span class=\"title class_\">InterfaceEx</span> &#123;</span><br><span class=\"line\">\t<span class=\"comment\">//单一抽象方法</span></span><br><span class=\"line\">    <span class=\"keyword\">void</span> <span class=\"title function_\">accept</span><span class=\"params\">()</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<h2 id=\"常用函数式接口\"><a class=\"anchor\" href=\"#常用函数式接口\">#</a> 常用函数式接口</h2>\n<h3 id=\"consumer消费接口\"><a class=\"anchor\" href=\"#consumer消费接口\">#</a> Consumer 消费接口</h3>\n<p><strong>对传入的值进行消费</strong></p>\n<p><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@FunctionalInterface</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">interface</span> <span class=\"title class_\">Consumer</span>&lt;T&gt; &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * Performs this operation on the given argument.</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> t the input argument</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    <span class=\"keyword\">void</span> <span class=\"title function_\">accept</span><span class=\"params\">(T t)</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"keyword\">default</span> Consumer&lt;T&gt; <span class=\"title function_\">andThen</span><span class=\"params\">(Consumer&lt;? <span class=\"built_in\">super</span> T&gt; after)</span> &#123;</span><br><span class=\"line\">        Objects.requireNonNull(after);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> (T t) -&gt; &#123; accept(t); after.accept(t); &#125;;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<h3 id=\"function计算转换接口\"><a class=\"anchor\" href=\"#function计算转换接口\">#</a> Function 计算转换接口</h3>\n<p><strong>在方法中对传入的参数计算或转换，将结果返回</strong></p>\n<p><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">@FunctionalInterface</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">interface</span> <span class=\"title class_\">Function</span>&lt;T, R&gt; &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">     * Applies this function to the given argument.</span></span><br><span class=\"line\"><span class=\"comment\">     *</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@param</span> t the function argument</span></span><br><span class=\"line\"><span class=\"comment\">     * <span class=\"doctag\">@return</span> the function result</span></span><br><span class=\"line\"><span class=\"comment\">     */</span></span><br><span class=\"line\">    R <span class=\"title function_\">apply</span><span class=\"params\">(T t)</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></p>\n<h2 id=\"常用默认方法\"><a class=\"anchor\" href=\"#常用默认方法\">#</a> 常用默认方法</h2>\n<ul>\n<li>and</li>\n<li>or</li>\n<li>ntgate</li>\n</ul>\n<h1 id=\"方法引用\"><a class=\"anchor\" href=\"#方法引用\">#</a> 方法引用</h1>\n<p>使用 Lambda 时，如果方法体中只有一个方法的调用的话，我们可以用方法引用进一步简化代码</p>\n<h2 id=\"推荐用法\"><a class=\"anchor\" href=\"#推荐用法\">#</a> 推荐用法</h2>\n<p>我们在使用 lambda 时不需要考虑什么时候用方法引用，用哪种方法引用，方法引用的格式是什么。我们只需要在写完 lambda 方法发现方法体只有一行代码，并且是方法的调用时使用快捷键尝试是否能够转换成方法引用即可。<br />\n当我们方法引用使用的多了慢慢的也可以直接写出方法引用。</p>\n<h2 id=\"基本格式\"><a class=\"anchor\" href=\"#基本格式\">#</a> 基本格式</h2>\n<p><code>ClassName::Method</code></p>\n<h2 id=\"语法详解\"><a class=\"anchor\" href=\"#语法详解\">#</a> 语法详解</h2>\n<h3 id=\"引用静态方法\"><a class=\"anchor\" href=\"#引用静态方法\">#</a> 引用静态方法</h3>\n<p>格式： <code>类名::方法名</code></p>\n<p>使用条件：</p>\n<ul>\n<li>重写方法时，方法体只有一行代码</li>\n<li>这行代码调用了某个类的静态方法</li>\n<li>要重写的抽象方法中所有的参数都按照顺序传入了这个静态方法</li>\n</ul>\n<p>例如：</p>\n<p><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Optional&lt;List&lt;Book&gt;&gt; books = author.map(Author::getBooks);</span><br></pre></td></tr></table></figure></p>\n<h3 id=\"引用对象实例方法\"><a class=\"anchor\" href=\"#引用对象实例方法\">#</a> 引用对象实例方法</h3>\n<p>格式： <code>对象名::方法名</code></p>\n<p>使用条件：</p>\n<ul>\n<li>重写方法时，方法体中只有一行代码</li>\n<li>这行代码是调用了某个对象的成员方法</li>\n<li>要重写的抽象方法中所有的参数都按照顺序传入了这个成员方法中</li>\n</ul>\n<p><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"type\">StringBuilder</span> <span class=\"variable\">stringBuilder</span> <span class=\"operator\">=</span> <span class=\"keyword\">new</span> <span class=\"title class_\">StringBuilder</span>();;</span><br><span class=\"line\">        author.stream().map(Author::getName)</span><br><span class=\"line\">                .forEach(name -&gt; stringBuilder.append(name));</span><br></pre></td></tr></table></figure></p>\n<p><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">StringBuilder stringBuilder = new StringBuilder();</span><br><span class=\"line\"> author.stream().map(Author::getName)</span><br><span class=\"line\">         .forEach(stringBuilder::append);</span><br></pre></td></tr></table></figure></p>\n<h3 id=\"引用类的实例方法\"><a class=\"anchor\" href=\"#引用类的实例方法\">#</a> 引用类的实例方法</h3>\n<p>格式： <code>类名::方法名</code></p>\n<p>使用条件：</p>\n<ul>\n<li>重写方法时，方法体只有一行代码</li>\n<li>这行代码调用了第一个参数的成员方法</li>\n<li>要重写的抽象方法中剩余所有的参数都按照顺序传入了这个成员方法</li>\n</ul>\n<h3 id=\"构造器引用\"><a class=\"anchor\" href=\"#构造器引用\">#</a> 构造器引用</h3>\n<p>格式： <code>类名::new</code></p>\n<p>使用条件：</p>\n<ul>\n<li>重写方法时，方法体只有一行代码</li>\n<li>方法调用了某个类的构造方法</li>\n<li>要重写的抽象方法中所有的参数都按照顺序传入了这个构造方法</li>\n</ul>\n<h3 id=\"基本类型优化\"><a class=\"anchor\" href=\"#基本类型优化\">#</a> 基本类型优化</h3>\n<p>对于流的 map () 可以使用 mapToInt 等等以及 flatMapToInt () 去处理基本类型相关可以减少装箱拆箱带来的时间成本。</p>\n<h1 id=\"并行流\"><a class=\"anchor\" href=\"#并行流\">#</a> 并行流</h1>\n<p>当流中有大量元素时，我们可以使用并行流来提高操作效率。其实并行流就是把任务分配给多个线程去完成，如果我们自己去用代码实现会非常复杂，并且要求对并发编程有足够理解、</p>\n<p>parallel 方法可以把串行流转换成并行流。</p>\n<p><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title function_\">my</span><span class=\"params\">()</span> &#123;</span><br><span class=\"line\">       Stream&lt;Integer&gt; stream = Stream.of(<span class=\"number\">1</span>,<span class=\"number\">2</span>,<span class=\"number\">3</span>,<span class=\"number\">4</span>,<span class=\"number\">5</span>,<span class=\"number\">6</span>,<span class=\"number\">7</span>,<span class=\"number\">8</span>,<span class=\"number\">9</span>,<span class=\"number\">10</span>,<span class=\"number\">11</span>,<span class=\"number\">12</span>,<span class=\"number\">13</span>,<span class=\"number\">14</span>,<span class=\"number\">15</span>,<span class=\"number\">16</span>,<span class=\"number\">17</span>,<span class=\"number\">18</span>,<span class=\"number\">19</span>,<span class=\"number\">20</span>);</span><br><span class=\"line\">       <span class=\"type\">Integer</span> <span class=\"variable\">sum</span> <span class=\"operator\">=</span> stream.parallel()</span><br><span class=\"line\">               .peek(num -&gt; System.out.println(num+Thread.currentThread().getName())).filter(num-&gt; num&gt;<span class=\"number\">10</span>)</span><br><span class=\"line\">               .reduce(Integer::sum)</span><br><span class=\"line\">                       .orElse(-<span class=\"number\">1</span>);</span><br><span class=\"line\">        System.out.println(sum);</span><br><span class=\"line\">    &#125;</span><br></pre></td></tr></table></figure></p>\n<p>也可以通过 parallelStream 直接获取并行流对象</p>\n",
            "tags": [
                "学习笔记",
                "Java",
                "JDK8",
                "函数式编程"
            ]
        }
    ]
}